(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[         0,          0]
NotebookDataLength[    506609,      12022]
NotebookOptionsPosition[    489933,      11745]
NotebookOutlinePosition[    490411,      11763]
CellTagsIndexPosition[    490368,      11760]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["\<\
Coupled Cluster and Equation of Motion-Coupled Cluster equation generator\
\>", "Title",
 CellChangeTimes->{{3.858323676094317*^9, 3.858323685587489*^9}, {
   3.860053063669647*^9, 3.860053080799135*^9}, 3.860567213204568*^9, {
   3.860658728132913*^9, 3.860658750101995*^9}, {3.860659713971147*^9, 
   3.86065972043897*^9}, {3.861948416617939*^9, 3.861948425045961*^9}, {
   3.876453977987728*^9, 3.87645397959604*^9}, 3.8764547510775967`*^9, {
   3.88848332256433*^9, 
   3.888483360315955*^9}},ExpressionUUID->"60337e77-32f7-4c0c-ad67-\
85dc0cdc42d1"],

Cell[CellGroupData[{

Cell["Modules and Functions", "Section",
 CellChangeTimes->{{3.8502124694131107`*^9, 3.850212483911498*^9}, {
   3.8508075976382303`*^9, 3.850807637386962*^9}, {3.85157491870508*^9, 
   3.8515749220559587`*^9}, {3.8515796859330683`*^9, 3.851579698913176*^9}, {
   3.858836125731333*^9, 3.85883613064154*^9}, 3.858836657468422*^9, {
   3.859628781424562*^9, 3.859628786169898*^9}, {3.887431861796212*^9, 
   3.887431864700734*^9}, {3.891066467743038*^9, 
   3.891066471058053*^9}},ExpressionUUID->"1b8c064c-e9a6-48fb-b021-\
965f16e7d98c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"removecontracted", "[", 
    RowBox[{"a1_", ",", "a2_", ",", "delkron_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"deletecontracted", ",", "delcont1", ",", "delcont2"}], "}"}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"deletecontracted", "=", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Table", "[", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"Floor", "[", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"Position", "[", 
                    RowBox[{
                    RowBox[{"Flatten", "[", "k1", "]"}], ",", 
                    RowBox[{
                    RowBox[{"Flatten", "[", 
                    RowBox[{"delkron", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}]}], "]"}], "+", "1"}], 
                  ")"}], "/", "2"}], "]"}], " ", "\[IndentingNewLine]", ",", 
               RowBox[{"{", 
                RowBox[{"i1", ",", 
                 RowBox[{"Length", "[", 
                  RowBox[{"Flatten", "[", 
                   RowBox[{"delkron", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "]"}], "]"}]}], "}"}]}], 
              "]"}], "  ", "//", " ", "Flatten"}], " ", "//", " ", 
            "DeleteDuplicates"}], "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"j1", ",", 
             RowBox[{"Length", "[", "delkron", "]"}]}], "}"}]}], "]"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"k1", ",", 
           RowBox[{"{", 
            RowBox[{"a1", ",", "a2"}], "}"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"deletecontracted", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"deletecontracted", "[", 
             RowBox[{"[", "l1", "]"}], "]"}], "[", 
            RowBox[{"[", "k1", "]"}], "]"}], "[", 
           RowBox[{"[", "j1", "]"}], "]"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"l1", ",", 
           RowBox[{"Length", "[", "deletecontracted", "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"k1", ",", 
           RowBox[{"Length", "[", 
            RowBox[{"deletecontracted", "[", 
             RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"j1", ",", 
           RowBox[{"Length", "[", 
            RowBox[{
             RowBox[{"deletecontracted", "[", 
              RowBox[{"[", "l1", "]"}], "]"}], "[", 
             RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"delcont1", "=", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Delete", "[", 
          RowBox[{"a1", ",", 
           RowBox[{
            RowBox[{"deletecontracted", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "[", 
            RowBox[{"[", "j1", "]"}], "]"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"j1", ",", 
           RowBox[{"Length", "[", 
            RowBox[{"deletecontracted", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"delcont2", "=", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Delete", "[", 
          RowBox[{"a2", ",", 
           RowBox[{
            RowBox[{"deletecontracted", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "[", 
            RowBox[{"[", "j1", "]"}], "]"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"j1", ",", 
           RowBox[{"Length", "[", 
            RowBox[{"deletecontracted", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{"{", 
        RowBox[{"delcont1", ",", "delcont2"}], "}"}], "]"}], ";"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"selectcorrectcontract", "[", 
    RowBox[{"nonunicdisc_", ",", "ete_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "cont", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"cont", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", 
           RowBox[{"DeleteDuplicates", "[", 
            RowBox[{"Flatten", "[", "nonunicdisc", "]"}], "]"}], "]"}], "==", 
          
          RowBox[{"2", 
           RowBox[{"Length", "[", "ete", "]"}]}]}], ",", "nonunicdisc"}], 
        "]"}]}], " ", ";", " ", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "cont", "]"}], ";"}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", 
  RowBox[{
  "(*", "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX\
XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "This", " ", "module", " ", "remplace", " ", "evalauate", " ", 
    "contracted", " ", "strings", " ", "to", " ", "obtain", " ", "the", " ", 
    "sign"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
  "(*", "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX\
XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"sign", "[", 
     RowBox[{"list2_", ",", "ete_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "ls", ",", "let1", ",", "num1", ",", "parnum", ",", "l2", ",", "dim", 
        ",", "F6", ",", "F7", ",", "ln1"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"ls", "=", 
        RowBox[{"{", "}"}]}], ";", "   ", 
       RowBox[{"let1", "=", 
        RowBox[{"{", "}"}]}], ";", " ", 
       RowBox[{"num1", "=", 
        RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"Flatten", "[", "ete", "]"}], "[", 
              RowBox[{"[", "i1", "]"}], "]"}], "[", 
             RowBox[{"[", "0", "]"}], "]"}], "===", "SuperDagger"}], ",", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"ls", ",", 
             RowBox[{
              RowBox[{
               RowBox[{"Flatten", "[", "ete", "]"}], "[", 
               RowBox[{"[", "i1", "]"}], "]"}], "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ",", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"ls", ",", 
             RowBox[{
              RowBox[{"Flatten", "[", "ete", "]"}], "[", 
              RowBox[{"[", "i1", "]"}], "]"}]}], "]"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i1", ",", 
           RowBox[{"Length", "[", 
            RowBox[{"Flatten", "[", "ete", "]"}], "]"}]}], "}"}]}], "]"}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"let1", "=", 
        RowBox[{
         RowBox[{"ImportString", "[", 
          RowBox[{
           RowBox[{"ExportString", "[", 
            RowBox[{"ls", ",", "\"\<CSV\>\""}], "]"}], " ", ",", 
           RowBox[{"{", 
            RowBox[{"\"\<CSV\>\"", ",", "\"\<RawData\>\""}], "}"}]}], "]"}], 
         " ", "//", "InputForm"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"let1", "=", 
        RowBox[{"Flatten", "/@", " ", "let1"}]}], ";", "\[IndentingNewLine]", 
       
       RowBox[{"num1", "=", 
        RowBox[{"Table", "[", 
         RowBox[{"i1", ",", 
          RowBox[{"{", 
           RowBox[{"i1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{"let1", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"parnum", "=", 
        RowBox[{
         RowBox[{"Length", "[", 
          RowBox[{"let1", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}], "/", "2"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"ln1", "=", 
        RowBox[{"Length", "[", "list2", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"l2", "[", "i1", "]"}], "=", 
          RowBox[{"Plus", "@@@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"Lookup", "[", 
               RowBox[{
                RowBox[{"AssociationThread", "[", 
                 RowBox[{
                  RowBox[{"let1", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "->", "num1"}], "]"}], ",",
                 "#", ",", "0"}], "]"}], "&"}], "/@", 
             RowBox[{"ToString", "/@", 
              RowBox[{"Flatten", "[", 
               RowBox[{"list2", "[", 
                RowBox[{"[", "i1", "]"}], "]"}], "]"}]}]}], ")"}]}]}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"i1", ",", "ln1"}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"F6", "=", 
        RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Do", "[", " ", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"i1", "<", "i2"}], ",", " ", "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"l2", "[", "i3", "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"2", "*", "i1"}], "+", "1"}], "]"}], "]"}], "<", 
                  RowBox[{
                   RowBox[{"l2", "[", "i3", "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"2", "*", "i2"}], "+", "1"}], "]"}], "]"}], "<", 
                  RowBox[{
                   RowBox[{"l2", "[", "i3", "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"2", "*", "i1"}], "+", "2"}], "]"}], "]"}]}], "&&", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"l2", "[", "i3", "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"2", "*", "i1"}], "+", "2"}], "]"}], "]"}], "<", 
                  RowBox[{
                   RowBox[{"l2", "[", "i3", "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"2", "*", "i2"}], "+", "2"}], "]"}], "]"}]}]}], "||", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"l2", "[", "i3", "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"2", "*", "i2"}], "+", "1"}], "]"}], "]"}], "<", 
                  RowBox[{
                   RowBox[{"l2", "[", "i3", "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"2", "*", "i1"}], "+", "1"}], "]"}], "]"}], "<", 
                  RowBox[{
                   RowBox[{"l2", "[", "i3", "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"2", "*", "i2"}], "+", "2"}], "]"}], "]"}]}], "&&", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"l2", "[", "i3", "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"2", "*", "i2"}], "+", "2"}], "]"}], "]"}], "<", 
                  RowBox[{
                   RowBox[{"l2", "[", "i3", "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"2", "*", "i1"}], "+", "2"}], "]"}], "]"}]}]}]}], 
               ",", "\[IndentingNewLine]", 
               RowBox[{"AppendTo", "[", 
                RowBox[{"F6", ",", 
                 RowBox[{"-", "1"}]}], "]"}], " ", ",", 
               RowBox[{"AppendTo", "[", 
                RowBox[{"F6", ",", "1"}], "]"}]}], " ", "]"}]}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"i1", ",", "0", ",", 
             RowBox[{"parnum", "-", "2"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i2", ",", 
             RowBox[{"parnum", "-", "1"}]}], "}"}]}], "]"}], " ", ",", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"i3", ",", 
           RowBox[{"Length", "[", "list2", "]"}]}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"F6", "==", 
          RowBox[{"{", "}"}]}], ",", 
         RowBox[{"dim", "=", "0"}], ",", 
         RowBox[{"dim", "=", 
          RowBox[{
           RowBox[{"Length", "[", "F6", "]"}], "/", 
           RowBox[{"Length", "[", "list2", "]"}]}]}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"F7", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Product", "[", 
           RowBox[{
            RowBox[{"F6", "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{"i1", "*", "dim"}], " ", "+", "i2"}], "]"}], "]"}], 
            ",", 
            RowBox[{"{", 
             RowBox[{"i2", ",", "dim"}], "}"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i1", ",", "0", ",", 
            RowBox[{"ln1", "-", "1"}]}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Return", "[", "F7", "]"}], ";"}]}], "\[IndentingNewLine]", 
     "]"}]}], ";"}], "\[IndentingNewLine]", 
  RowBox[{
  "(*", "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX\
XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "This", " ", "module", " ", "remplace", " ", "the", " ", "the", " ", 
    "arbitraty", " ", "indexes", " ", "for", " ", "particle", " ", "or", " ", 
    "hole", " ", "indexes"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
  "(*", "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX\
XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"krontonint", "[", 
     RowBox[{"list3_", ",", "ete_", ",", "N_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"comp1", ",", "lint", ",", "comp2", ",", "L"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"list3", "===", 
          RowBox[{"{", "}"}]}], ",", 
         RowBox[{
          RowBox[{"L", "=", 
           RowBox[{"{", "}"}]}], ";", " ", 
          RowBox[{"comp2", "=", 
           RowBox[{"{", "}"}]}], ";"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"comp1", "=", "\[IndentingNewLine]", 
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Complement", "[", " ", 
              RowBox[{
               RowBox[{"list3", "[", 
                RowBox[{"[", "i1", "]"}], "]"}], ",", 
               RowBox[{
                RowBox[{"DeleteCases", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"q1", ",", "___"}], "}"}], "|", 
                  RowBox[{"{", 
                   RowBox[{"q2", ",", "___"}], "}"}], "|", 
                  RowBox[{"{", 
                   RowBox[{"q4", ",", "___"}], "}"}], "|", 
                  RowBox[{"{", 
                   RowBox[{"q3", ",", "___"}], "}"}], "|", 
                  RowBox[{"{", 
                   RowBox[{"___", ",", "q1"}], "}"}], "|", 
                  RowBox[{"{", 
                   RowBox[{"___", ",", "q2"}], "}"}], "|", 
                  RowBox[{"{", 
                   RowBox[{"___", ",", "q4"}], "}"}], "|", 
                  RowBox[{"{", 
                   RowBox[{"___", ",", "q3"}], "}"}]}], "]"}], "@", "  ", 
                RowBox[{"list3", "[", 
                 RowBox[{"[", "i1", "]"}], "]"}]}]}], "]"}], 
             "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"i1", ",", 
               RowBox[{"Length", "[", "list3", "]"}]}], "}"}]}], "]"}]}], ";",
           "\[IndentingNewLine]", 
          RowBox[{"lint", "=", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "[", 
               RowBox[{"ete", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "]"}], ">", "2"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"Table", "[", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"q1", ",", "q2", ",", "q3", ",", "q4"}], "}"}], " ", 
                "/.", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"comp1", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "->", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"comp1", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], ",", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"comp1", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "->", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"comp1", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ",", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"comp1", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "->", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"comp1", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], ",", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"comp1", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "->", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"comp1", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ",", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"comp1", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "->", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"comp1", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], ",", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"comp1", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "->", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"comp1", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ",", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"comp1", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "4", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "->", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"comp1", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "4", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], ",", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"comp1", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "4", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "->", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"comp1", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "4", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}]}], "}"}]}], 
               "\[IndentingNewLine]", ",", 
               RowBox[{"{", 
                RowBox[{"i1", ",", 
                 RowBox[{"Length", "[", "list3", "]"}]}], "}"}]}], "]"}], ",",
              "\[IndentingNewLine]", 
             RowBox[{"Table", "[", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"q1", ",", "q2"}], "}"}], " ", "/.", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"comp1", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "->", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"comp1", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], ",", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"comp1", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "->", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"comp1", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ",", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"comp1", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "->", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"comp1", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], ",", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"comp1", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "->", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"comp1", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}]}], "}"}]}], 
               "\[IndentingNewLine]", ",", 
               RowBox[{"{", 
                RowBox[{"i1", ",", 
                 RowBox[{"Length", "[", "list3", "]"}]}], "}"}]}], "]"}]}], 
            "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"comp2", "=", 
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"DeleteCases", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"q1", ",", "___"}], "}"}], "|", 
                RowBox[{"{", 
                 RowBox[{"q2", ",", "___"}], "}"}], "|", 
                RowBox[{"{", 
                 RowBox[{"q4", ",", "___"}], "}"}], "|", 
                RowBox[{"{", 
                 RowBox[{"q3", ",", "___"}], "}"}], "|", 
                RowBox[{"{", 
                 RowBox[{"___", ",", "q1"}], "}"}], "|", 
                RowBox[{"{", 
                 RowBox[{"___", ",", "q2"}], "}"}], "|", 
                RowBox[{"{", 
                 RowBox[{"___", ",", "q4"}], "}"}], "|", 
                RowBox[{"{", 
                 RowBox[{"___", ",", "q3"}], "}"}]}], "]"}], "@", "  ", 
              RowBox[{"list3", "[", 
               RowBox[{"[", "i1", "]"}], "]"}]}], "\[IndentingNewLine]", ",", 
             
             RowBox[{"{", 
              RowBox[{"i1", ",", 
               RowBox[{"Length", "[", "list3", "]"}]}], "}"}]}], "]"}]}], ";",
           "\[IndentingNewLine]", 
          RowBox[{"L", "=", 
           RowBox[{"Part", "[", 
            RowBox[{"lint", ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"comp2", "=", 
           RowBox[{"Part", "[", 
            RowBox[{"comp2", ",", "1"}], "]"}]}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"N", "==", "1"}], ",", 
         RowBox[{"Return", "[", 
          RowBox[{"{", "L", "}"}], "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"N", "==", "2"}], ",", 
           RowBox[{"Return", "[", 
            RowBox[{"{", "comp2", "}"}], "]"}], ",", "\[IndentingNewLine]", 
           RowBox[{"Return", "[", 
            RowBox[{"{", 
             RowBox[{"Length", "[", "lint", "]"}], "}"}], "]"}]}], "]"}]}], 
        "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{
  "(*", "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX\
XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "This", " ", "Function", " ", "replace", " ", "\"\<{\>\"", " ", "and", 
    " ", "\"\<[\>\"", " ", "for", " ", "\"\<[[\>\""}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
  "(*", "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX\
XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ChangeSqParforDSq", "[", "Quantitie_", "]"}], ":=", 
   RowBox[{"Quiet", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{"ToExpression", "[", 
         RowBox[{"ToExpression", "[", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"StringReplace", "[", 
              RowBox[{"#1", ",", 
               RowBox[{"\"\<]\>\"", "\[Rule]", "\"\<]]\>\""}]}], "]"}], "&"}],
             ")"}], "[", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"StringReplace", "[", 
               RowBox[{"#1", ",", 
                RowBox[{"\"\<[\>\"", "\[Rule]", "\"\<[[\>\""}]}], "]"}], 
              "&"}], ")"}], "[", 
            RowBox[{"ExportString", "[", 
             RowBox[{"#1", ",", "\"\<CSV\>\""}], "]"}], "]"}], "]"}], "]"}], 
         "]"}], "&"}], ")"}], "/@", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"ToExpression", "[", 
          RowBox[{"ToExpression", "[", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"StringReplace", "[", 
               RowBox[{"#1", ",", 
                RowBox[{"\"\<}\>\"", "\[Rule]", "\"\<\>\""}]}], "]"}], "&"}], 
             ")"}], "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"StringReplace", "[", 
                RowBox[{"#1", ",", 
                 RowBox[{"\"\<{\>\"", "\[Rule]", "\"\<\>\""}]}], "]"}], "&"}],
               ")"}], "[", 
             RowBox[{"ExportString", "[", 
              RowBox[{
               RowBox[{"#1", "/.", "\[VeryThinSpace]", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{
                   SubscriptBox["t", "1"], "\[Rule]", "t1"}], ",", 
                  RowBox[{
                   SubscriptBox["t", "2"], "\[Rule]", "t2"}], ",", 
                  RowBox[{
                   SubscriptBox["t", "3"], "\[Rule]", "t3"}], ",", 
                  RowBox[{
                   SubscriptBox["t", "4"], "\[Rule]", "t4"}], ",", 
                  RowBox[{
                   SubscriptBox["t", "5"], "\[Rule]", "t5"}]}], "}"}]}], ",", 
               "\"\<CSV\>\""}], "]"}], "]"}], "]"}], "]"}], "]"}], "&"}], 
        ")"}], "/@", "Quantitie"}]}], "/.", "\[VeryThinSpace]", 
     RowBox[{
     "\[CapitalATilde]\.8f\[CapitalAHat]\.87", "\[Rule]", "\[Chi]"}]}], 
    "]"}]}], "\[IndentingNewLine]", 
  RowBox[{
  "(*", "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX\
XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "This", " ", "module", " ", "generates", " ", "of", " ", "the", " ", 
    "contractions", " ", "from", " ", "a", " ", "given", " ", "term"}], 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{
  "(*", "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX\
XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"CWick", "[", "sqstr_", "]"}], ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"list2", ",", "list3", ",", "delkron"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"list2", ",", "list3", ",", "delkron"}], "}"}], "=", 
        RowBox[{"eomcontractexternal", "[", "sqstr", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{"list2", ",", "list3", ",", "delkron"}], "}"}], "=", 
          RowBox[{"eomcontract", "[", "sqstr", "]"}]}], ";"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"Print", "[", 
        RowBox[{"Style", "[", 
         RowBox[{"\"\<Output\>\"", ",", "Bold", ",", "24"}], "]"}], "]"}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"Print", "[", 
        RowBox[{"Style", "[", 
         RowBox[{"\"\<Fully contrated term\>\"", ",", "Bold", ",", "Orange"}],
          "]"}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Return", "[", 
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"sign", "[", 
             RowBox[{
              RowBox[{"{", "#", "}"}], ",", "sqstr"}], "]"}], "&"}], "/@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"Partition", "[", 
               RowBox[{"#", ",", "2"}], "]"}], "&"}], "/@", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"Partition", "[", 
                 RowBox[{"#", ",", 
                  RowBox[{
                   RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"list2", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "2"}]}], "]"}], 
                "&"}], "@", 
               RowBox[{"Flatten", "[", "list2", "]"}]}], ")"}]}], ")"}]}], 
          "]"}], 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"Times", "@@", " ", "#"}], "&"}], "/@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"Subscript", "[", 
                 RowBox[{"\[Delta]", ",", "#"}], "]"}], "&"}], "/@", 
               RowBox[{"Partition", "[", 
                RowBox[{"#", ",", "2"}], "]"}]}], "&"}], "/@", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"Partition", "[", 
                 RowBox[{"#", ",", 
                  RowBox[{
                   RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"list2", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "2"}]}], "]"}], 
                "&"}], "@", 
               RowBox[{"Flatten", "[", "list2", "]"}]}], ")"}]}], ")"}]}], 
          ")"}]}], "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{
  "(*", "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX\
XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "This", " ", "module", " ", "generates", " ", "a", " ", "given", " ", 
    "Block", " ", "from", " ", "the", " ", "EOMCC", " ", "matrix"}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
  "(*", "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX\
XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"EOMCCpBLOCKgen", "[", 
     RowBox[{"ClusterOperator_", ",", "EOMOperator_", ",", "EOMBlock_"}], 
     "]"}], ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "Prefactors", ",", "Amplitudes", ",", "StringS", ",", "ManyBodyBlocks",
         ",", "ManyBodyTerms", ",", "DeltaKronecker", ",", 
        "ManyBodyTermsEquations", ",", "time"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"time", "=", 
        RowBox[{
         RowBox[{"Timing", "[", "\[IndentingNewLine]", 
          RowBox[{"(*", Cell["\<\
PrefAmplStr module  generates the pre-factors, amplitudes, and strings of \
second quantization\
\>", "Text",
            CellChangeTimes->{{3.887368635731531*^9, 3.887368728241324*^9}},
            ExpressionUUID->"6a45b2ab-4ece-4fc1-afce-1c8146ee1720"], "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{"Prefactors", ",", "Amplitudes", ",", "StringS"}], "}"}],
             "=", 
            RowBox[{"PrefAmplStr", "[", 
             RowBox[{"ClusterOperator", ",", "EOMOperator"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", Cell["\<\
ManyBodyHamiltonian module  generates the eomcc equations in terms of \
many-body terms, the set of non-redundant many body terms and and the \
intermediates in second quantization\
\>", "Text",
             CellChangeTimes->{{3.887368635731531*^9, 3.887368728241324*^9}},
             ExpressionUUID->"4bf9fa15-b28e-438b-9418-2118e04dcc08"], "*)"}], 
           "\[IndentingNewLine]", "  ", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"ManyBodyBlocks", ",", "ManyBodyTerms"}], "}"}], "=", 
            RowBox[{"ManyBodyHamiltonian", "[", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"StringS", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "[", 
                  RowBox[{"[", 
                   RowBox[{"Sequence", " ", "@@", "EOMBlock"}], "]"}], "]"}], 
                 "}"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"StringS", "[", 
                   RowBox[{"[", "2", "]"}], "]"}], "[", 
                  RowBox[{"[", 
                   RowBox[{"Sequence", " ", "@@", "EOMBlock"}], "]"}], "]"}], 
                 "}"}], "}"}]}], "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
           " ", 
           RowBox[{"(*", Cell["\<\
WicksContract module  generates the deltas Kronekers and the signs \
correspondingly\
\>", "Text",
             CellChangeTimes->{{3.887368635731531*^9, 3.887368728241324*^9}},
             ExpressionUUID->"e20e3f48-303c-450c-b882-ec11992d5b78"], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"DeltaKronecker", "=", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"Table", "[", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"Table", "[", 
                 RowBox[{
                  RowBox[{"WicksContract", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"ManyBodyTerms", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "]"}], " ", ",", 
                  RowBox[{"{", 
                   RowBox[{"i1", ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{"ManyBodyTerms", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
                "\[IndentingNewLine]", ",", 
                RowBox[{"{", 
                 RowBox[{"j1", ",", 
                  RowBox[{"Length", "[", 
                   RowBox[{"ManyBodyTerms", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
              ",", 
              RowBox[{"{", 
               RowBox[{"k1", ",", 
                RowBox[{"Length", "[", "ManyBodyTerms", "]"}]}], "}"}]}], 
             "]"}]}], ";", "  ", "\[IndentingNewLine]", 
           RowBox[{"(*", Cell["\<\
AntySymPermut Module  generates the pre-factors, amplitudes, and strings of \
second quantization\
\>", "Text",
             CellChangeTimes->{{3.887368635731531*^9, 3.887368728241324*^9}},
             ExpressionUUID->"145a7e07-43cf-48ef-bf02-583abad547dc"], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"ManyBodyTermsEquations", "=", 
            RowBox[{"AntSymPermut", "[", 
             RowBox[{
             "DeltaKronecker", ",", "ManyBodyTerms", ",", "Amplitudes", ",", 
              "Prefactors"}], "]"}]}], ";"}], "\[IndentingNewLine]", "]"}], 
         " ", "/.", " ", 
         RowBox[{"Null", " ", "->", 
          RowBox[{"Sequence", "[", "]"}]}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", Cell["Printing options", "Text",
         CellChangeTimes->{{3.887368635731531*^9, 3.887368728241324*^9}},
         ExpressionUUID->"615d0540-908b-4b04-be53-a4b2a4527a5a"], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"Print", "[", 
        RowBox[{"Style", "[", 
         RowBox[{"\"\<Output\>\"", ",", "Bold", ",", "24"}], "]"}], "]"}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"Print", "[", 
        RowBox[{"Style", "[", 
         RowBox[{"\"\<Execution Time\>\"", ",", "Bold", ",", "Orange"}], 
         "]"}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Print", "[", "time", "]"}], " ", ";", "\[IndentingNewLine]", 
       RowBox[{"Print", "[", 
        RowBox[{"Style", "[", 
         RowBox[{"\"\<Many-body terms\>\"", ",", "Bold", ",", "Orange"}], 
         "]"}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Print", "[", 
        RowBox[{"TableForm", "[", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"ManyBodyTermsEquations", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "[", 
               RowBox[{"[", "1", "]"}], "]"}], "[", 
              RowBox[{"[", "1", "]"}], "]"}], "[", 
             RowBox[{"[", "i1", "]"}], "]"}], "==", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"(", " ", 
                RowBox[{
                 RowBox[{
                  RowBox[{"ManyBodyTermsEquations", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "+", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"ManyBodyTermsEquations", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "[", 
                  RowBox[{"[", "2", "]"}], "]"}]}], ")"}], "/.", " ", 
               RowBox[{"0", " ", "->", " ", 
                RowBox[{"Sequence", "[", "]"}]}]}], ")"}], "[", 
             RowBox[{"[", "i1", "]"}], "]"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"i1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"ManyBodyTermsEquations", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "[", 
                RowBox[{"[", "1", "]"}], "]"}], "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], "]"}],
         "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Print", "[", 
        RowBox[{"Style", "[", 
         RowBox[{"\"\<EOM-CC equations\>\"", ",", "Bold", ",", "Orange"}], 
         "]"}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Print", "[", "ManyBodyBlocks", "]"}], ";"}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
  RowBox[{
  "(*", "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX\
XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "This", " ", "module", " ", "generates", " ", "The", " ", "Coupled", " ", 
    "Cluster", " ", "Equations"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
  "(*", "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX\
XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"CCgen", "[", 
     RowBox[{"ClusterOperator_", ",", "EOMOperator_"}], "]"}], ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "Prefactors", ",", "Amplitudes", ",", "StringS", ",", "DeltaKronecker",
         ",", "ManyBodyTermsEquations", ",", "time"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"time", "=", 
        RowBox[{
         RowBox[{"Timing", "[", "\[IndentingNewLine]", 
          RowBox[{"(*", Cell["\<\
PrefAmplStr module  generates the pre-factors, amplitudes, and strings of \
second quantization\
\>", "Text",
            CellChangeTimes->{{3.887368635731531*^9, 3.887368728241324*^9}},
            ExpressionUUID->"dae68233-5c88-4b68-ba9f-18a992ddb86c"], "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{"Prefactors", ",", "Amplitudes", ",", "StringS"}], "}"}],
             "=", 
            RowBox[{"PrefAmplStr", "[", 
             RowBox[{"ClusterOperator", ",", "EOMOperator"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", Cell["\<\
WicksContract module  generates the deltas Kronekers and the signs \
correspondingly\
\>", "Text",
             CellChangeTimes->{{3.887368635731531*^9, 3.887368728241324*^9}},
             ExpressionUUID->"8e2077bf-e1f1-4f49-afe8-7b99b0f28bed"], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"DeltaKronecker", "=", "\[IndentingNewLine]", 
            RowBox[{"Table", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Table", "[", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"Table", "[", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"Table", "[", 
                   RowBox[{
                    RowBox[{"WicksContract", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"StringS", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "]"}], " ", ",", 
                    RowBox[{"{", 
                    RowBox[{"i1", ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"StringS", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
                  "\[IndentingNewLine]", ",", 
                  RowBox[{"{", 
                   RowBox[{"j1", ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{"StringS", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
                "\[IndentingNewLine]", ",", 
                RowBox[{"{", 
                 RowBox[{"k1", ",", 
                  RowBox[{"Length", "[", 
                   RowBox[{"StringS", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
              "\[IndentingNewLine]", ",", 
              RowBox[{"{", 
               RowBox[{"l1", ",", 
                RowBox[{"Length", "[", "StringS", "]"}]}], "}"}]}], "]"}]}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"(*", Cell["\<\
AntySymPermut Module  generates the pre-factors, amplitudes, and strings of \
second quantization\
\>", "Text",
             CellChangeTimes->{{3.887368635731531*^9, 3.887368728241324*^9}},
             ExpressionUUID->"e8581842-611b-4813-b7f5-e542e4f2116a"], "*)"}], 
           " ", "\[IndentingNewLine]", 
           RowBox[{"ManyBodyTermsEquations", "=", "\[IndentingNewLine]", 
            RowBox[{"Table", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"AntSymPermut", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"DeltaKronecker", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                   RowBox[{"[", "i1", "]"}], "]"}], ",", 
                  RowBox[{
                   RowBox[{"DeltaKronecker", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "[", 
                   RowBox[{"[", "i1", "]"}], "]"}]}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"StringS", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                   RowBox[{"[", "i1", "]"}], "]"}], ",", 
                  RowBox[{
                   RowBox[{"StringS", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "[", 
                   RowBox[{"[", "i1", "]"}], "]"}]}], "}"}], ",", 
                "Amplitudes", ",", "Prefactors"}], "]"}], 
              "\[IndentingNewLine]", ",", 
              RowBox[{"{", 
               RowBox[{"i1", ",", 
                RowBox[{"Length", "[", 
                 RowBox[{"StringS", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}], 
           ";"}], "]"}], " ", "/.", " ", 
         RowBox[{"Null", " ", "->", 
          RowBox[{"Sequence", "[", "]"}]}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", Cell["Printing options", "Text",
         CellChangeTimes->{{3.887368635731531*^9, 3.887368728241324*^9}},
         ExpressionUUID->"b30e1559-1485-4233-a2c2-cf7c70126c20"], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"Print", "[", 
        RowBox[{"Style", "[", 
         RowBox[{"\"\<Output\>\"", ",", "Bold", ",", "24"}], "]"}], "]"}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"Print", "[", 
        RowBox[{"Style", "[", 
         RowBox[{"\"\<Execution Time\>\"", ",", "Bold", ",", "Blue"}], "]"}], 
        "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Print", "[", "time", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Print", "[", 
        RowBox[{"Style", "[", 
         RowBox[{"\"\<Amplitude Equations\>\"", ",", "Bold", ",", "Blue"}], 
         "]"}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Print", "[", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Total", "[", 
            RowBox[{"Flatten", "[", 
             RowBox[{
              RowBox[{"ManyBodyTermsEquations", "[", 
               RowBox[{"[", "i1", "]"}], "]"}], "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "1"}], "]"}], "]"}], "]"}], "]"}], "}"}], 
          ",", 
          RowBox[{"{", 
           RowBox[{"i1", ",", 
            RowBox[{"Length", "[", "ManyBodyTermsEquations", "]"}]}], "}"}]}],
          "]"}], "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{
  "(*", "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX\
XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "This", " ", "module", " ", "generates", " ", "Just", " ", "Many", " ", 
    "Body", " ", "Terms"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
  "(*", "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX\
XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ManyBodyTermsEOM", "[", 
    RowBox[{"ClusterOperator_", ",", "EOMOperator_", ",", "ManyBodyOp_"}], 
    "]"}], ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "Prefactors", ",", "Amplitudes", ",", "StringS", ",", "ManyBodyBlocks", 
       ",", "DeltaKronecker", ",", "ManyBodyTermsEquations", ",", "time", ",",
        "ManyBodyTerms"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"time", "=", 
       RowBox[{
        RowBox[{"Timing", "[", 
         RowBox[{"(*", Cell["\<\
PrefAmplStr module  generates the pre-factors, amplitudes, and strings of \
second quantization\
\>", "Text",
           CellChangeTimes->{{3.887368635731531*^9, 3.887368728241324*^9}},
           ExpressionUUID->"fb976aa1-ddaa-4ab1-b19e-6c2e4417a86b"], "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"Prefactors", ",", "Amplitudes", ",", "StringS"}], "}"}], 
           "=", 
           RowBox[{"PrefAmplStr", "[", 
            RowBox[{"ClusterOperator", ",", "EOMOperator"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"(*", Cell["\<\
Insert the cluster operators and the hamiltonian in the many body terms in \
second quantized form \
\>", "Text",
            CellChangeTimes->{{3.887368635731531*^9, 3.887368728241324*^9}},
            ExpressionUUID->"06f8c790-a6c7-46da-8119-5b91c79fcce4"], "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{"ManyBodyTerms", "=", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"Table", "[", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"Join", "[", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"ManyBodyOp", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "}"}], ",", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"StringS", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", 
                    RowBox[{"2", ";;", "3"}]}], "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], ",", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"ManyBodyOp", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "}"}]}], "]"}], 
                 "\[IndentingNewLine]", ",", 
                 RowBox[{"{", 
                  RowBox[{"i1", ",", 
                   RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"StringS", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", 
                    RowBox[{"2", ";;", "3"}]}], "]"}], "]"}], "]"}]}], 
                  "}"}]}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"j1", ",", 
                 RowBox[{"Length", "[", "ManyBodyOp", "]"}]}], "}"}]}], "]"}],
              ",", 
             RowBox[{"{", 
              RowBox[{"k1", ",", 
               RowBox[{"Length", "[", "StringS", "]"}]}], "}"}]}], "]"}]}], 
          ";", "\[IndentingNewLine]", " ", 
          RowBox[{"(*", Cell["\<\
WicksContract module  generates the deltas Kronekers and the signs \
correspondingly\
\>", "Text",
            CellChangeTimes->{{3.887368635731531*^9, 3.887368728241324*^9}},
            ExpressionUUID->"bd6642a8-2d84-486c-875b-11b6ab2d7cd4"], "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{"DeltaKronecker", "=", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"Table", "[", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"Table", "[", 
                RowBox[{
                 RowBox[{"WicksContract", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"ManyBodyTerms", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                   RowBox[{"[", "i1", "]"}], "]"}], "]"}], " ", ",", 
                 RowBox[{"{", 
                  RowBox[{"i1", ",", 
                   RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{"ManyBodyTerms", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
               "\[IndentingNewLine]", ",", 
               RowBox[{"{", 
                RowBox[{"j1", ",", 
                 RowBox[{"Length", "[", 
                  RowBox[{"ManyBodyTerms", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
             ",", 
             RowBox[{"{", 
              RowBox[{"k1", ",", 
               RowBox[{"Length", "[", "ManyBodyTerms", "]"}]}], "}"}]}], 
            "]"}]}], ";", "  ", "\[IndentingNewLine]", 
          RowBox[{"(*", Cell["\<\
AntySymPermut Module  generates the pre-factors, amplitudes, and strings of \
second quantization\
\>", "Text",
            CellChangeTimes->{{3.887368635731531*^9, 3.887368728241324*^9}},
            ExpressionUUID->"12ec3726-ee57-4301-89db-7bdb71a1547d"], "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{"ManyBodyTermsEquations", "=", 
           RowBox[{"AntSymPermut", "[", 
            RowBox[{
            "DeltaKronecker", ",", "ManyBodyTerms", ",", "Amplitudes", ",", 
             "Prefactors"}], "]"}]}], ";"}], "\[IndentingNewLine]", "]"}], 
        " ", "/.", " ", 
        RowBox[{"Null", " ", "->", 
         RowBox[{"Sequence", "[", "]"}]}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", Cell["Printing options", "Text",
        CellChangeTimes->{{3.887368635731531*^9, 3.887368728241324*^9}},
        ExpressionUUID->"4856c3c2-d8d5-4d09-82fa-8be6646ade1a"], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"Style", "[", 
        RowBox[{"\"\<Output\>\"", ",", "Bold", ",", "24"}], "]"}], "]"}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"Style", "[", 
        RowBox[{"\"\<Execution Time\>\"", ",", "Bold", ",", "Blue"}], "]"}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", "time", "]"}], " ", ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"Style", "[", 
        RowBox[{"\"\<Many-body terms\>\"", ",", "Bold", ",", "Blue"}], "]"}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"TableForm", "[", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"ManyBodyTermsEquations", "[", 
               RowBox[{"[", "2", "]"}], "]"}], "[", 
              RowBox[{"[", "1", "]"}], "]"}], "[", 
             RowBox[{"[", "1", "]"}], "]"}], "[", 
            RowBox[{"[", "i1", "]"}], "]"}], "==", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"(", " ", 
               RowBox[{
                RowBox[{
                 RowBox[{"ManyBodyTermsEquations", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "+", 
                RowBox[{
                 RowBox[{
                  RowBox[{"ManyBodyTermsEquations", "[", 
                   RowBox[{"[", "2", "]"}], "]"}], "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], ")"}], "/.", " ", 
              RowBox[{"0", " ", "->", " ", 
               RowBox[{"Sequence", "[", "]"}]}]}], ")"}], "[", 
            RowBox[{"[", "i1", "]"}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"ManyBodyTermsEquations", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "[", 
               RowBox[{"[", "1", "]"}], "]"}], "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], "]"}], 
       "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}], "\[IndentingNewLine]"}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8526287766681952`*^9, 3.852628787988392*^9}, {
   3.8526288293025894`*^9, 3.852628831542564*^9}, {3.852629192058259*^9, 
   3.852629193308221*^9}, {3.852629439698511*^9, 3.852629441392788*^9}, 
   3.853564728902742*^9, {3.854093893363677*^9, 3.854093899123505*^9}, {
   3.854107476155182*^9, 3.854107485869829*^9}, {3.854107918263681*^9, 
   3.85410793976665*^9}, 3.858323030899839*^9, 3.8586717706523952`*^9, {
   3.858836110045773*^9, 3.858836142952353*^9}, {3.869569848453067*^9, 
   3.8695698963768044`*^9}, {3.871454157029682*^9, 3.8714541579555492`*^9}, {
   3.871960697879822*^9, 3.871960699378051*^9}, {3.872043987387521*^9, 
   3.8720439884802837`*^9}, {3.872235676648345*^9, 3.872235677695427*^9}, 
   3.872239609186417*^9, 3.873884417473219*^9, {3.873950005135022*^9, 
   3.873950006165221*^9}, {3.8740575868789263`*^9, 3.874057612945642*^9}, {
   3.874062200678677*^9, 3.874062208464533*^9}, {3.874390414706092*^9, 
   3.874390417602138*^9}, 3.874395086010051*^9, {3.874398305711453*^9, 
   3.8743983071960907`*^9}, {3.874400182138673*^9, 3.874400237649761*^9}, {
   3.874400291147744*^9, 3.874400292156527*^9}, {3.874404694945841*^9, 
   3.87440471749612*^9}, {3.8744706494297523`*^9, 3.874470650124021*^9}, {
   3.8745575265616627`*^9, 3.8745575278459377`*^9}, {3.8750055604226513`*^9, 
   3.875005591622548*^9}, {3.8750057474027147`*^9, 3.875005748182899*^9}, {
   3.875007034467967*^9, 3.875007035006282*^9}, {3.875085700271628*^9, 
   3.8750857104125233`*^9}, {3.875085744769845*^9, 3.8750857558961267`*^9}, 
   3.87509199763717*^9, {3.87509259386423*^9, 3.875092604898686*^9}, {
   3.8751689820036497`*^9, 3.87516898556632*^9}, {3.875169757361759*^9, 
   3.8751697731110497`*^9}, {3.8751736630472307`*^9, 
   3.8751736634541397`*^9}, {3.875590919399149*^9, 3.8755909213430653`*^9}, 
   3.87561386056814*^9, {3.8759382242079153`*^9, 3.875938225226067*^9}, {
   3.8764515940646772`*^9, 3.876451601203299*^9}, {3.8764764227611647`*^9, 
   3.876476456459012*^9}, {3.876476504234042*^9, 3.876476522001642*^9}, 
   3.876476556050539*^9, {3.8764765931964703`*^9, 3.876476637341012*^9}, {
   3.8764767124266653`*^9, 3.8764767585222883`*^9}, {3.87647880385577*^9, 
   3.876478805062677*^9}, {3.8765412117400227`*^9, 3.876541216193763*^9}, 
   3.87654141617789*^9, {3.876544072152307*^9, 3.876544085015476*^9}, {
   3.8765446681838017`*^9, 3.876544676013085*^9}, 3.8765451311872587`*^9, {
   3.876545981524226*^9, 3.876545992057579*^9}, {3.876549628700348*^9, 
   3.8765496400346746`*^9}, {3.876552654922326*^9, 3.876552666236319*^9}, {
   3.8765531114297743`*^9, 3.876553121306868*^9}, {3.8765532825831547`*^9, 
   3.876553291383691*^9}, {3.876554149472795*^9, 3.876554158700481*^9}, {
   3.876554477292754*^9, 3.876554478229725*^9}, {3.876554568666531*^9, 
   3.876554578372072*^9}, {3.876554876872505*^9, 3.876554887278171*^9}, {
   3.876554932652501*^9, 3.876554948159121*^9}, {3.8765549861385117`*^9, 
   3.876555017687264*^9}, {3.8775883068837957`*^9, 3.877588309091662*^9}, {
   3.87769919755348*^9, 3.877699221631906*^9}, {3.8842594535952682`*^9, 
   3.884259489842861*^9}, 3.8853873118037786`*^9, {3.8854565310965223`*^9, 
   3.885456531751882*^9}, {3.885902014887568*^9, 3.8859020152114077`*^9}, {
   3.887433347066554*^9, 3.887433362912197*^9}, {3.8874334082818327`*^9, 
   3.887433409712965*^9}, {3.8874334639390783`*^9, 3.887433477524508*^9}, {
   3.887433560728463*^9, 3.887433624479241*^9}, {3.887433687942443*^9, 
   3.887433688726173*^9}, {3.887441165650762*^9, 3.887441170558424*^9}, {
   3.88785916628734*^9, 3.887859189679192*^9}, {3.887859229453341*^9, 
   3.887859230835679*^9}, {3.8883948796386137`*^9, 3.8883948807080383`*^9}, {
   3.888395070745466*^9, 3.888395191371517*^9}, {3.890114122383515*^9, 
   3.8901141743872833`*^9}, 3.890130964277749*^9, 3.890131144065652*^9, {
   3.890131304516203*^9, 3.890131345936509*^9}, {3.890149788811089*^9, 
   3.8901498084964*^9}, {3.890189376357831*^9, 3.890189382136073*^9}, {
   3.89087809953622*^9, 3.890878138804772*^9}, {3.890878174047179*^9, 
   3.8908781787468348`*^9}, {3.890878222747286*^9, 3.8908782647543907`*^9}, {
   3.890878338260988*^9, 3.890878358067317*^9}, {3.89088580486794*^9, 
   3.890885809859004*^9}, 3.890886086021397*^9, {3.890886440688209*^9, 
   3.890886442368664*^9}, 3.890886735037331*^9, 3.8908932423547707`*^9, {
   3.8910580347882643`*^9, 3.891058128979375*^9}, {3.8910581605631237`*^9, 
   3.891058269060792*^9}, 3.891065202989421*^9, {3.891065239995488*^9, 
   3.891065321467197*^9}, {3.891065414939633*^9, 3.8910655157077427`*^9}, 
   3.8910659056751013`*^9, {3.8910659826732893`*^9, 3.891065983162395*^9}, 
   3.891332005155711*^9, 3.891333626545979*^9, {3.8914164681859093`*^9, 
   3.8914164701012*^9}, {3.8915761463135643`*^9, 3.89157617386794*^9}, {
   3.89158126423907*^9, 3.891581386732595*^9}, {3.891590010588151*^9, 
   3.891590034099626*^9}, {3.891590085226859*^9, 3.891590143124735*^9}, {
   3.891590175463994*^9, 3.891590217886615*^9}},
 CellLabel->"In[1]:=",ExpressionUUID->"ad2d5759-89d8-40d3-a748-224610d23fcc"],

Cell[, "Input",ExpressionUUID->"2ecbf699-25b4-4183-8742-db4b06657a97"]
}, Closed]],

Cell[CellGroupData[{

Cell["PrefAmplStr calculate Pre-factors, Amplitudes and Strings ", "Section",
 InitializationCell->True,
 CellChangeTimes->{{3.8502124694131107`*^9, 3.850212483911498*^9}, {
  3.8508075976382303`*^9, 3.850807637386962*^9}, {3.85157491870508*^9, 
  3.8515749220559587`*^9}, {3.8515796859330683`*^9, 3.851579698913176*^9}, {
  3.877520426883108*^9, 3.877520427957204*^9}, {3.8874317974112186`*^9, 
  3.887431856185697*^9}, {3.890149733487874*^9, 3.890149738743699*^9}, {
  3.89106648426544*^9, 
  3.8910664985052423`*^9}},ExpressionUUID->"0161bfa9-ac96-4cca-a50b-\
f6602c447dc7"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"PrefAmplStr", "[", 
    RowBox[{"ClusterOperator_", ",", "EOMOperator_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "alphab", ",", "alphab1", ",", "ClusNum", ",", "EomNum", ",", 
       "EomNumClustNum", ",", "ClustOp", ",", "Bra", ",", "Ket", ",", 
       "NonTruncPolinom", ",", "TruncNum", ",", "TruncClustExp", ",", 
       "Coefficients", ",", "prueb", ",", "numop0", ",", "numop1", ",", 
       "numop2", ",", "Amplitudes", ",", "SQAmplitudes", ",", "StringF", ",", 
       "StringV", ",", "StringS"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"alphab", "=", 
       RowBox[{"{", 
        RowBox[{
        "Occ", ",", "p1", ",", "p2", ",", "p3", ",", "p4", ",", "p5", ",", 
         "p6", ",", "p7", ",", "p8", ",", "p9", ",", "p10", ",", "Vir", ",", 
         "h1", ",", "h2", ",", "h3", ",", "h4", ",", "h5", ",", "h6", ",", 
         "h7", ",", "h8", ",", "h9", ",", "h10"}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"alphab1", "=", 
       RowBox[{"{", 
        RowBox[{
        "Occ", ",", "v1", ",", "v2", ",", "v3", ",", "v4", ",", "v5", ",", 
         "v6", ",", "v7", ",", "v8", ",", "v9", ",", "v10", ",", "Vir", ",", 
         "o1", ",", "o2", ",", "o3", ",", "o4", ",", "o5", ",", "o6", ",", 
         "o7", ",", "o8", ",", "o9", ",", "o10"}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"ClusNum", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Cases", "[", 
          RowBox[{"#", ",", "_Integer"}], "]"}], "&"}], " ", "/@", 
        RowBox[{"ToExpression", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Flatten", "[", "#", "]"}], "&"}], "/@", 
          RowBox[{"Characters", " ", "@", "ClusterOperator"}]}], "]"}]}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"EomNum", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Cases", "[", 
          RowBox[{"#", ",", "_Integer"}], "]"}], "&"}], " ", "/@", 
        RowBox[{"ToExpression", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Flatten", "[", "#", "]"}], "&"}], "/@", 
          RowBox[{"Characters", " ", "@", "EOMOperator"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Determine", " ", "the", " ", "base", " ", "in", " ", "which", " ", 
        "The", " ", "similarity", " ", "transformed", " ", "Hamiltonian", " ",
         "is", " ", "diagobalized"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"EomNumClustNum", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Total", "[", 
           RowBox[{"Flatten", "[", "EomNum", "]"}], "]"}], "==", "0"}], ",", 
         "ClusNum", ",", "EomNum"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Bra", "=", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{"Map", "[", "SuperDagger", "]"}], "@", 
               RowBox[{"#", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], ",", 
              RowBox[{"Reverse", "[", 
               RowBox[{"#", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "}"}], "&"}], "@", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"alphab", "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"Flatten", "[", 
                   RowBox[{"Position", "[", 
                    RowBox[{"alphab", ",", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"Vir", ",", "Occ"}], "}"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}]}], "]"}], "]"}], "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "+", "1"}], ";;", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Flatten", "[", 
                   RowBox[{"Position", "[", 
                    RowBox[{"alphab", ",", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"Vir", ",", "Occ"}], "}"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}]}], "]"}], "]"}], "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "+", 
                 RowBox[{
                  RowBox[{"EomNumClustNum", "[", 
                   RowBox[{"[", "j1", "]"}], "]"}], "[", 
                  RowBox[{"[", "i1", "]"}], "]"}]}]}], "]"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i1", ",", 
               RowBox[{"Length", "[", 
                RowBox[{"EomNumClustNum", "[", 
                 RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}], 
          " ", "//", " ", "Flatten"}], "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"j1", ",", 
           RowBox[{"Length", "[", "EomNumClustNum", "]"}]}], "}"}]}], "]"}]}],
       ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"Ket", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{
                 RowBox[{"Map", "[", "SuperDagger", "]"}], "@", 
                 RowBox[{"#", "[", 
                  RowBox[{"[", "1", "]"}], "]"}]}], ",", 
                RowBox[{"Reverse", "[", 
                 RowBox[{"#", "[", 
                  RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "}"}], "&"}], "@", 
             "\[IndentingNewLine]", 
             RowBox[{"Reverse", "[", 
              RowBox[{"Table", "[", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"alphab", "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"Flatten", "[", 
                    RowBox[{"Position", "[", 
                    RowBox[{"alphab", ",", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"Vir", ",", "Occ"}], "}"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}]}], "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "+", 
                    RowBox[{
                    RowBox[{"EomNum", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "+", "1"}], ";;", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Flatten", "[", 
                    RowBox[{"Position", "[", 
                    RowBox[{"alphab", ",", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"Vir", ",", "Occ"}], "}"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}]}], "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "+", 
                    RowBox[{"2", 
                    RowBox[{
                    RowBox[{"EomNum", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}]}]}]}], "]"}], "]"}], ",", 
                
                RowBox[{"{", 
                 RowBox[{"i1", ",", 
                  RowBox[{"Length", "[", 
                   RowBox[{"EomNum", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
              "]"}]}], "//", " ", "Flatten"}], "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"j1", ",", 
             RowBox[{"Length", "[", "EomNum", "]"}]}], "}"}]}], "]"}]}], 
        ";"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Ket", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{"Map", "[", "SuperDagger", "]"}], "@", 
               RowBox[{"#", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], ",", 
              RowBox[{"Reverse", "[", 
               RowBox[{"#", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "}"}], "&"}], "@", 
           "\[IndentingNewLine]", 
           RowBox[{"Reverse", "[", 
            RowBox[{"Table", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"alphab", "[", 
               RowBox[{"[", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"Flatten", "[", 
                    RowBox[{"Position", "[", 
                    RowBox[{"alphab", ",", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"Vir", ",", "Occ"}], "}"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}]}], "]"}], "]"}], "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "+", 
                  RowBox[{"Max", "[", 
                   RowBox[{"Flatten", "[", "EomNumClustNum", "]"}], "]"}], 
                  "+", "1"}], ";;", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Flatten", "[", 
                    RowBox[{"Position", "[", 
                    RowBox[{"alphab", ",", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"Vir", ",", "Occ"}], "}"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}]}], "]"}], "]"}], "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "+", 
                  RowBox[{
                   RowBox[{"EomNum", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                   RowBox[{"[", "i1", "]"}], "]"}], "+", 
                  RowBox[{"Max", "[", 
                   RowBox[{"Flatten", "[", "EomNumClustNum", "]"}], "]"}]}]}],
                 "]"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"i1", ",", 
                RowBox[{"Length", "[", 
                 RowBox[{"EomNum", "[", 
                  RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
            "]"}]}], "//", " ", "Flatten"}], "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"j1", ",", 
           RowBox[{"Length", "[", "EomNum", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"ClustOp", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         SubscriptBox["T", "i1"], ",", 
         RowBox[{"{", 
          RowBox[{"i1", ",", 
           RowBox[{"ClusNum", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "1"}], "]"}], "]"}]}], "}"}]}], "]"}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Non", " ", "Truncated", " ", "Clsuter", " ", "Expansion"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"NonTruncPolinom", "=", 
       RowBox[{
        RowBox[{"Expand", "[", 
         RowBox[{
          RowBox[{"Normal", "[", 
           RowBox[{"Series", "[", 
            RowBox[{
             RowBox[{"Exp", "[", "p", "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"p", ",", "0", ",", "4"}], "}"}]}], "]"}], "]"}], " ", "/.",
           "  ", 
          RowBox[{"p", " ", "->", " ", 
           RowBox[{"(", 
            RowBox[{"ClustOp", " ", "//", " ", "Total"}], ")"}]}]}], "]"}], 
        " ", "/.", 
        RowBox[{"Plus", " ", "->", " ", "List"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         SubscriptBox["\[ScriptT]", "i1"], "=", 
         RowBox[{"Exponent", "[", 
          RowBox[{"NonTruncPolinom", ",", 
           SubscriptBox["T", "i1"]}], "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i1", ",", 
          RowBox[{"ClustOp", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "2"}], "]"}], "]"}]}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"TruncNum", "=", 
       RowBox[{"Position", "[", 
        RowBox[{
         RowBox[{"Sum", "[", 
          RowBox[{
           RowBox[{"2", "*", "i1", " ", 
            SubscriptBox["\[ScriptT]", "i1"]}], ",", 
           RowBox[{"{", 
            RowBox[{"i1", ",", 
             RowBox[{"ClustOp", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "2"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
         RowBox[{"_", "?", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"#", "<=", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"Max", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Length", "[", "#", "]"}], "&"}], "/@", "Bra"}], 
                 "]"}], "-", 
                RowBox[{"Min", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Length", "[", "#", "]"}], "&"}], "/@", "Ket"}], 
                 "]"}]}], ")"}], "+", "4"}]}], "&"}], ")"}]}]}], "]"}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Truncated", " ", "Cluster", " ", "Expancion"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"TruncClustExp", "=", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"NonTruncPolinom", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i1", ",", "TruncNum"}], "}"}]}], "]"}], "  ", "//", " ", 
        "Flatten"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"numop0", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Exponent", "[", 
          RowBox[{"TruncClustExp", ",", 
           SubscriptBox["T", "i1"]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i1", ",", 
           RowBox[{"ClustOp", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "2"}], "]"}], "]"}]}], "}"}]}], "]"}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"numop1", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"numop0", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], " ", 
          RowBox[{
           RowBox[{"ClustOp", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "2"}], "]"}], "]"}], "[", 
           RowBox[{"[", "i1", "]"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"i1", ",", 
           RowBox[{"Length", "[", "numop0", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"numop2", "=", " ", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Map", "[", "Total", "]"}], " ", "@", 
          RowBox[{"Transpose", "@", 
           RowBox[{"numop1", "[", 
            RowBox[{"[", 
             RowBox[{";;", "i1"}], "]"}], "]"}]}]}], ",", 
         RowBox[{"{", 
          RowBox[{"i1", ",", 
           RowBox[{"Length", "[", "numop1", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Coefficients", "=", 
       RowBox[{"TruncClustExp", " ", "/.", "  ", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           SubscriptBox["T", "i1"], "  ", "->", " ", 
           RowBox[{"1", "/", 
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{"i1", "!"}], ")"}], "2"]}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i1", ",", 
            RowBox[{"ClustOp", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", "2"}], "]"}], "]"}]}], "}"}]}], "]"}]}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Extract", " ", "and", " ", "sort", " ", "the", " ", "letter", " ", 
        "from", " ", "the", " ", "aphabet", " ", "to", " ", "generate", " ", 
        "the", " ", "excitation"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"prueb", "=", "\[IndentingNewLine]", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"Table", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Flatten", "[", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"numop1", "[", 
                   RowBox[{"[", "k1", "]"}], "]"}], "[", 
                  RowBox[{"[", "j1", "]"}], "]"}], "==", "0"}], "||", 
                RowBox[{"k1", "<=", "1"}]}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"alphab1", "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Flatten", "[", 
                    RowBox[{"Position", "[", 
                    RowBox[{"alphab1", ",", "Vir"}], "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ";;", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Flatten", "[", 
                    RowBox[{"Position", "[", 
                    RowBox[{"alphab1", ",", "Vir"}], "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "+", 
                    RowBox[{
                    RowBox[{"numop1", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}]}]}], "]"}], "]"}], ",", 
                 RowBox[{"alphab1", "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Flatten", "[", 
                    RowBox[{"Position", "[", 
                    RowBox[{"alphab1", ",", "Occ"}], "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ";;", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Flatten", "[", 
                    RowBox[{"Position", "[", 
                    RowBox[{"alphab1", ",", "Occ"}], "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "+", 
                    RowBox[{
                    RowBox[{"numop1", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}]}]}], "]"}], "]"}]}], 
                "}"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"alphab1", "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Flatten", "[", 
                    RowBox[{"Position", "[", 
                    RowBox[{"alphab1", ",", "Vir"}], "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "+", "1", "+", 
                    RowBox[{
                    RowBox[{"numop2", "[", 
                    RowBox[{"[", 
                    RowBox[{"k1", "-", "1"}], "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}]}], ";;", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Flatten", "[", 
                    RowBox[{"Position", "[", 
                    RowBox[{"alphab1", ",", "Vir"}], "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "+", 
                    RowBox[{
                    RowBox[{"numop2", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}]}]}], "]"}], "]"}], ",", 
                 RowBox[{"alphab1", "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Flatten", "[", 
                    RowBox[{"Position", "[", 
                    RowBox[{"alphab1", ",", "Occ"}], "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "+", "1", "+", 
                    RowBox[{
                    RowBox[{"numop2", "[", 
                    RowBox[{"[", 
                    RowBox[{"k1", "-", "1"}], "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}]}], ";;", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Flatten", "[", 
                    RowBox[{"Position", "[", 
                    RowBox[{"alphab1", ",", "Occ"}], "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "+", 
                    RowBox[{
                    RowBox[{"numop2", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}]}]}], "]"}], "]"}]}], 
                "}"}]}], "]"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"j1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{"numop2", "[", 
                RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
          "  ", "/.", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Vir", "->", 
             RowBox[{"Sequence", "[", "]"}]}], ",", 
            RowBox[{"Occ", "->", 
             RowBox[{"Sequence", "[", "]"}]}]}], "}"}]}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"k1", ",", 
           RowBox[{"Length", "[", "numop2", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Obtain", " ", "the", " ", "Coupled", " ", "Cluster", " ", 
        "amplitudes"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Amplitudes", "=", 
       RowBox[{"{", 
        RowBox[{"Prepend", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Map", "[", "Flatten", "]"}], "@", 
            RowBox[{"Transpose", " ", "@", 
             RowBox[{"Table", "[", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"Table", "[", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"Table", "[", "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{
                    SubscriptBox["t", 
                    RowBox[{
                    RowBox[{"ClustOp", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}]], "@", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"numop1", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "===", 
                    RowBox[{"{", "}"}]}], ",", 
                    RowBox[{
                    RowBox[{"prueb", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], ",", 
                    RowBox[{"Partition", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"prueb", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{"ClustOp", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{"numop1", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], ",", 
                    RowBox[{"-", "j1"}]}], "]"}]}], "]"}], "]"}]}], 
                   "\[IndentingNewLine]", ",", 
                   RowBox[{"{", 
                    RowBox[{"j1", ",", 
                    RowBox[{"Table", "[", 
                    RowBox[{"i1", ",", 
                    RowBox[{"{", 
                    RowBox[{"i1", ",", 
                    RowBox[{
                    RowBox[{"ClustOp", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{"numop1", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{"ClustOp", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}]}], "}"}]}], "]"}]}], 
                    "}"}]}], "]"}], "\[IndentingNewLine]", ",", 
                 RowBox[{"{", 
                  RowBox[{"k1", ",", 
                   RowBox[{"Length", "[", 
                    RowBox[{"numop1", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
               "\[IndentingNewLine]", ",", 
               RowBox[{"{", 
                RowBox[{"l1", ",", 
                 RowBox[{"Length", "[", "numop1", "]"}]}], "}"}]}], "]"}]}]}],
            " ", "/.", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", "}"}], "->", " ", 
             RowBox[{"Sequence", "[", "]"}]}], "}"}]}], ",", 
          RowBox[{"{", "}"}]}], "]"}], "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Obtain", " ", "the", " ", "Secaond", " ", "quantized", " ", 
        "operators", " ", "asociated", " ", "with", " ", "Coupled", " ", 
        "Cluster", " ", "amplitudes"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"SQAmplitudes", "=", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Flatten", "[", 
             RowBox[{
              RowBox[{"Amplitudes", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "[", 
              RowBox[{"[", "m1", "]"}], "]"}], "]"}], "===", 
            RowBox[{"{", "}"}]}], ",", 
           RowBox[{
            RowBox[{"Amplitudes", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "[", 
            RowBox[{"[", "m1", "]"}], "]"}], ",", 
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Flatten", "[", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Amplitudes", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{";;", 
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Amplitudes", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "/", "2"}]}], 
                    "]"}], "]"}], ",", 
                   RowBox[{
                    RowBox[{"Map", "[", "SuperDagger", "]"}], "@", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Amplitudes", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Amplitudes", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "/", "2"}], "+", 
                    "1"}], ";;"}], "]"}], "]"}]}]}], "}"}], "]"}], "[", 
                RowBox[{"[", "k1", "]"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"k1", ",", 
                 RowBox[{"Flatten", "[", 
                  RowBox[{"Reverse", "/@", 
                   RowBox[{"Transpose", "@", 
                    RowBox[{"Partition", "[", 
                    RowBox[{
                    RowBox[{"Table", "[", 
                    RowBox[{"i1", ",", 
                    RowBox[{"{", 
                    RowBox[{"i1", ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Amplitudes", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
                    ",", 
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Amplitudes", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "/", "2"}]}], 
                    "]"}]}]}], "]"}]}], "}"}]}], "]"}], "\[IndentingNewLine]",
              ",", 
             RowBox[{"{", 
              RowBox[{"l1", ",", 
               RowBox[{"Length", "[", 
                RowBox[{
                 RowBox[{"Amplitudes", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "[", 
                 RowBox[{"[", "m1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}], 
          "]"}], "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"m1", ",", 
           RowBox[{"Length", "[", 
            RowBox[{"Amplitudes", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Bra", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Total", "[", 
           RowBox[{"Flatten", "[", "EomNum", "]"}], "]"}], "==", "0"}], ",", 
         RowBox[{"Insert", "[", 
          RowBox[{"Bra", ",", 
           RowBox[{"{", "}"}], ",", "1"}], "]"}], ",", "Bra"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"StringF", "=", "\[IndentingNewLine]", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Bra", "[", 
                RowBox[{"[", "l1", "]"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 SuperscriptBox["q1", "\[Dagger]"], ",", "q2"}], "}"}], ",", 
               RowBox[{"SQAmplitudes", "[", 
                RowBox[{"[", "j1", "]"}], "]"}], ",", 
               RowBox[{"Ket", "[", 
                RowBox[{"[", "k1", "]"}], "]"}]}], "}"}], 
             "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"j1", ",", 
               RowBox[{"Length", "[", "SQAmplitudes", "]"}]}], "}"}]}], "]"}],
            "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"k1", ",", 
             RowBox[{"Length", "[", "Ket", "]"}]}], "}"}]}], "]"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"l1", ",", 
           RowBox[{"Length", "[", "Bra", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"StringV", "=", "\[IndentingNewLine]", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Bra", "[", 
                RowBox[{"[", "l1", "]"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 SuperscriptBox["q1", "\[Dagger]"], ",", 
                 SuperscriptBox["q2", "\[Dagger]"], ",", "q4", ",", "q3"}], 
                "}"}], ",", 
               RowBox[{"SQAmplitudes", "[", 
                RowBox[{"[", "j1", "]"}], "]"}], ",", 
               RowBox[{"Ket", "[", 
                RowBox[{"[", "k1", "]"}], "]"}]}], "}"}], 
             "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"j1", ",", 
               RowBox[{"Length", "[", "SQAmplitudes", "]"}]}], "}"}]}], "]"}],
            "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"k1", ",", 
             RowBox[{"Length", "[", "Ket", "]"}]}], "}"}]}], "]"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"l1", ",", 
           RowBox[{"Length", "[", "Bra", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"StringS", "=", 
       RowBox[{"{", 
        RowBox[{"StringF", ",", "StringV"}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{"{", 
        RowBox[{"Coefficients", ",", "Amplitudes", ",", "StringS"}], "}"}], 
       "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.876469479707465*^9, 3.876469541626397*^9}, {
   3.876469833025949*^9, 3.876469834295375*^9}, {3.876469962692398*^9, 
   3.8764700219866323`*^9}, {3.876470087520525*^9, 3.8764701116505938`*^9}, {
   3.876470361899016*^9, 3.87647039448167*^9}, 3.876827662335021*^9, 
   3.876827801970155*^9, {3.8873557883372517`*^9, 3.887355789959927*^9}, 
   3.887447999616041*^9, 3.888389426186451*^9, 3.8883894899811573`*^9, {
   3.89014971678718*^9, 3.890149717984064*^9}, {3.8901513834893312`*^9, 
   3.890151417086669*^9}, 3.890179907040265*^9, {3.890189333464217*^9, 
   3.890189340494206*^9}, {3.890190296251422*^9, 3.890190304545581*^9}, {
   3.890227441294989*^9, 3.890227450215667*^9}, 3.8908132111025352`*^9, {
   3.8908136271019087`*^9, 3.8908136569625797`*^9}, {3.890877463341674*^9, 
   3.890877481823605*^9}, 3.890879378582157*^9, {3.8910577214177313`*^9, 
   3.8910577214337273`*^9}, {3.8910595688482733`*^9, 
   3.8910595847617683`*^9}, {3.891331089315598*^9, 3.891331132611553*^9}, {
   3.891332136350214*^9, 3.89133213743365*^9}, {3.891332171915275*^9, 
   3.8913321999752293`*^9}, 3.891332355168339*^9, {3.891419456808421*^9, 
   3.891419459214349*^9}, {3.8914195287818117`*^9, 3.891419585109877*^9}, {
   3.891420099553585*^9, 3.8914201001067333`*^9}, {3.891581183709898*^9, 
   3.8915812051316547`*^9}},
 CellLabel->"In[10]:=",ExpressionUUID->"2436486f-eeec-469a-ab38-0b8dd8542b64"]
}, Closed]],

Cell[CellGroupData[{

Cell[TextData[{
 "ManyBodyHamiltonian generate many-body terms  ",
 Cell[BoxData[
  FormBox[
   RowBox[{"{", 
    RowBox[{
     SubscriptBox["\[Chi]", 
      RowBox[{"p", ",", "q"}]], ",", 
     SubscriptBox["\[Chi]", 
      RowBox[{"p", ",", "q", ",", "r", ",", "s"}]], ",", 
     SubscriptBox["\[Chi]", 
      RowBox[{"p", ",", "q", ",", "r", ",", "s", ",", "t", ",", "u", ","}]], 
     ",", "..."}], "}"}], TraditionalForm]],ExpressionUUID->
  "b25013cd-b782-4c82-bca2-8890561630fc"]
}], "Section",
 InitializationCell->True,
 CellChangeTimes->{{3.8502124694131107`*^9, 3.850212483911498*^9}, {
  3.8508075976382303`*^9, 3.850807637386962*^9}, {3.85157491870508*^9, 
  3.8515749220559587`*^9}, {3.8515796859330683`*^9, 3.851579698913176*^9}, {
  3.877520426883108*^9, 3.877520427957204*^9}, {3.884340155021543*^9, 
  3.88434027692699*^9}, {3.887431783420391*^9, 3.887431793894289*^9}, {
  3.887431858495245*^9, 3.887431858530387*^9}, {3.891066509502339*^9, 
  3.891066513849218*^9}},ExpressionUUID->"5c729b93-e4ec-40a4-bfbd-\
8ff5fa424dcf"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ManyBodyHamiltonian", "[", "StringS_", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "StringT", ",", "SQBraKet", ",", "lCre", ",", "lAnh", ",", 
      "ExternContract", ",", "ExtDelKron", ",", "PreInter", ",", "DelKron2", 
      ",", "ManbodyTerms0", ",", "ManbodyTerms1", ",", "ManyBodyTermsV", ",", 
      "ManyBodyTermsF", ",", "PosManyBody0", ",", "ManyBodyBlock0", ",", 
      "DelKron1", ",", "ManyBodyBlock1", ",", "TFHolesMB0", ",", "TFHolesMB1",
       ",", "PositZeroTerms", ",", "ManyBodyBlock2", ",", "PositZeroTerms1", 
      ",", "ManyBodyBlock3", ",", "ManyBodyBlock4", ",", "ManyBodyHOp0", ",", 
      "ManyBodyHOp1", ",", "MBTwS0", ",", "MBTwS1", ",", "MBTwS2", ",", 
      "SepBraKet", ",", "ConractManyBodyStr", ",", "KronMany", ",", 
      "StringBraHamKet", ",", "SignManyBody", ",", "PreManyBody", ",", 
      "ManyBodyTerms"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"StringT", "=", 
      RowBox[{"StringS", "[", 
       RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Exctract", " ", "the", " ", "Second", " ", "Quantization", " ", 
       "operators", " ", "form", " ", "the", " ", "Bra", " ", "and", " ", 
       "the", " ", "Ket"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"SQBraKet", "=", 
      RowBox[{"Table", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"StringT", "[", 
                RowBox[{"[", "j1", "]"}], "]"}], "[", 
               RowBox[{"[", "i1", "]"}], "]"}], "[", 
              RowBox[{"[", "1", "]"}], "]"}], "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"StringT", "[", 
                RowBox[{"[", "j1", "]"}], "]"}], "[", 
               RowBox[{"[", "i1", "]"}], "]"}], "[", 
              RowBox[{"[", "1", "]"}], "]"}], "[", 
             RowBox[{"[", "4", "]"}], "]"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"i1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{"StringT", "[", 
              RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
        "\[IndentingNewLine]", ",", 
        RowBox[{"{", 
         RowBox[{"j1", ",", 
          RowBox[{"Length", "[", "StringT", "]"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"lCre", "=", 
      RowBox[{
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"SQBraKet", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                   RowBox[{"[", "0", "]"}], "]"}], "===", "SuperDagger"}], 
                 ",", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"SQBraKet", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                   RowBox[{"[", "j1", "]"}], "]"}], "[", 
                  RowBox[{"[", "i1", "]"}], "]"}]}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"i1", ",", 
                 RowBox[{"Length", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"SQBraKet", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                   RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
             "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"j1", ",", 
               RowBox[{"Length", "[", 
                RowBox[{
                 RowBox[{"SQBraKet", "[", 
                  RowBox[{"[", "l1", "]"}], "]"}], "[", 
                 RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"k1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"SQBraKet", "[", 
               RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
         
         RowBox[{"{", 
          RowBox[{"l1", ",", 
           RowBox[{"Length", "[", "SQBraKet", "]"}]}], "}"}]}], "]"}], " ", "/.",
        " ", 
       RowBox[{"Null", " ", "->", " ", 
        RowBox[{"Sequence", "[", "]"}]}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"lAnh", "=", 
      RowBox[{
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"SQBraKet", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                   RowBox[{"[", "0", "]"}], "]"}], "===", "SuperDagger"}], 
                 ",", "Null", ",", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"SQBraKet", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                   RowBox[{"[", "j1", "]"}], "]"}], "[", 
                  RowBox[{"[", "i1", "]"}], "]"}]}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"i1", ",", 
                 RowBox[{"Length", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"SQBraKet", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                   RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
             "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"j1", ",", 
               RowBox[{"Length", "[", 
                RowBox[{
                 RowBox[{"SQBraKet", "[", 
                  RowBox[{"[", "l1", "]"}], "]"}], "[", 
                 RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"k1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"SQBraKet", "[", 
               RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
         
         RowBox[{"{", 
          RowBox[{"l1", ",", 
           RowBox[{"Length", "[", "SQBraKet", "]"}]}], "}"}]}], "]"}], "/.", 
       " ", 
       RowBox[{"Null", " ", "->", " ", 
        RowBox[{"Sequence", "[", "]"}]}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Quick", " ", 
       RowBox[{"Wick", "'"}], "s", " ", "Contract", " ", "between", " ", 
       "the", " ", "Bra", " ", "and", " ", "the", " ", "Ket"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"ExternContract", "=", "\[IndentingNewLine]", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Length", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"SQBraKet", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                   RowBox[{"[", "j1", "]"}], "]"}], "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "]"}], ">=", 
                RowBox[{
                 RowBox[{"Length", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"SQBraKet", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                   RowBox[{"[", "2", "]"}], "]"}], "]"}], "+", "i1"}]}], ",", 
               "Null", ",", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"Element", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"SQBraKet", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "+", 
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"SQBraKet", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "]"}], "-", "i1"}], ",", 
                   "NegativeIntegers"}], "]"}], ",", "Null", ",", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"SQBraKet", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "+", 
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"SQBraKet", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "]"}], "-", "i1"}], ")"}],
                     "/", "2"}], ")"}], ">", 
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"SQBraKet", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ",", "Null", ",", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"SQBraKet", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "+", 
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"SQBraKet", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "]"}], "-", "i1"}], ")"}],
                     "/", "2"}], ")"}]}], "]"}]}], "]"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i1", ",", 
               RowBox[{"{", 
                RowBox[{"2", ",", "4", ",", "6", ",", "8", ",", "10"}], 
                "}"}]}], "}"}]}], "]"}], "  ", "/.", " ", 
           RowBox[{"Null", " ", "->", " ", 
            RowBox[{"Sequence", "[", "]"}]}]}], "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"j1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{"SQBraKet", "[", 
              RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"k1", ",", 
          RowBox[{"Length", "[", "SQBraKet", "]"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ExtDelKron", "=", 
      RowBox[{"Table", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Table", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Table", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"permbraket", "=", 
              RowBox[{"Subsets", "[", 
               RowBox[{
                RowBox[{"Union", "[", 
                 RowBox[{
                  RowBox[{"Tuples", "[", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"lCre", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"lAnh", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "}"}], "]"}], ",", 
                  RowBox[{"Tuples", "[", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"lAnh", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"lCre", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "}"}], "]"}]}], "]"}], 
                ",", 
                RowBox[{"{", "j1", "}"}]}], "]"}]}], " ", ";", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Length", "[", 
                    RowBox[{"DeleteDuplicates", "[", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{"permbraket", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "]"}], "]"}], "]"}], "==",
                    " ", 
                   RowBox[{"2", "*", "j1"}]}], ",", 
                  RowBox[{"permbraket", "[", 
                   RowBox[{"[", "i1", "]"}], "]"}]}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"i1", ",", 
                  RowBox[{"Length", "[", "permbraket", "]"}]}], "}"}]}], 
               "]"}], " ", "/.", " ", 
              RowBox[{"Null", " ", "->", " ", 
               RowBox[{"Sequence", "[", "]"}]}]}]}], "\[IndentingNewLine]", 
            ",", 
            RowBox[{"{", 
             RowBox[{"j1", ",", 
              RowBox[{
               RowBox[{"ExternContract", "[", 
                RowBox[{"[", "l1", "]"}], "]"}], "[", 
               RowBox[{"[", "k1", "]"}], "]"}]}], "}"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"k1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{"ExternContract", "[", 
              RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
        "\[IndentingNewLine]", ",", 
        RowBox[{"{", 
         RowBox[{"l1", ",", 
          RowBox[{"Length", "[", "ExternContract", "]"}]}], "}"}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"Remove", "  ", "the", " ", "many"}], "-", 
       RowBox[{
       "body", " ", "terms", " ", "in", " ", "each", " ", "block", " ", "of", 
        " ", "the", " ", "EOM"}], "-", 
       RowBox[{"CC", " ", "matrix"}]}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"PreInter", "=", "\[IndentingNewLine]", 
      RowBox[{"Table", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Table", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"Table", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Length", "/@", " ", 
               RowBox[{"Table", "[", 
                RowBox[{
                 RowBox[{"DeleteCases", "[", 
                  RowBox[{"i1", ",", 
                   RowBox[{"Alternatives", "@@", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"ExtDelKron", "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "]"}]}]}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"i1", ",", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"lCre", "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"lAnh", "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"lCre", "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"lAnh", "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "}"}]}], "}"}]}], 
                "]"}]}], "\[IndentingNewLine]", ",", 
              RowBox[{"{", 
               RowBox[{"j1", ",", 
                RowBox[{"Length", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"ExtDelKron", "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                   RowBox[{"[", "l1", "]"}], "]"}], "[", 
                  RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
            " ", ",", 
            RowBox[{"{", 
             RowBox[{"k1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{
                RowBox[{"ExtDelKron", "[", 
                 RowBox[{"[", "m1", "]"}], "]"}], "[", 
                RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
          "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"l1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{"ExtDelKron", "[", 
              RowBox[{"[", "m1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
        "\[IndentingNewLine]", ",", 
        RowBox[{"{", 
         RowBox[{"m1", ",", 
          RowBox[{"Length", "[", "ExtDelKron", "]"}]}], "}"}]}], "]"}]}], ";",
      "\[IndentingNewLine]", 
     RowBox[{"DelKron2", "=", 
      RowBox[{
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"Subscript", "[", 
                RowBox[{"\[Chi]", ",", "#"}], "]"}], "&"}], "/@", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"ExtDelKron", "[", 
                  RowBox[{"[", "l1", "]"}], "]"}], "[", 
                 RowBox[{"[", "k1", "]"}], "]"}], "[", 
                RowBox[{"[", "j1", "]"}], "]"}], "[", 
               RowBox[{"[", 
                RowBox[{
                 RowBox[{"Table", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"GatherBy", "[", 
                    RowBox[{
                    RowBox[{"Range", "@", 
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"PreInter", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "]"}]}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"PreInter", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "#", "]"}], "]"}], "&"}]}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"i1", ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{"PreInter", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
                 "[", 
                 RowBox[{"[", "j1", "]"}], "]"}], "]"}], "]"}]}], 
             "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"j1", ",", 
               RowBox[{"Length", "[", 
                RowBox[{
                 RowBox[{"ExtDelKron", "[", 
                  RowBox[{"[", "l1", "]"}], "]"}], "[", 
                 RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
           "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"k1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"ExtDelKron", "[", 
               RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"l1", ",", 
           RowBox[{"Length", "[", "ExtDelKron", "]"}]}], "}"}]}], "]"}], " ", 
       "//", " ", "Flatten"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Obtain", " ", "all", " ", "the", "  ", "many", " ", "body", " ", 
       "terms"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"ManbodyTerms0", "=", 
      RowBox[{
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Table", "[", " ", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Table", "[", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"Subscript", "[", 
                RowBox[{"\[Chi]", ",", 
                 RowBox[{"Table", "[", "\[IndentingNewLine]", " ", 
                  RowBox[{
                   RowBox[{"DeleteCases", "[", 
                    RowBox[{"i1", ",", 
                    RowBox[{"Alternatives", "@@", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"ExtDelKron", "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "]"}]}]}], "]"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"i1", ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"lCre", "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"lAnh", "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"lCre", "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"lAnh", "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "}"}]}], "}"}]}], 
                  "]"}]}], "]"}], "\[IndentingNewLine]", ",", 
               RowBox[{"{", 
                RowBox[{"j1", ",", 
                 RowBox[{
                  RowBox[{"Table", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"GatherBy", "[", 
                    RowBox[{
                    RowBox[{"Range", "@", 
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"PreInter", "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "]"}]}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"PreInter", "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "#", "]"}], "]"}], "&"}]}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"i1", ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{"PreInter", "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
                  "[", 
                  RowBox[{"[", "k1", "]"}], "]"}]}], "}"}]}], "]"}], " ", 
             "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"k1", ",", 
               RowBox[{"Length", "[", 
                RowBox[{
                 RowBox[{"ExtDelKron", "[", 
                  RowBox[{"[", "m1", "]"}], "]"}], "[", 
                 RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
           "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"l1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"ExtDelKron", "[", 
               RowBox[{"[", "m1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
         
         RowBox[{"{", 
          RowBox[{"m1", ",", 
           RowBox[{"Length", "[", "ExtDelKron", "]"}]}], "}"}]}], "]"}], "//",
        " ", "Flatten"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
       "Impose", " ", "a", " ", "condition", " ", "to", " ", "remove", " ", 
        "the", " ", "blocks", " ", "that", " ", "corresponds", " ", "to", " ",
         "CC", " ", "in", " ", "the", " ", "many"}], "-", 
       RowBox[{"body", " ", "terms", " ", "list"}]}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"ManbodyTerms1", "=", 
      RowBox[{
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"ManbodyTerms0", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], "[", 
          RowBox[{"[", "2", "]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i1", ",", 
           RowBox[{"Length", "[", "ManbodyTerms0", "]"}]}], "}"}]}], "]"}], 
       " ", "[", 
       RowBox[{"[", 
        RowBox[{
         RowBox[{"GatherBy", "[", 
          RowBox[{
           RowBox[{"Range", "@", 
            RowBox[{"Length", "[", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"Length", " ", "/@", 
                RowBox[{
                 RowBox[{"ManbodyTerms0", "[", 
                  RowBox[{"[", "i1", "]"}], "]"}], "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], ",", 
               RowBox[{"{", 
                RowBox[{"i1", ",", 
                 RowBox[{"Length", "[", "ManbodyTerms0", "]"}]}], "}"}]}], 
              "]"}], " ", "]"}]}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"Length", " ", "/@", 
                RowBox[{
                 RowBox[{"ManbodyTerms0", "[", 
                  RowBox[{"[", "i1", "]"}], "]"}], "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], ",", 
               RowBox[{"{", 
                RowBox[{"i1", ",", 
                 RowBox[{"Length", "[", "ManbodyTerms0", "]"}]}], "}"}]}], 
              "]"}], " ", "[", 
             RowBox[{"[", "#", "]"}], "]"}], "&"}]}], "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "1"}], "]"}], "]"}], "]"}], "]"}]}], " ", ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
       "Impose", " ", "a", " ", "condition", " ", "to", " ", "remove", " ", 
        "the", " ", "blocks", " ", "that", " ", "corresponds", " ", "to", " ",
         "CC", " ", "in", " ", "the", " ", "many"}], "-", 
       RowBox[{"body", " ", "terms", " ", "list"}]}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"ManbodyTerms1", "=", 
      RowBox[{"Delete", "[", 
       RowBox[{"ManbodyTerms1", ",", 
        RowBox[{"Position", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", 
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "]"}], "&"}], "/@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"Flatten", "[", 
                 RowBox[{"#", ",", "2"}], "]"}], "&"}], "/@", 
               RowBox[{"Partition", "[", 
                RowBox[{"#", ",", "2"}], "]"}]}], "&"}], "/@", 
             "ManbodyTerms1"}], ")"}]}], ",", 
          RowBox[{"N_", "/;", 
           RowBox[{"N", ">=", "4"}]}]}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ManbodyTerms1", "=", 
      RowBox[{"Delete", "[", 
       RowBox[{"ManbodyTerms1", ",", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"{", "#", "}"}], "&"}], "/@", 
           RowBox[{"Flatten", "[", "#", "]"}]}], "&"}], "@", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Position", "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"Count", "[", 
                 RowBox[{
                  RowBox[{"#", "[", 
                   RowBox[{"[", "2", "]"}], "]"}], ",", 
                  RowBox[{"n_", "/;", 
                   RowBox[{
                    RowBox[{"n", "[", 
                    RowBox[{"[", "0", "]"}], "]"}], "===", 
                    "SuperDagger"}]}]}], "]"}], "&"}], "/@", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"Flatten", "[", 
                    RowBox[{"#", ",", "2"}], "]"}], "&"}], "/@", 
                   RowBox[{"Partition", "[", 
                    RowBox[{"#", ",", "2"}], "]"}]}], "&"}], "/@", 
                 "ManbodyTerms1"}], ")"}]}], ")"}], ",", 
             RowBox[{"N_", "/;", 
              RowBox[{"N", ">", "2"}]}]}], "]"}], ",", "\[IndentingNewLine]", 
           
           RowBox[{"Position", "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"Count", "[", 
                 RowBox[{
                  RowBox[{"#", "[", 
                   RowBox[{"[", "2", "]"}], "]"}], ",", 
                  RowBox[{"n_", "/;", 
                   RowBox[{
                    RowBox[{"n", "[", 
                    RowBox[{"[", "0", "]"}], "]"}], "=!=", 
                    "SuperDagger"}]}]}], "]"}], "&"}], "/@", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"Flatten", "[", 
                    RowBox[{"#", ",", "2"}], "]"}], "&"}], "/@", 
                   RowBox[{"Partition", "[", 
                    RowBox[{"#", ",", "2"}], "]"}]}], "&"}], "/@", 
                 "ManbodyTerms1"}], ")"}]}], ")"}], ",", 
             RowBox[{"N_", "/;", 
              RowBox[{"N", ">", "2"}]}]}], "]"}]}], "}"}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ManyBodyTermsV", "=", 
      RowBox[{"Table", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Table", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Insert", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Flatten", "[", 
               RowBox[{
                RowBox[{"ManbodyTerms1", "[", 
                 RowBox[{"[", "k1", "]"}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{"1", ";;", "2"}], "]"}], "]"}], "]"}], ",", 
              RowBox[{"Flatten", "[", 
               RowBox[{
                RowBox[{"ManbodyTerms1", "[", 
                 RowBox[{"[", "k1", "]"}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{"3", ";;", "4"}], "]"}], "]"}], "]"}]}], "}"}], ",", 
            
            RowBox[{"Unevaluated", "[", 
             RowBox[{"Sequence", "@@", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"StringT", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "[", 
                RowBox[{"[", "i1", "]"}], "]"}], "[", 
               RowBox[{"[", 
                RowBox[{"2", ";;", "3"}], "]"}], "]"}]}], "]"}], ",", "2"}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{
              RowBox[{"StringT", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
        "\[IndentingNewLine]", ",", 
        RowBox[{"{", 
         RowBox[{"k1", ",", 
          RowBox[{"Length", "[", "ManbodyTerms1", "]"}]}], "}"}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"ManyBodyTermsF", "=", 
      RowBox[{"Table", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Table", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Insert", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Flatten", "[", 
               RowBox[{
                RowBox[{"ManbodyTerms1", "[", 
                 RowBox[{"[", "k1", "]"}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{"1", ";;", "2"}], "]"}], "]"}], "]"}], ",", 
              RowBox[{"Flatten", "[", 
               RowBox[{
                RowBox[{"ManbodyTerms1", "[", 
                 RowBox[{"[", "k1", "]"}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{"3", ";;", "4"}], "]"}], "]"}], "]"}]}], "}"}], ",", 
            
            RowBox[{"Unevaluated", "[", 
             RowBox[{"Sequence", "@@", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"StringS", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "[", 
                RowBox[{"[", "i1", "]"}], "]"}], "[", 
               RowBox[{"[", 
                RowBox[{"2", ";;", "3"}], "]"}], "]"}]}], "]"}], ",", "2"}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"StringS", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "[", 
               RowBox[{"[", "1", "]"}], "]"}], "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
        "\[IndentingNewLine]", ",", 
        RowBox[{"{", 
         RowBox[{"k1", ",", 
          RowBox[{"Length", "[", "ManbodyTerms1", "]"}]}], "}"}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"Fron", " ", "here", " ", "the", " ", "EOM"}], "-", 
       RowBox[{
       "CC", " ", "equations", " ", "in", " ", "terms", " ", "of", " ", 
        "many", " ", "body", " ", "terms", "  ", "are", " ", "generated"}]}], 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"PosManyBody0", "=", 
      RowBox[{"Table", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Table", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Table", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"Flatten", "[", "#", "]"}], "&"}], "@", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"Position", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Sort", "[", "#", "]"}], "&"}], "@", 
                    RowBox[{"Flatten", "[", "#", "]"}]}], "&"}], "/@", 
                   "ManbodyTerms1"}], ",", "#"}], "]"}], "&"}], "/@", 
               RowBox[{"Intersection", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"Sort", "[", "#", "]"}], "&"}], "/@", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Complement", "[", 
                    RowBox[{
                    RowBox[{"Flatten", "[", 
                    RowBox[{
                    RowBox[{"SQBraKet", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "]"}], ",", "#"}], "]"}],
                     "&"}], "@", 
                    RowBox[{"Flatten", "[", "#", "]"}]}], "&"}], "/@", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"ExtDelKron", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}]}], ")"}]}], ",", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"Sort", "[", "#", "]"}], "&"}], "@", 
                    RowBox[{"Flatten", "[", "#", "]"}]}], "&"}], "/@", 
                  "ManbodyTerms1"}]}], "]"}]}], ")"}]}], 
            "\[IndentingNewLine]", ",", 
            RowBox[{"{", 
             RowBox[{"i1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{
                RowBox[{"ExtDelKron", "[", 
                 RowBox[{"[", "k1", "]"}], "]"}], "[", 
                RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
          "  ", "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"j1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{"SQBraKet", "[", 
              RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
        "\[IndentingNewLine]", ",", 
        RowBox[{"{", 
         RowBox[{"k1", ",", 
          RowBox[{"Length", "[", "SQBraKet", "]"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
       "obtain", " ", "all", " ", "the", " ", "strings", " ", "of", " ", 
        "the", " ", "bra", " ", "and", " ", "ket", " ", "for", " ", "each", 
        " ", "block", " ", "and", " ", "for", " ", "each", " ", 
        "intermediate", "\[IndentingNewLine]", "Positions", " ", "of", " ", 
        "the", " ", "Many"}], "-", 
       RowBox[{
       "Body", " ", "Terms", " ", "in", " ", "each", " ", "block", " ", "of", 
        " ", "delta", " ", "Kroneckers"}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"ManyBodyBlock0", "=", 
      RowBox[{"Table", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Table", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Table", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"Sort", "[", "#", "]"}], "&"}], "/@", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"Flatten", "[", "#", "]"}], "&"}], "/@", 
                "ManbodyTerms1"}], ")"}], "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"PosManyBody0", " ", "/.", " ", 
                    RowBox[{
                    RowBox[{"{", "}"}], "->", " ", 
                    RowBox[{"Sequence", "[", "]"}]}]}], " ", "/.", "  ", 
                    RowBox[{
                    RowBox[{"{", "}"}], "->", " ", 
                    RowBox[{"Sequence", "[", "]"}]}]}], ")"}], "[", 
                  RowBox[{"[", "k1", "]"}], "]"}], "[", 
                 RowBox[{"[", "j1", "]"}], "]"}], "[", 
                RowBox[{"[", "i1", "]"}], "]"}], " ", "]"}], "]"}]}], 
            "\[IndentingNewLine]", ",", 
            RowBox[{"{", 
             RowBox[{"i1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"PosManyBody0", " ", "/.", " ", 
                    RowBox[{
                    RowBox[{"{", "}"}], "->", " ", 
                    RowBox[{"Sequence", "[", "]"}]}]}], " ", "/.", "  ", 
                   RowBox[{
                    RowBox[{"{", "}"}], "->", " ", 
                    RowBox[{"Sequence", "[", "]"}]}]}], ")"}], "[", 
                 RowBox[{"[", "k1", "]"}], "]"}], "[", 
                RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], " ",
           "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"j1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"PosManyBody0", " ", "/.", " ", 
                 RowBox[{
                  RowBox[{"{", "}"}], "->", " ", 
                  RowBox[{"Sequence", "[", "]"}]}]}], " ", "/.", "  ", 
                RowBox[{
                 RowBox[{"{", "}"}], "->", " ", 
                 RowBox[{"Sequence", "[", "]"}]}]}], ")"}], "[", 
              RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], " ", 
        "\[IndentingNewLine]", ",", 
        RowBox[{"{", 
         RowBox[{"k1", ",", 
          RowBox[{"Length", "[", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"PosManyBody0", " ", "/.", " ", 
              RowBox[{
               RowBox[{"{", "}"}], "->", " ", 
               RowBox[{"Sequence", "[", "]"}]}]}], " ", "/.", "  ", 
             RowBox[{
              RowBox[{"{", "}"}], "->", " ", 
              RowBox[{"Sequence", "[", "]"}]}]}], ")"}], "]"}]}], "}"}]}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "remove", " ", "all", " ", "the", " ", "empty", " ", "positions", " ", 
       "from", "  ", "delkron"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"DelKron1", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Table", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Delete", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"ExtDelKron", "[", 
              RowBox[{"[", "j1", "]"}], "]"}], "[", 
             RowBox[{"[", "i1", "]"}], "]"}], ",", 
            RowBox[{"Position", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"PosManyBody0", "[", 
                RowBox[{"[", "j1", "]"}], "]"}], "[", 
               RowBox[{"[", "i1", "]"}], "]"}], ",", 
              RowBox[{"{", "}"}]}], "]"}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{"i1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{"PosManyBody0", "[", 
              RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"j1", ",", 
          RowBox[{"Length", "[", "PosManyBody0", "]"}]}], "}"}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"DelKron1", "=", 
      RowBox[{"Table", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Delete", "[", 
         RowBox[{
          RowBox[{"DelKron1", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"Position", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"Flatten", "[", "#", "]"}], "&"}], "/@", 
             RowBox[{"PosManyBody0", "[", 
              RowBox[{"[", "i1", "]"}], "]"}]}], ",", 
            RowBox[{"{", "}"}]}], "]"}]}], "]"}], ",", "\[IndentingNewLine]", 
        
        RowBox[{"{", 
         RowBox[{"i1", ",", 
          RowBox[{"Length", "[", "PosManyBody0", "]"}]}], "}"}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Obtain", " ", "the", " ", "chi", "  ", "of", " ", "each", " ", "many", 
       " ", "body", " ", "term"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"ManyBodyBlock1", "=", 
      RowBox[{"Table", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Table", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"Sort", "[", "#", "]"}], "&"}], "/@", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"Complement", "[", 
                   RowBox[{
                    RowBox[{"Flatten", "[", 
                    RowBox[{
                    RowBox[{"SQBraKet", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "]"}], ",", "#"}], "]"}],
                   "&"}], "@", 
                 RowBox[{"Flatten", "[", "#", "]"}]}], "&"}], "/@", 
               RowBox[{
                RowBox[{
                 RowBox[{"DelKron1", "[", 
                  RowBox[{"[", "k1", "]"}], "]"}], "[", 
                 RowBox[{"[", "j1", "]"}], "]"}], "[", 
                RowBox[{"[", "i1", "]"}], "]"}]}], ")"}]}], ",", 
            RowBox[{"{", 
             RowBox[{"i1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{
                RowBox[{"DelKron1", "[", 
                 RowBox[{"[", "k1", "]"}], "]"}], "[", 
                RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
          "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"j1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{"DelKron1", "[", 
              RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
        "\[IndentingNewLine]", ",", 
        RowBox[{"{", 
         RowBox[{"k1", ",", 
          RowBox[{"Length", "[", "DelKron1", "]"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"All", " ", "the", "  ", "the", " ", "holes"}], " ", "=", " ", 
       
       RowBox[{"True", " ", "in", "  ", "ManyBodyBlock0"}]}], "  ", "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"TFHolesMB0", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Table", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Table", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Flatten", "[", "#", "]"}], "&"}], "@", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"StringTake", "[", " ", 
                    RowBox[{
                    RowBox[{"ToString", "[", "#", "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "1"}], "}"}]}], "]"}], "===", 
                    "\"\<h\>\""}], "&"}], "/@", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"ManyBodyBlock0", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}]}], ")"}], ",", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "0", "]"}], "]"}], "===", "SuperDagger"}], 
                    ",", "True", ",", "False"}], "]"}], "&"}], "/@", "  ", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"ManyBodyBlock1", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}]}]}], "}"}]}], " ", "//", 
               " ", "Transpose"}], "\[IndentingNewLine]", ",", 
              RowBox[{"{", 
               RowBox[{"i1", ",", 
                RowBox[{"Length", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"ManyBodyBlock0", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                   RowBox[{"[", "k1", "]"}], "]"}], "[", 
                  RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
            ",", 
            RowBox[{"{", 
             RowBox[{"j1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{
                RowBox[{"ManyBodyBlock0", "[", 
                 RowBox[{"[", "l1", "]"}], "]"}], "[", 
                RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"k1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{"ManyBodyBlock0", "[", 
              RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"l1", ",", 
          RowBox[{"Length", "[", "ManyBodyBlock0", "]"}]}], "}"}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"All", " ", "the", "  ", "the", " ", "holes"}], " ", "=", " ", 
       
       RowBox[{"True", " ", "in", "  ", "ManyBodyBlock0"}]}], "  ", "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"TFHolesMB1", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Table", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Table", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Flatten", "[", "#", "]"}], "&"}], "@", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"StringTake", "[", " ", 
                    RowBox[{
                    RowBox[{"ToString", "[", "#", "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "1"}], "}"}]}], "]"}], "===", 
                    "\"\<h\>\""}], "&"}], "/@", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"ManyBodyBlock1", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}]}], ")"}], ",", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "0", "]"}], "]"}], "===", "SuperDagger"}], 
                    ",", "True", ",", "False"}], "]"}], "&"}], "/@", "  ", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"ManyBodyBlock1", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}]}]}], "}"}]}], " ", "//", 
               " ", "Transpose"}], "\[IndentingNewLine]", ",", 
              RowBox[{"{", 
               RowBox[{"i1", ",", 
                RowBox[{"Length", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"ManyBodyBlock1", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                   RowBox[{"[", "k1", "]"}], "]"}], "[", 
                  RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
            ",", 
            RowBox[{"{", 
             RowBox[{"j1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{
                RowBox[{"ManyBodyBlock1", "[", 
                 RowBox[{"[", "l1", "]"}], "]"}], "[", 
                RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"k1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{"ManyBodyBlock1", "[", 
              RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"l1", ",", 
          RowBox[{"Length", "[", "ManyBodyBlock1", "]"}]}], "}"}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"PositZeroTerms", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Table", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"Flatten", "[", "#", "]"}], "&"}], "@", 
                 RowBox[{"Position", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"TFHolesMB0", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], ",", "#"}], "]"}]}], 
                "&"}], "/@", 
               RowBox[{
                RowBox[{
                 RowBox[{"TFHolesMB1", "[", 
                  RowBox[{"[", "l1", "]"}], "]"}], "[", 
                 RowBox[{"[", "k1", "]"}], "]"}], "[", 
                RowBox[{"[", "j1", "]"}], "]"}]}], ")"}], " ", "/.", " ", 
             RowBox[{
              RowBox[{"{", "}"}], "->", 
              RowBox[{"Sequence", "[", "]"}]}]}], "\[IndentingNewLine]", ",", 
            
            RowBox[{"{", 
             RowBox[{"j1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{
                RowBox[{"ManyBodyBlock0", "[", 
                 RowBox[{"[", "l1", "]"}], "]"}], "[", 
                RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"k1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{"ManyBodyBlock0", "[", 
              RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"l1", ",", 
          RowBox[{"Length", "[", "ManyBodyBlock0", "]"}]}], "}"}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Is", "  ", "ManyBodyBlock1", "  ", "but", " ", "without", " ", "the", 
       " ", "SuperDagger"}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"ManyBodyBlock2", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"Table", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"#", "[", 
                    RowBox[{"[", "0", "]"}], "]"}], "===", "SuperDagger"}], 
                  ",", 
                  RowBox[{"#", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], ",", "#"}], "]"}], "&"}], "/@",
                " ", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"ManyBodyBlock1", "[", 
                   RowBox[{"[", "l1", "]"}], "]"}], "[", 
                  RowBox[{"[", "k1", "]"}], "]"}], "[", 
                 RowBox[{"[", "j1", "]"}], "]"}], "[", 
                RowBox[{"[", "i1", "]"}], "]"}]}], "\[IndentingNewLine]", ",", 
              RowBox[{"{", 
               RowBox[{"i1", ",", 
                RowBox[{"Length", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"ManyBodyBlock1", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                   RowBox[{"[", "k1", "]"}], "]"}], "[", 
                  RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
            ",", 
            RowBox[{"{", 
             RowBox[{"j1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{
                RowBox[{"ManyBodyBlock1", "[", 
                 RowBox[{"[", "l1", "]"}], "]"}], "[", 
                RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"k1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{"ManyBodyBlock1", "[", 
              RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"l1", ",", 
          RowBox[{"Length", "[", "ManyBodyBlock1", "]"}]}], "}"}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"PositZeroTerms1", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Table", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Position", "[", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"Flatten", "[", "#", "]"}], "&"}], "@", 
                  RowBox[{"Position", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"TFHolesMB0", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], ",", "#"}], "]"}]}], 
                 "&"}], "/@", 
                RowBox[{
                 RowBox[{
                  RowBox[{"TFHolesMB1", "[", 
                   RowBox[{"[", "l1", "]"}], "]"}], "[", 
                  RowBox[{"[", "k1", "]"}], "]"}], "[", 
                 RowBox[{"[", "j1", "]"}], "]"}]}], ")"}], " ", ",", 
              RowBox[{"{", "}"}]}], "]"}], "\[IndentingNewLine]", ",", 
            RowBox[{"{", 
             RowBox[{"j1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{
                RowBox[{"ManyBodyBlock0", "[", 
                 RowBox[{"[", "l1", "]"}], "]"}], "[", 
                RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"k1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{"ManyBodyBlock0", "[", 
              RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"l1", ",", 
          RowBox[{"Length", "[", "ManyBodyBlock0", "]"}]}], "}"}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"ManyBodyBlock3", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Table", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Delete", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"ManyBodyBlock2", "[", 
                 RowBox[{"[", "l1", "]"}], "]"}], "[", 
                RowBox[{"[", "k1", "]"}], "]"}], "[", 
               RowBox[{"[", "j1", "]"}], "]"}], ",", 
              RowBox[{
               RowBox[{
                RowBox[{"PositZeroTerms1", "[", 
                 RowBox[{"[", "l1", "]"}], "]"}], "[", 
                RowBox[{"[", "k1", "]"}], "]"}], "[", 
               RowBox[{"[", "j1", "]"}], "]"}]}], "]"}], 
            "\[IndentingNewLine]", ",", 
            RowBox[{"{", 
             RowBox[{"j1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{
                RowBox[{"PositZeroTerms1", "[", 
                 RowBox[{"[", "l1", "]"}], "]"}], "[", 
                RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"k1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{"PositZeroTerms1", "[", 
              RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"l1", ",", 
          RowBox[{"Length", "[", "PositZeroTerms1", "]"}]}], "}"}]}], "]"}]}],
      ";", "\[IndentingNewLine]", 
     RowBox[{"ManyBodyBlock4", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Table", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Table", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"#1", "[", 
                    RowBox[{"[", "0", "]"}], "]"}], "===", "SuperDagger"}], 
                    ",", 
                    RowBox[{"#1", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", "#1"}], "]"}], "&"}],
                  "/@", "\[IndentingNewLine]", 
                 RowBox[{"Flatten", "[", "#", "]"}]}], "&"}], "@", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"ManyBodyBlock0", "[", 
                   RowBox[{"[", "l1", "]"}], "]"}], "[", 
                  RowBox[{"[", "k1", "]"}], "]"}], "[", 
                 RowBox[{"[", "j1", "]"}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"PositZeroTerms", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                   RowBox[{"[", "j1", "]"}], "]"}], "[", 
                  RowBox[{"[", "i1", "]"}], "]"}], "]"}], "]"}]}], 
              "\[IndentingNewLine]", ",", 
              RowBox[{"{", 
               RowBox[{"i1", ",", 
                RowBox[{"Length", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"PositZeroTerms", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                   RowBox[{"[", "k1", "]"}], "]"}], "[", 
                  RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
            "\[IndentingNewLine]", ",", 
            RowBox[{"{", 
             RowBox[{"j1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{
                RowBox[{"PositZeroTerms", "[", 
                 RowBox[{"[", "l1", "]"}], "]"}], "[", 
                RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"k1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{"PositZeroTerms", "[", 
              RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"l1", ",", 
          RowBox[{"Length", "[", "PositZeroTerms", "]"}]}], "}"}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"ManyBodyHOp0", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"q1", ",", 
          SuperscriptBox["q2", "\[Dagger]"]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"q1", ",", "q2", ",", 
          SuperscriptBox["q4", "\[Dagger]"], ",", 
          SuperscriptBox["q3", "\[Dagger]"]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"q1", ",", "q2", ",", "q3", ",", 
          SuperscriptBox["q6", "\[Dagger]"], ",", 
          SuperscriptBox["q5", "\[Dagger]"], ",", 
          SuperscriptBox["q4", "\[Dagger]"]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"q1", ",", "q2", ",", "q3", ",", "q4", ",", 
          SuperscriptBox["q8", "\[Dagger]"], ",", 
          SuperscriptBox["q7", "\[Dagger]"], ",", 
          SuperscriptBox["q6", "\[Dagger]"], ",", 
          SuperscriptBox["q5", "\[Dagger]"]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"q1", ",", "q2", ",", "q3", ",", "q4", ",", "q5", ",", 
          SuperscriptBox["q10", "\[Dagger]"], ",", 
          SuperscriptBox["q9", "\[Dagger]"], ",", 
          SuperscriptBox["q8", "\[Dagger]"], ",", 
          SuperscriptBox["q7", "\[Dagger]"], ",", 
          SuperscriptBox["q6", "\[Dagger]"]}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ManyBodyHOp1", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Partition", "[", 
           RowBox[{"#", ",", 
            RowBox[{
             RowBox[{"Length", "[", 
              RowBox[{"ManyBodyHOp0", "[", 
               RowBox[{"[", "i1", "]"}], "]"}], "]"}], "/", "2"}]}], "]"}], 
          "&"}], "@", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"#1", "[", 
                RowBox[{"[", "0", "]"}], "]"}], "===", "SuperDagger"}], ",", 
              RowBox[{"#1", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", "#1"}], "]"}], "&"}], "/@", 
           RowBox[{"ManyBodyHOp0", "[", 
            RowBox[{"[", "i1", "]"}], "]"}]}], ")"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i1", ",", 
          RowBox[{"Length", "[", "ManyBodyHOp0", "]"}]}], "}"}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Just", " ", "the", " ", "bra", " ", "and", " ", "the", " ", "ket", " ",
        "ManyBodyTerms1", " ", "without", " ", "the", " ", "SuperDagger"}], 
      " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"MBTwS0", "=", 
      RowBox[{"Table", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Table", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"#1", "[", 
                    RowBox[{"[", "0", "]"}], "]"}], "===", "SuperDagger"}], 
                    ",", 
                    RowBox[{"#1", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", "#1"}], "]"}], "&"}],
                    "/@", 
                   RowBox[{"Flatten", "[", 
                    RowBox[{"#", ",", "2"}], "]"}]}], "&"}], "/@", 
                 RowBox[{"Partition", "[", 
                  RowBox[{"#", ",", "2"}], "]"}]}], "&"}], "/@", 
               "ManbodyTerms1"}], ")"}], "[", 
             RowBox[{"[", "#", "]"}], "]"}], "&"}], "/@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"PosManyBody0", " ", "/.", " ", 
                 RowBox[{
                  RowBox[{"{", "}"}], "->", " ", 
                  RowBox[{"Sequence", "[", "]"}]}]}], " ", "/.", "  ", 
                RowBox[{
                 RowBox[{"{", "}"}], "->", " ", 
                 RowBox[{"Sequence", "[", "]"}]}]}], ")"}], "[", 
              RowBox[{"[", "j1", "]"}], "]"}], "[", 
             RowBox[{"[", "i1", "]"}], "]"}], "  ", ")"}]}], 
          "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"i1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"PosManyBody0", " ", "/.", " ", 
                 RowBox[{
                  RowBox[{"{", "}"}], "->", " ", 
                  RowBox[{"Sequence", "[", "]"}]}]}], " ", "/.", "  ", 
                RowBox[{
                 RowBox[{"{", "}"}], "->", " ", 
                 RowBox[{"Sequence", "[", "]"}]}]}], ")"}], "[", 
              RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
        "\[IndentingNewLine]", ",", 
        RowBox[{"{", 
         RowBox[{"j1", ",", 
          RowBox[{"Length", "[", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"PosManyBody0", " ", "/.", " ", 
              RowBox[{
               RowBox[{"{", "}"}], "->", " ", 
               RowBox[{"Sequence", "[", "]"}]}]}], " ", "/.", "  ", 
             RowBox[{
              RowBox[{"{", "}"}], "->", " ", 
              RowBox[{"Sequence", "[", "]"}]}]}], ")"}], "]"}]}], "}"}]}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"MBTwS1", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Table", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Table", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Join", " ", "@@", " ", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"MBTwS0", "[", 
                   RowBox[{"[", "l1", "]"}], "]"}], "[", 
                  RowBox[{"[", "k1", "]"}], "]"}], "[", 
                 RowBox[{"[", "j1", "]"}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"PositZeroTerms", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                   RowBox[{"[", "j1", "]"}], "]"}], "[", 
                  RowBox[{"[", "i1", "]"}], "]"}], "]"}], "]"}]}], 
              "\[IndentingNewLine]", ",", 
              RowBox[{"{", 
               RowBox[{"i1", ",", 
                RowBox[{"Length", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"PositZeroTerms", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                   RowBox[{"[", "k1", "]"}], "]"}], "[", 
                  RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
            "\[IndentingNewLine]", ",", 
            RowBox[{"{", 
             RowBox[{"j1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{
                RowBox[{"PositZeroTerms", "[", 
                 RowBox[{"[", "l1", "]"}], "]"}], "[", 
                RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"k1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{"PositZeroTerms", "[", 
              RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"l1", ",", 
          RowBox[{"Length", "[", "PositZeroTerms", "]"}]}], "}"}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"MBTwS2", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"Table", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"MBTwS1", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                   RowBox[{"[", "k1", "]"}], "]"}], "[", 
                  RowBox[{"[", "j1", "]"}], "]"}], "[", 
                 RowBox[{"[", "i1", "]"}], "]"}], "/.", 
                RowBox[{"AssociationThread", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"ManyBodyBlock4", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                   RowBox[{"[", "i1", "]"}], "]"}], "->", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"ManyBodyBlock3", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                   RowBox[{"[", "i1", "]"}], "]"}]}], "]"}]}], ")"}], 
              "\[IndentingNewLine]", ",", 
              RowBox[{"{", 
               RowBox[{"i1", ",", 
                RowBox[{"Length", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"MBTwS1", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                   RowBox[{"[", "k1", "]"}], "]"}], "[", 
                  RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
            " ", ",", 
            RowBox[{"{", 
             RowBox[{"j1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{
                RowBox[{"MBTwS1", "[", 
                 RowBox[{"[", "l1", "]"}], "]"}], "[", 
                RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"k1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{"MBTwS1", "[", 
              RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"l1", ",", 
          RowBox[{"Length", "[", "MBTwS1", "]"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
       "Separate", " ", "again", " ", "in", " ", "to", " ", "Bra", " ", "and",
         " ", "Ket"}], ",", " ", 
       RowBox[{"and", " ", "creation", " ", "or", " ", "anihilation"}]}], " ",
       "*)"}], "\[IndentingNewLine]", 
     RowBox[{"SepBraKet", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Table", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Table", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Table", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"Table", "[", 
                RowBox[{
                 RowBox[{"Table", "[", "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"MBTwS2", "[", 
                    RowBox[{"[", "n1", "]"}], "]"}], "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{"Position", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"StringTake", "[", " ", 
                    RowBox[{
                    RowBox[{"ToString", "[", "#", "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "1"}], "}"}]}], "]"}], "===", 
                    "\"\<h\>\""}], "&"}], "/@", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"MBTwS2", "[", 
                    RowBox[{"[", "n1", "]"}], "]"}], "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}]}], ",", "j1"}], "]"}], 
                    "]"}], "]"}], "]"}], "\[IndentingNewLine]", ",", 
                   RowBox[{"{", 
                    RowBox[{"i1", ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"MBTwS2", "[", 
                    RowBox[{"[", "n1", "]"}], "]"}], "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
                 ",", 
                 RowBox[{"{", 
                  RowBox[{"j1", ",", 
                   RowBox[{"{", 
                    RowBox[{"True", ",", "False"}], "}"}]}], "}"}]}], "]"}], 
               " ", "//", " ", "Transpose"}], "\[IndentingNewLine]", ",", 
              RowBox[{"{", 
               RowBox[{"k1", ",", 
                RowBox[{"Length", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"MBTwS2", "[", 
                    RowBox[{"[", "n1", "]"}], "]"}], "[", 
                   RowBox[{"[", "m1", "]"}], "]"}], "[", 
                  RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
            "  ", "\[IndentingNewLine]", ",", 
            RowBox[{"{", 
             RowBox[{"l1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{
                RowBox[{"MBTwS2", "[", 
                 RowBox[{"[", "n1", "]"}], "]"}], "[", 
                RowBox[{"[", "m1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"m1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{"MBTwS2", "[", 
              RowBox[{"[", "n1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"n1", ",", 
          RowBox[{"Length", "[", "MBTwS2", "]"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "all", " ", "the", " ", "strings", " ", "that", " ", "are", " ", 
       "applied", " ", "to", " ", "the", " ", "Many", " ", "body", " ", 
       "terms", " ", "are", " ", "created"}], " ", "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"ConractManyBodyStr", "=", 
      RowBox[{"Table", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Table", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"Table", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Join", "@@", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Transpose", "[", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"ManyBodyHOp1", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"SepBraKet", "[", 
                    RowBox[{"[", "n1", "]"}], "]"}], "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "]"}], "]"}], "/", "2"}],
                     "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ";;", 
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"Join", "@@", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"SepBraKet", "[", 
                    RowBox[{"[", "n1", "]"}], "]"}], "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}]}], ")"}], "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "]"}]}], "]"}], "]"}], 
                    ",", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"Join", "@@", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"SepBraKet", "[", 
                    RowBox[{"[", "n1", "]"}], "]"}], "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}]}], ")"}], "[", 
                    RowBox[{"[", "3", "]"}], "]"}]}], "}"}], "]"}], ",", 
                 RowBox[{"Transpose", "[", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"ManyBodyHOp1", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"SepBraKet", "[", 
                    RowBox[{"[", "n1", "]"}], "]"}], "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "]"}], "]"}], "/", "2"}],
                     "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ";;", 
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"Join", "@@", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"SepBraKet", "[", 
                    RowBox[{"[", "n1", "]"}], "]"}], "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}]}], ")"}], "[", 
                    RowBox[{"[", "4", "]"}], "]"}], "]"}]}], "]"}], "]"}], 
                    ",", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"Join", "@@", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"SepBraKet", "[", 
                    RowBox[{"[", "n1", "]"}], "]"}], "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}]}], ")"}], "[", 
                    RowBox[{"[", "4", "]"}], "]"}]}], "}"}], "]"}], ",", 
                 RowBox[{"Transpose", "[", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"Join", "@@", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"SepBraKet", "[", 
                    RowBox[{"[", "n1", "]"}], "]"}], "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}]}], ")"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"ManyBodyHOp1", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"SepBraKet", "[", 
                    RowBox[{"[", "n1", "]"}], "]"}], "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "]"}], "]"}], "/", "2"}],
                     "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"Join", "@@", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"SepBraKet", "[", 
                    RowBox[{"[", "n1", "]"}], "]"}], "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}]}], ")"}], "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "]"}], "+", "1"}], ";;", 
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{"ManyBodyHOp1", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"SepBraKet", "[", 
                    RowBox[{"[", "n1", "]"}], "]"}], "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "]"}], "]"}], "/", "2"}],
                     "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "]"}], "]"}]}], 
                   "}"}], "]"}], ",", 
                 RowBox[{"Transpose", "[", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"Join", "@@", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"SepBraKet", "[", 
                    RowBox[{"[", "n1", "]"}], "]"}], "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}]}], ")"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"ManyBodyHOp1", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"SepBraKet", "[", 
                    RowBox[{"[", "n1", "]"}], "]"}], "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "]"}], "]"}], "/", "2"}],
                     "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"Join", "@@", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"SepBraKet", "[", 
                    RowBox[{"[", "n1", "]"}], "]"}], "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}]}], ")"}], "[", 
                    RowBox[{"[", "4", "]"}], "]"}], "]"}], "+", "1"}], ";;", 
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{"ManyBodyHOp1", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"SepBraKet", "[", 
                    RowBox[{"[", "n1", "]"}], "]"}], "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "]"}], "]"}], "/", "2"}],
                     "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "]"}], "]"}]}], 
                   "}"}], "]"}]}], "}"}]}], "\[IndentingNewLine]", ",", 
              RowBox[{"{", 
               RowBox[{"k1", ",", 
                RowBox[{"Length", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"SepBraKet", "[", 
                    RowBox[{"[", "n1", "]"}], "]"}], "[", 
                   RowBox[{"[", "m1", "]"}], "]"}], "[", 
                  RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
            "\[IndentingNewLine]", ",", 
            RowBox[{"{", 
             RowBox[{"l1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{
                RowBox[{"SepBraKet", "[", 
                 RowBox[{"[", "n1", "]"}], "]"}], "[", 
                RowBox[{"[", "m1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"m1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{"SepBraKet", "[", 
              RowBox[{"[", "n1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"n1", ",", 
          RowBox[{"Length", "[", "SepBraKet", "]"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Generate", " ", "the", " ", "kroneker", " ", "deltas", " ", "that", 
       " ", "are", " ", "not", " ", "applied", " ", "to", " ", "the", " ", 
       "many", " ", "body", " ", "terms"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"KronMany", "=", 
      RowBox[{"Table", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Join", "@@", 
               RowBox[{"Transpose", "[", 
                RowBox[{"{", 
                 RowBox[{"(", " ", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Partition", "[", 
                    RowBox[{"#", ",", "2"}], "]"}], "&"}], " ", "/@", " ", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"#1", "[", 
                    RowBox[{"[", "0", "]"}], "]"}], "===", "SuperDagger"}], 
                    ",", 
                    RowBox[{"#1", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", "#1"}], "]"}], "&"}],
                     "/@", " ", 
                    RowBox[{"Flatten", "[", "#", "]"}]}], "&"}], "/@", 
                    RowBox[{"Delete", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"DelKron1", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"PositZeroTerms1", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}]}], "]"}]}], ")"}]}], 
                  ")"}], "}"}], "]"}]}], ")"}], "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"i1", ",", 
               RowBox[{"Length", "[", 
                RowBox[{
                 RowBox[{"DelKron1", "[", 
                  RowBox[{"[", "k1", "]"}], "]"}], "[", 
                 RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"j1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"DelKron1", "[", 
               RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], " ", 
         "/.", " ", 
         RowBox[{"Null", " ", "->", " ", 
          RowBox[{"Sequence", "[", "]"}]}]}], "\[IndentingNewLine]", ",", 
        RowBox[{"{", 
         RowBox[{"k1", ",", 
          RowBox[{"Length", "[", "DelKron1", "]"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Assembly", " ", "all", " ", "second", " ", "quantized", " ", 
       "operators"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"StringBraHamKet", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Table", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"Insert", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"SQBraKet", "[", 
                RowBox[{"[", "k1", "]"}], "]"}], "[", 
               RowBox[{"[", "j1", "]"}], "]"}], ",", 
              RowBox[{"Unevaluated", "[", 
               RowBox[{"Sequence", "@@", 
                RowBox[{"{", 
                 RowBox[{"ManyBodyHOp0", "[", 
                  RowBox[{"[", "i1", "]"}], "]"}], "}"}]}], "]"}], ",", "2"}],
              "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i1", ",", 
              RowBox[{"Length", "[", "ManyBodyHOp0", "]"}]}], "}"}]}], "]"}], 
          "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"j1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{"SQBraKet", "[", 
              RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"k1", ",", 
          RowBox[{"Length", "[", "SQBraKet", "]"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Assebly", " ", "all", " ", "second", " ", "quantized", " ", 
       "operators"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"SignManyBody", "=", 
      RowBox[{"Table", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Table", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"sign", "[", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"Join", "@@", "#"}], " ", "&"}], "/@", 
                RowBox[{"Transpose", "[", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"KronMany", "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], ",", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"ConractManyBodyStr", "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}]}], "}"}], "]"}]}], ")"}], 
              ",", 
              RowBox[{
               RowBox[{
                RowBox[{"StringBraHamKet", "[", 
                 RowBox[{"[", "m1", "]"}], "]"}], "[", 
                RowBox[{"[", "l1", "]"}], "]"}], "[", 
               RowBox[{"[", "k1", "]"}], "]"}]}], "]"}], 
            "\[IndentingNewLine]", ",", 
            RowBox[{"{", 
             RowBox[{"k1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{
                RowBox[{"KronMany", "[", 
                 RowBox[{"[", "m1", "]"}], "]"}], "[", 
                RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"l1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{"KronMany", "[", 
              RowBox[{"[", "m1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"m1", ",", 
          RowBox[{"Length", "[", "KronMany", "]"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"PreManyBody", "=", 
      RowBox[{"Quiet", "[", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Table", "[", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"\[Chi]", "[", 
                RowBox[{"[", 
                 RowBox[{"Sequence", "@@", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "&"}], "/@", 
                    RowBox[{"Sort", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"StringTake", "[", " ", 
                    RowBox[{
                    RowBox[{"ToString", "[", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "1"}], "}"}]}], "]"}], "===", 
                    "\"\<q\>\""}], ",", "#", ",", 
                    RowBox[{"Reverse", "[", "#", "]"}]}], "]"}], "&"}], "/@", 
                    
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"ConractManyBodyStr", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}]}], "]"}]}], ")"}]}], 
                 "]"}], "]"}], "\[IndentingNewLine]", ",", 
               RowBox[{"{", 
                RowBox[{"i1", ",", 
                 RowBox[{"Length", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"ConractManyBodyStr", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                   RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
             "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"j1", ",", 
               RowBox[{"Length", "[", 
                RowBox[{
                 RowBox[{"ConractManyBodyStr", "[", 
                  RowBox[{"[", "l1", "]"}], "]"}], "[", 
                 RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"k1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"ConractManyBodyStr", "[", 
               RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
         
         RowBox[{"{", 
          RowBox[{"l1", ",", 
           RowBox[{"Length", "[", "ConractManyBodyStr", "]"}]}], "}"}]}], 
        "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"ManyBodyTerms", "=", 
      RowBox[{"{", 
       RowBox[{"ManyBodyTermsF", ",", "ManyBodyTermsV"}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Return", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Table", "[", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Times", "@@", "#"}], "&"}], "/@", 
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Flatten", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"KronMany", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "]"}], "===", 
                    RowBox[{"{", "}"}]}], ",", "1", ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Subscript", "[", 
                    RowBox[{"\[Delta]", ",", "#"}], "]"}], "&"}], "/@", " ", 
                    RowBox[{"Partition", "[", 
                    RowBox[{"#", ",", "2"}], "]"}]}], "&"}], " ", "@", " ", 
                    RowBox[{"Flatten", "[", "#", "]"}]}], "&"}], "/@", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"KronMany", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}]}]}], "]"}]}], ")"}], 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"SignManyBody", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                   RowBox[{"[", "j1", "]"}], "]"}], "[", 
                  RowBox[{"[", "i1", "]"}], "]"}], ")"}], 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"PreManyBody", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                   RowBox[{"[", "j1", "]"}], "]"}], "[", 
                  RowBox[{"[", "i1", "]"}], "]"}], ")"}]}], 
               "\[IndentingNewLine]", ",", 
               RowBox[{"{", 
                RowBox[{"i1", ",", 
                 RowBox[{"Length", "[", 
                  RowBox[{
                   RowBox[{"KronMany", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                   RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
             " ", "//", "Flatten"}], ",", 
            RowBox[{"{", 
             RowBox[{"j1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{"KronMany", "[", 
                RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"k1", ",", 
            RowBox[{"Length", "[", "KronMany", "]"}]}], "}"}]}], "]"}], ",", 
        "ManyBodyTerms"}], "}"}], "]"}], ";"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.876469479707465*^9, 3.876469541626397*^9}, {
   3.876469833025949*^9, 3.876469834295375*^9}, {3.876469962692398*^9, 
   3.8764700219866323`*^9}, {3.876470087520525*^9, 3.8764701116505938`*^9}, {
   3.876470361899016*^9, 3.87647039448167*^9}, 3.876827662335021*^9, 
   3.876827801970155*^9, 3.884340144203458*^9, {3.885460138295292*^9, 
   3.885460207542097*^9}, {3.885989828424094*^9, 3.8859898630986357`*^9}, {
   3.886065343945444*^9, 3.886065364403928*^9}, {3.886578929779893*^9, 
   3.886578930651986*^9}, {3.886596609211134*^9, 3.886596627728816*^9}, 
   3.886596661217135*^9, {3.886598927826646*^9, 3.886598932239602*^9}, 
   3.886600062830682*^9, 3.88725703014791*^9, {3.887274288430537*^9, 
   3.887274315379643*^9}, 3.887367665274271*^9, 3.887367734955081*^9, {
   3.8873681701626368`*^9, 3.88736817746696*^9}, 3.890814070892705*^9, {
   3.89105772145481*^9, 3.891057721616835*^9}, {3.8910592749966373`*^9, 
   3.891059355075392*^9}, 3.891064618621401*^9, {3.891501783729856*^9, 
   3.891501792858597*^9}, {3.891501918582526*^9, 3.8915019271246023`*^9}, {
   3.8915030723889103`*^9, 3.8915030953505087`*^9}, {3.891503171077804*^9, 
   3.891503253395855*^9}},
 CellLabel->"In[11]:=",ExpressionUUID->"86f446cc-8121-424b-969b-991b96e89d63"]
}, Closed]],

Cell[CellGroupData[{

Cell["WicksContract contract string of second quantized operators", "Section",
 InitializationCell->True,
 CellChangeTimes->{{3.850212664358878*^9, 3.8502126771346684`*^9}, {
   3.85157954112372*^9, 3.8515795729983664`*^9}, {3.8516892834589653`*^9, 
   3.851689284844758*^9}, {3.858842674216196*^9, 3.858842803867488*^9}, {
   3.858843034882577*^9, 3.858843046037135*^9}, 3.8588444984561167`*^9, {
   3.858929589023733*^9, 3.858929600925139*^9}, {3.860557256827732*^9, 
   3.860557323546199*^9}, {3.860567231137411*^9, 3.8605672311374693`*^9}, {
   3.861864719032872*^9, 3.861864730057736*^9}, {3.8618648804597187`*^9, 
   3.861864885676948*^9}, {3.8740599273331413`*^9, 3.8740599316856422`*^9}, {
   3.877687842043283*^9, 3.8776878447096567`*^9}, {3.885383206694233*^9, 
   3.885383224858076*^9}, {3.887431867470304*^9, 3.887431867521755*^9}, {
   3.891066525893366*^9, 
   3.8910665493242893`*^9}},ExpressionUUID->"e9f99a08-7c66-4f0d-adeb-\
d35819a90a9c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"WicksContract", "[", "ManyBodyTerms_", "]"}], ":=", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "Op1", ",", "Op2", ",", " ", "Op3", ",", "Op4", ",", "Op5", ",", "Op6",
         ",", "Op7", ",", "Op8", ",", "ConHcKa", ",", "ConHaKc", ",", 
        "conHcKa2", ",", "conHaKc2", ",", "ValConHK", ",", 
        "remainOpHamiltonian", ",", "remainOpHamiltonian1", ",", " ", 
        "BoolString", ",", "numHcont", " ", ",", "FullContract", ",", 
        "ConHClust", ",", "RandomHClust", ",", "NonRepHTs", ",", 
        "PositionConected", ",", "CombineHTs", ",", "RemainHTs", ",", 
        "contBrHTs", ",", "contBrHTs2", ",", "contractBrHTs", ",", 
        "SignCont"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Extract", " ", "From", "  ", "ManyBodyTerms", " ", "each", " ", 
        "operator", " ", "and", " ", "separate", " ", "it", " ", "depending", 
        " ", "from", " ", "wich", " ", "Frirst", " ", "quantized", " ", 
        "operators", " ", "belongs", " ", "and", " ", "if", " ", "it", " ", 
        "is", " ", "creation", " ", "or", " ", "anihilation"}], " ", "*)"}], 
      "\[IndentingNewLine]", " ", 
      RowBox[{
       RowBox[{"Op1", "=", 
        RowBox[{"{", "}"}]}], ";", " ", 
       RowBox[{"Op2", "=", 
        RowBox[{"{", "}"}]}], ";", "   ", 
       RowBox[{"Op3", "=", 
        RowBox[{"{", "}"}]}], ";", " ", 
       RowBox[{"Op4", "=", 
        RowBox[{"{", "}"}]}], ";", "   ", 
       RowBox[{"Op5", "=", 
        RowBox[{"{", "}"}]}], ";", "    ", 
       RowBox[{"Op6", "=", 
        RowBox[{"{", "}"}]}], ";", "    ", 
       RowBox[{"Op7", "=", 
        RowBox[{"{", "}"}]}], ";", " ", 
       RowBox[{"Op8", "=", 
        RowBox[{"{", "}"}]}], ";", "  ", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"ManyBodyTerms", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "[", 
               RowBox[{"[", "j1", "]"}], "]"}], "[", 
              RowBox[{"[", "0", "]"}], "]"}], "===", "SuperDagger"}], ",", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"Op1", ",", 
              RowBox[{
               RowBox[{
                RowBox[{"ManyBodyTerms", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "[", 
                RowBox[{"[", "j1", "]"}], "]"}], "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ",", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"Op2", ",", 
              RowBox[{
               RowBox[{"ManyBodyTerms", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "[", 
               RowBox[{"[", "j1", "]"}], "]"}]}], "]"}]}], "]"}], ";"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"j1", ",", 
           RowBox[{"Length", "[", 
            RowBox[{"ManyBodyTerms", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"ManyBodyTerms", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "[", 
               RowBox[{"[", "j1", "]"}], "]"}], "[", 
              RowBox[{"[", "0", "]"}], "]"}], "===", "SuperDagger"}], ",", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"Op3", ",", 
              RowBox[{
               RowBox[{
                RowBox[{"ManyBodyTerms", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "[", 
                RowBox[{"[", "j1", "]"}], "]"}], "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ",", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"Op4", ",", 
              RowBox[{
               RowBox[{"ManyBodyTerms", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "[", 
               RowBox[{"[", "j1", "]"}], "]"}]}], "]"}]}], "]"}], ";"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"j1", ",", 
           RowBox[{"Length", "[", 
            RowBox[{"ManyBodyTerms", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Op5", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"ManyBodyTerms", "[", 
                  RowBox[{"[", "3", "]"}], "]"}], "[", 
                 RowBox[{"[", "j1", "]"}], "]"}], "[", 
                RowBox[{"[", "k1", "]"}], "]"}], "[", 
               RowBox[{"[", "0", "]"}], "]"}], "===", "SuperDagger"}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"ManyBodyTerms", "[", 
                 RowBox[{"[", "3", "]"}], "]"}], "[", 
                RowBox[{"[", "j1", "]"}], "]"}], "[", 
               RowBox[{"[", "k1", "]"}], "]"}], "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], "]"}], " ", "/.", 
           RowBox[{"Null", " ", "->", " ", 
            RowBox[{"Sequence", "[", "]"}]}]}], "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"j1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{"ManyBodyTerms", "[", 
              RowBox[{"[", "3", "]"}], "]"}], "]"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"k1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{
              RowBox[{"ManyBodyTerms", "[", 
               RowBox[{"[", "3", "]"}], "]"}], "[", 
              RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}], ";",
        "\[IndentingNewLine]", 
       RowBox[{"Op6", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"ManyBodyTerms", "[", 
                  RowBox[{"[", "3", "]"}], "]"}], "[", 
                 RowBox[{"[", "j1", "]"}], "]"}], "[", 
                RowBox[{"[", "k1", "]"}], "]"}], "[", 
               RowBox[{"[", "0", "]"}], "]"}], "=!=", "SuperDagger"}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"ManyBodyTerms", "[", 
                RowBox[{"[", "3", "]"}], "]"}], "[", 
               RowBox[{"[", "j1", "]"}], "]"}], "[", 
              RowBox[{"[", "k1", "]"}], "]"}]}], "]"}], "/.", 
           RowBox[{"Null", " ", "->", " ", 
            RowBox[{"Sequence", "[", "]"}]}]}], "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"j1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{"ManyBodyTerms", "[", 
              RowBox[{"[", "3", "]"}], "]"}], "]"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"k1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{
              RowBox[{"ManyBodyTerms", "[", 
               RowBox[{"[", "3", "]"}], "]"}], "[", 
              RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}], ";",
        "\[IndentingNewLine]", 
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"ManyBodyTerms", "[", 
                RowBox[{"[", "4", "]"}], "]"}], "[", 
               RowBox[{"[", "j1", "]"}], "]"}], "[", 
              RowBox[{"[", "0", "]"}], "]"}], "===", "SuperDagger"}], ",", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"Op7", ",", 
              RowBox[{
               RowBox[{
                RowBox[{"ManyBodyTerms", "[", 
                 RowBox[{"[", "4", "]"}], "]"}], "[", 
                RowBox[{"[", "j1", "]"}], "]"}], "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ",", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"Op8", ",", 
              RowBox[{
               RowBox[{"ManyBodyTerms", "[", 
                RowBox[{"[", "4", "]"}], "]"}], "[", 
               RowBox[{"[", "j1", "]"}], "]"}]}], "]"}]}], "]"}], ";"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"j1", ",", 
           RowBox[{"Length", "[", 
            RowBox[{"ManyBodyTerms", "[", 
             RowBox[{"[", "4", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Contract", " ", "the", " ", "operators", " ", "in", " ", 
         "hamiltonian", " ", "with", " ", "the", " ", "ket"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"ConHcKa", "=", 
        RowBox[{"Subsets", "[", 
         RowBox[{
          RowBox[{"Tuples", "[", 
           RowBox[{"{", 
            RowBox[{"Op3", ",", "Op8"}], "}"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"Min", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Length", "[", "Op3", "]"}], ",", 
              RowBox[{"Length", "[", "Op8", "]"}]}], "}"}], "]"}], "}"}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"ConHaKc", "=", " ", 
        RowBox[{"Subsets", "[", 
         RowBox[{
          RowBox[{"Tuples", "[", 
           RowBox[{"{", 
            RowBox[{"Op4", ",", "Op7"}], "}"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"Min", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Length", "[", "Op4", "]"}], ",", 
              RowBox[{"Length", "[", "Op7", "]"}]}], "}"}], "]"}], "}"}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Check", " ", "for", " ", "the", " ", "valid", " ", "contractions", 
         " ", "between", " ", "hamiltonian", " ", "and", " ", "ket"}], "*)"}],
        "\[IndentingNewLine]", 
       RowBox[{"conHcKa2", "=", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "[", 
               RowBox[{"Intersection", "[", 
                RowBox[{"Flatten", "[", 
                 RowBox[{"ConHcKa", "[", 
                  RowBox[{"[", "i1", "]"}], "]"}], "]"}], "]"}], "]"}], "==", 
              
              RowBox[{
               RowBox[{"Min", "[", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"Length", "[", "Op3", "]"}], ",", 
                  RowBox[{"Length", "[", "Op8", "]"}]}], "}"}], "]"}], "*", 
               "2"}]}], ",", 
             RowBox[{"ConHcKa", "[", 
              RowBox[{"[", "i1", "]"}], "]"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i1", ",", 
             RowBox[{"Length", "[", "ConHcKa", "]"}]}], "}"}]}], "]"}], " ", "/.",
          " ", 
         RowBox[{"Null", " ", "->", " ", 
          RowBox[{"Sequence", "[", "]"}]}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"conHaKc2", "=", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "[", 
               RowBox[{"Intersection", "[", 
                RowBox[{"Flatten", "[", 
                 RowBox[{"ConHaKc", "[", 
                  RowBox[{"[", "i1", "]"}], "]"}], "]"}], "]"}], "]"}], "==", 
              
              RowBox[{
               RowBox[{"Min", "[", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"Length", "[", "Op4", "]"}], ",", 
                  RowBox[{"Length", "[", "Op7", "]"}]}], "}"}], "]"}], "*", 
               "2"}]}], ",", 
             RowBox[{"ConHaKc", "[", 
              RowBox[{"[", "i1", "]"}], "]"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i1", ",", 
             RowBox[{"Length", "[", "ConHaKc", "]"}]}], "}"}]}], "]"}], " ", "/.",
          " ", 
         RowBox[{"Null", " ", "->", " ", 
          RowBox[{"Sequence", "[", "]"}]}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "All", " ", "the", " ", "possible", " ", "convinations", " ", 
         "between", " ", "the", " ", "valid", " ", "contractions", " ", "of", 
         " ", "Hamiltonianand", " ", "Ket"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"ValConHK", "=", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Partition", "[", 
             RowBox[{"#", ",", "2"}], "]"}], "&"}], " ", "@", 
           RowBox[{"Flatten", "[", "#", "]"}]}], "&"}], "/@", 
         RowBox[{"Tuples", "[", 
          RowBox[{"{", 
           RowBox[{"conHcKa2", ",", "conHaKc2"}], "}"}], "]"}]}]}], " ", ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "for", " ", "each", " ", "case", " ", "separate", " ", "the", "  ", 
         "Hamiltonian", " ", "and", " ", "Ket", " ", "contractions", " ", 
         "and", " ", "the", " ", "uncontracted", " ", "terms", " ", "in", " ",
          "the", " ", "Hamiltonian"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"remainOpHamiltonian", "=", 
        RowBox[{"Table", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"MemberQ", "[", 
                 RowBox[{
                  RowBox[{"Intersection", "[", 
                   RowBox[{
                    RowBox[{"Flatten", "[", 
                    RowBox[{"ValConHK", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "]"}], ",", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{"{", 
                    RowBox[{"Op3", ",", "Op4"}], "}"}], "]"}]}], "]"}], ",", 
                  RowBox[{
                   RowBox[{"Flatten", "[", 
                    RowBox[{"{", 
                    RowBox[{"Op3", ",", "Op4"}], "}"}], "]"}], "[", 
                   RowBox[{"[", "i1", "]"}], "]"}]}], "]"}], "==", "False"}], 
               ",", 
               RowBox[{
                RowBox[{"Flatten", "[", 
                 RowBox[{"{", 
                  RowBox[{"Op3", ",", "Op4"}], "}"}], "]"}], "[", 
                RowBox[{"[", "i1", "]"}], "]"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i1", ",", 
               RowBox[{"Length", "[", 
                RowBox[{"Flatten", "[", 
                 RowBox[{"{", 
                  RowBox[{"Op3", ",", "Op4"}], "}"}], "]"}], "]"}]}], "}"}]}],
             "]"}], " ", "/.", " ", 
           RowBox[{"Null", "->", " ", 
            RowBox[{"Sequence", "[", "]"}]}]}], "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"j1", ",", 
            RowBox[{"Length", "[", "ValConHK", "]"}]}], "}"}]}], "]"}]}], ";",
        "\[IndentingNewLine]", 
       RowBox[{"remainOpHamiltonian1", "=", "\[IndentingNewLine]", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Intersection", "[", 
             RowBox[{"Op3", ",", 
              RowBox[{"remainOpHamiltonian", "[", 
               RowBox[{"[", "i1", "]"}], "]"}]}], "]"}], ",", 
            RowBox[{"Intersection", "[", 
             RowBox[{"Op4", ",", 
              RowBox[{"remainOpHamiltonian", "[", 
               RowBox[{"[", "i1", "]"}], "]"}]}], "]"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"i1", ",", 
            RowBox[{"Length", "[", "remainOpHamiltonian", "]"}]}], "}"}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "This", " ", "variable", " ", "is", " ", "the", " ", "must", " ", 
         "important", " ", "it", " ", "checks", " ", "if", " ", "the", " ", 
         "string", " ", "will", " ", "be", " ", "zero", " ", "or", " ", 
         "not"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"BoolString", "=", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"ManyBodyTerms", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "===", 
           RowBox[{"ManyBodyTerms", "[", 
            RowBox[{"[", "4", "]"}], "]"}], "===", 
           RowBox[{"{", "}"}]}], ",", 
          RowBox[{
           RowBox[{"Length", "[", 
            RowBox[{"ManyBodyTerms", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "]"}], "==", 
           RowBox[{"Length", "[", 
            RowBox[{"Flatten", "[", 
             RowBox[{"ManyBodyTerms", "[", 
              RowBox[{"[", "3", "]"}], "]"}], "]"}], "]"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"ManyBodyTerms", "[", 
              RowBox[{"[", "3", "]"}], "]"}], "===", 
             RowBox[{"{", "}"}]}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "[", 
               RowBox[{"ManyBodyTerms", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "]"}], "+", 
              RowBox[{"Length", "[", 
               RowBox[{"ManyBodyTerms", "[", 
                RowBox[{"[", "4", "]"}], "]"}], "]"}]}], "===", 
             RowBox[{"Length", "[", 
              RowBox[{"ManyBodyTerms", "[", 
               RowBox[{"[", "2", "]"}], "]"}], "]"}]}], ",", 
            RowBox[{
             RowBox[{"MemberQ", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"Length", "[", 
                   RowBox[{"Flatten", "[", 
                    RowBox[{"ManyBodyTerms", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "]"}], "]"}], "-", 
                  RowBox[{"Select", "[", 
                   RowBox[{
                    RowBox[{"Range", "[", 
                    RowBox[{"Length", "[", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{"remainOpHamiltonian1", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "]"}], ",", 
                    
                    RowBox[{
                    RowBox[{"#", ">=", 
                    RowBox[{"Length", "[", 
                    RowBox[{"ManyBodyTerms", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "]"}]}], "&"}]}], "]"}]}],
                  ")"}], "+", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"Length", "[", 
                   RowBox[{"Flatten", "[", 
                    RowBox[{"remainOpHamiltonian1", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "-", 
                  RowBox[{"Select", "[", 
                   RowBox[{
                    RowBox[{"Range", "[", 
                    RowBox[{"Length", "[", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{"remainOpHamiltonian1", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "]"}], ",", 
                    
                    RowBox[{
                    RowBox[{"#", ">=", 
                    RowBox[{"Length", "[", 
                    RowBox[{"ManyBodyTerms", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "]"}]}], "&"}]}], "]"}]}],
                  ")"}]}], ",", 
               RowBox[{"Length", "[", 
                RowBox[{"ManyBodyTerms", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "]"}], "&&", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Length", "[", 
                RowBox[{"ManyBodyTerms", "[", 
                 RowBox[{"[", "4", "]"}], "]"}], "]"}], "<", 
               RowBox[{"Length", "[", 
                RowBox[{"ManyBodyTerms", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "]"}]}], ")"}]}]}], "]"}]}], 
         "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"numHcont", "=", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"ManyBodyTerms", "[", 
            RowBox[{"[", "3", "]"}], "]"}], "===", 
           RowBox[{"{", "}"}]}], ",", 
          RowBox[{"{", "0", "}"}], ",", 
          RowBox[{
           RowBox[{"Select", "[", 
            RowBox[{
             RowBox[{"Range", "[", 
              RowBox[{"Length", "[", 
               RowBox[{"Flatten", "[", 
                RowBox[{"remainOpHamiltonian1", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "]"}], ",", 
             RowBox[{
              RowBox[{"#", ">=", 
               RowBox[{"Length", "[", 
                RowBox[{"ManyBodyTerms", "[", 
                 RowBox[{"[", "3", "]"}], "]"}], "]"}]}], "&"}]}], "]"}], "[", 
           RowBox[{"[", 
            RowBox[{"Flatten", "[", 
             RowBox[{"Position", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"Length", "[", 
                   RowBox[{"Flatten", "[", 
                    RowBox[{"ManyBodyTerms", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "]"}], "]"}], "-", 
                  RowBox[{"Select", "[", 
                   RowBox[{
                    RowBox[{"Range", "[", 
                    RowBox[{"Length", "[", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{"remainOpHamiltonian1", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "]"}], ",", 
                    
                    RowBox[{
                    RowBox[{"#", ">=", 
                    RowBox[{"Length", "[", 
                    RowBox[{"ManyBodyTerms", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "]"}]}], "&"}]}], "]"}]}],
                  ")"}], "+", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"Length", "[", 
                   RowBox[{"Flatten", "[", 
                    RowBox[{"remainOpHamiltonian1", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "-", 
                  RowBox[{"Select", "[", 
                   RowBox[{
                    RowBox[{"Range", "[", 
                    RowBox[{"Length", "[", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{"remainOpHamiltonian1", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "]"}], ",", 
                    
                    RowBox[{
                    RowBox[{"#", ">=", 
                    RowBox[{"Length", "[", 
                    RowBox[{"ManyBodyTerms", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "]"}]}], "&"}]}], "]"}]}],
                  ")"}]}], ",", 
               RowBox[{"Length", "[", 
                RowBox[{"ManyBodyTerms", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "]"}], "]"}], "]"}],
            "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "If", "  ", "BoolString", " ", "is", " ", "false", " ", "goes", " ", 
         "to", " ", "the", " ", 
         RowBox[{"end", ".", "  ", "If"}], " ", "it", " ", "is", " ", "true", 
         " ", "the", " ", "string", " ", "continue", " ", "the", " ", 
         "contraction"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"FullContract", "=", 
        RowBox[{"If", "[", 
         RowBox[{"BoolString", ",", "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{
           "From", " ", "the", " ", "remaining", " ", "terms", " ", "in", " ",
             "the", " ", "Hamiltonian", " ", "check", " ", "if", " ", "it", 
            " ", "is", " ", "possible", " ", "to", " ", "do", " ", "one", " ",
             "or", " ", "multiple", " ", "contractions", " ", "wich", " ", 
            "the", " ", "Cluster", " ", "Operators"}], "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ConHClust", "=", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{"Table", "[", 
                 RowBox[{
                  RowBox[{"Tuples", "[", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"remainOpHamiltonian1", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Op6", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], ",", 
                    RowBox[{"Op5", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}]}], "}"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}]}], "}"}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"i1", ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"Op6", ",", "Op5"}], "}"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
                ",", 
                RowBox[{"{", 
                 RowBox[{"j1", ",", 
                  RowBox[{"Length", "[", "remainOpHamiltonian1", "]"}]}], 
                 "}"}]}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"k1", ",", 
                RowBox[{"Length", "[", 
                 RowBox[{"{", 
                  RowBox[{"Op6", ",", "Op5"}], "}"}], "]"}]}], "}"}]}], 
             "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
            "All", " ", "possible", " ", "combinations", " ", "of", " ", 
             "contraction", " ", "between", " ", "Hamiltonian", " ", "with", 
             " ", "Cluster", " ", "Operators"}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"RandomHClust", "=", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"Subsets", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"Partition", "[", 
                   RowBox[{"#", ",", "2"}], "]"}], "&"}], "@", 
                 RowBox[{"Flatten", "[", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"ConHClust", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{"ConHClust", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}]}], "}"}], "]"}]}], ",", 
                "numHcont"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"i1", ",", 
                RowBox[{"Length", "[", 
                 RowBox[{"ConHClust", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
            "combinations", " ", "of", " ", "length", " ", "of", " ", 
             "asigned", " ", "contractions"}], "*)"}], "\[IndentingNewLine]", 
           
           RowBox[{"NonRepHTs", "=", 
            RowBox[{"Table", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"RandomHClust", "[", 
                RowBox[{"[", "i1", "]"}], "]"}], "[", 
               RowBox[{"[", 
                RowBox[{"Flatten", " ", "@", 
                 RowBox[{"Position", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", "#", "]"}], "&"}], "@", 
                    RowBox[{"DeleteDuplicates", "[", "#", "]"}]}], "&"}], "@", 
                    RowBox[{"Flatten", "[", "#", "]"}]}], "&"}], "/@", 
                    RowBox[{"RandomHClust", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}]}], ",", 
                   RowBox[{"2", 
                    RowBox[{"numHcont", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}]}], "]"}]}], "]"}], "]"}],
               "\[IndentingNewLine]", ",", 
              RowBox[{"{", 
               RowBox[{"i1", ",", 
                RowBox[{"Length", "[", "RandomHClust", "]"}]}], "}"}]}], 
             "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
            "Look", " ", "ath", " ", "the", " ", "possitions", " ", "of", " ",
              "the", " ", "connected", " ", "Hamiltonian", " ", "and", " ", 
             "Cluster"}], "*)"}], "\[IndentingNewLine]", 
           RowBox[{"PositionConected", "=", "\[IndentingNewLine]", 
            RowBox[{"Table", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"Position", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Times", "@@", 
                   RowBox[{"Table", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", "#", "]"}], "&"}], "@", 
                    RowBox[{"Intersection", "[", 
                    RowBox[{"i1", ",", "#"}], "]"}]}], "&"}], "@", " ", 
                    RowBox[{"Flatten", "[", "#", "]"}]}], "&"}], "/@", 
                    RowBox[{"NonRepHTs", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}]}], ",", 
                    RowBox[{"{", 
                    RowBox[{"i1", ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Flatten", "[", "#", "]"}], "&"}], "/@", 
                    RowBox[{"Transpose", "[", 
                    RowBox[{"{", 
                    RowBox[{"Op6", ",", "Op5"}], "}"}], "]"}]}]}], "}"}]}], 
                    "]"}]}], "//", " ", "Transpose"}], ",", 
                 RowBox[{"_", "?", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"#", ">", "0"}], "&"}], ")"}]}]}], "]"}], " ", "//",
                " ", "Flatten"}], "\[IndentingNewLine]", ",", 
              RowBox[{"{", 
               RowBox[{"j1", ",", 
                RowBox[{"Length", "[", "NonRepHTs", "]"}]}], "}"}]}], "]"}]}],
            ";", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
            "Based", " ", "on", " ", "the", " ", "position", " ", "ccombine", 
             " ", "the", " ", "possible", " ", "contractions", " ", 
             "Hamiltonian", " ", "and", " ", "Cluster"}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"CombineHTs", "=", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"NonRepHTs", "[", 
                RowBox[{"[", "i1", "]"}], "]"}], "[", 
               RowBox[{"[", 
                RowBox[{"PositionConected", "[", 
                 RowBox[{"[", "i1", "]"}], "]"}], "]"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"i1", ",", 
                RowBox[{"Length", "[", "PositionConected", "]"}]}], "}"}]}], 
             "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
            "For", " ", "each", " ", "combination", " ", "obtain", " ", "the",
              " ", "remaining", " ", "contractions", " ", "in", " ", "the", 
             " ", "hamiltonian", " ", "and", " ", "Cluster", " ", 
             "Operator"}], "*)"}], "\[IndentingNewLine]", 
           RowBox[{"RemainHTs", "=", 
            RowBox[{"Table", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"Complement", "[", 
                   RowBox[{"#", ",", "i1"}], "]"}], "&"}], " ", "/@", " ", 
                 RowBox[{"Insert", "[", 
                  RowBox[{
                   RowBox[{"remainOpHamiltonian1", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], ",", 
                   RowBox[{"Unevaluated", "[", 
                    RowBox[{"Sequence", "@@", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Flatten", "[", "Op5", "]"}], ",", 
                    RowBox[{"Flatten", "[", "Op6", "]"}]}], "}"}]}], "]"}], 
                   ",", "1"}], "]"}]}], ",", 
                RowBox[{"{", 
                 RowBox[{"i1", ",", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Flatten", "[", "#", "]"}], "&"}], "/@", 
                   RowBox[{"CombineHTs", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}]}]}], "}"}]}], "]"}], " ", 
              "\[IndentingNewLine]", ",", 
              RowBox[{"{", 
               RowBox[{"j1", ",", 
                RowBox[{"Length", "[", "CombineHTs", "]"}]}], "}"}]}], 
             "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
            "Contracting", " ", "fo", " ", "the", " ", "remaining", " ", 
             "operators"}], "*)"}], "\[IndentingNewLine]", 
           RowBox[{"contBrHTs", "=", "\[IndentingNewLine]", 
            RowBox[{"Table", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Table", "[", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"Subsets", "[", 
                 RowBox[{
                  RowBox[{"Tuples", "[", 
                   RowBox[{"{", 
                    RowBox[{"Op2", ",", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"RemainHTs", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"RemainHTs", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "3", "]"}], "]"}]}], "}"}], "]"}]}], "}"}], 
                   "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"Length", "[", "Op2", "]"}], "}"}]}], "]"}], 
                "\[IndentingNewLine]", ",", 
                RowBox[{"{", 
                 RowBox[{"i1", ",", 
                  RowBox[{"Length", "[", 
                   RowBox[{"RemainHTs", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
              "\[IndentingNewLine]", ",", 
              RowBox[{"{", 
               RowBox[{"j1", ",", 
                RowBox[{"Length", "[", "RemainHTs", "]"}]}], "}"}]}], "]"}]}],
            ";", "\[IndentingNewLine]", 
           RowBox[{"contBrHTs2", "=", "\[IndentingNewLine]", 
            RowBox[{"Table", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Table", "[", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"Subsets", "[", 
                 RowBox[{
                  RowBox[{"Tuples", "[", 
                   RowBox[{"{", 
                    RowBox[{"Op1", ",", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"RemainHTs", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"RemainHTs", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "4", "]"}], "]"}]}], "}"}], "]"}]}], "}"}], 
                   "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"Length", "[", "Op1", "]"}], "}"}]}], "]"}], 
                "\[IndentingNewLine]", ",", 
                RowBox[{"{", 
                 RowBox[{"i1", ",", 
                  RowBox[{"Length", "[", 
                   RowBox[{"RemainHTs", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
              "\[IndentingNewLine]", ",", 
              RowBox[{"{", 
               RowBox[{"j1", ",", 
                RowBox[{"Length", "[", "RemainHTs", "]"}]}], "}"}]}], "]"}]}],
            ";", "\[IndentingNewLine]", 
           RowBox[{"contractBrHTs", "=", "\[IndentingNewLine]", 
            RowBox[{"Table", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Table", "[", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"Partition", "[", 
                    RowBox[{"#", ",", "2"}], "]"}], "&"}], "@", 
                   RowBox[{"Flatten", "[", "#", "]"}]}], "&"}], "/@", 
                 RowBox[{"Tuples", "[", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"contBrHTs", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"Position", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", "#", "]"}], "&"}], "@", 
                    RowBox[{"DeleteDuplicates", "[", "#", "]"}]}], "&"}], "@", 
                    RowBox[{"Flatten", "[", "#", "]"}]}], "&"}], "/@", " ", 
                    RowBox[{
                    RowBox[{"contBrHTs", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}]}], ",", 
                    RowBox[{"2", "*", 
                    RowBox[{"Length", "[", "Op2", "]"}]}]}], "]"}], "//", 
                    "Flatten"}], "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"contBrHTs2", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"Position", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", "#", "]"}], "&"}], "@", 
                    RowBox[{"DeleteDuplicates", "[", "#", "]"}]}], "&"}], "@", 
                    RowBox[{"Flatten", "[", "#", "]"}]}], "&"}], "/@", " ", 
                    RowBox[{
                    RowBox[{"contBrHTs2", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}]}], ",", 
                    RowBox[{"2", "*", 
                    RowBox[{"Length", "[", "Op1", "]"}]}]}], "]"}], "//", 
                    "Flatten"}], "]"}], "]"}]}], "}"}], "]"}]}], 
                "\[IndentingNewLine]", ",", 
                RowBox[{"{", 
                 RowBox[{"i1", ",", 
                  RowBox[{"Length", "[", 
                   RowBox[{"RemainHTs", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
              "\[IndentingNewLine]", ",", 
              RowBox[{"{", 
               RowBox[{"j1", ",", 
                RowBox[{"Length", "[", "RemainHTs", "]"}]}], "}"}]}], "]"}]}],
            ";", "\[IndentingNewLine]", 
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Table", "[", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"Table", "[", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"Partition", "[", 
                    RowBox[{"#", ",", "2"}], "]"}], "&"}], "@", 
                    RowBox[{"Flatten", "[", "#", "]"}]}], "&"}], "@", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"contractBrHTs", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], ",", 
                    RowBox[{"ValConHK", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{"CombineHTs", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}]}], "}"}]}], 
                 "\[IndentingNewLine]", ",", 
                 RowBox[{"{", 
                  RowBox[{"i1", ",", 
                   RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{"contractBrHTs", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
               "\[IndentingNewLine]", ",", 
               RowBox[{"{", 
                RowBox[{"j1", ",", 
                 RowBox[{"Length", "[", 
                  RowBox[{"CombineHTs", "[", 
                   RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
             "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"k1", ",", 
               RowBox[{"Length", "[", "ValConHK", "]"}]}], "}"}]}], "]"}]}], 
          ",", 
          RowBox[{"Sequence", "[", "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"SignCont", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"sign", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"FullContract", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                   RowBox[{"[", "j1", "]"}], "]"}], "[", 
                  RowBox[{"[", "i1", "]"}], "]"}], "}"}], ",", 
                "ManyBodyTerms"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"i1", ",", 
                RowBox[{"Length", "[", 
                 RowBox[{
                  RowBox[{"FullContract", "[", 
                   RowBox[{"[", "k1", "]"}], "]"}], "[", 
                  RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
            ",", 
            RowBox[{"{", 
             RowBox[{"j1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{"FullContract", "[", 
                RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"k1", ",", 
            RowBox[{"Length", "[", "FullContract", "]"}]}], "}"}]}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"Return", "[", 
        RowBox[{"{", 
         RowBox[{"FullContract", ",", "BoolString", ",", "SignCont"}], "}"}], 
        " ", "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "It", " ", "is", " ", "used", " ", "For", " ", "Full", " ", "Contractions",
     " ", "including", " ", "contractions", " ", "of", " ", "indexes", " ", 
    "between", " ", "the", " ", "bra", " ", "and", " ", "the", " ", "ket"}], 
   "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"eomcontractexternal", "[", "ete_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "ls", ",", "let1", ",", "num1", ",", "parnum", ",", "ld1", ",", "ld2", 
       ",", "ld3", ",", "ld4", ",", "ld5", ",", "ld6", ",", "ld7", ",", "ld8",
        ",", "externalcontract", ",", "delkron", ",", "a1", ",", "a2", ",", 
       "a3", ",", "a4", ",", "tup1", ",", "tup2", ",", "tup3", ",", "tup4", 
       ",", "a5", ",", "kronlength", ",", "numinbra1", ",", "numinbra2", ",", 
       "pretup1", ",", "pretup2", ",", "delkron1", ",", "delkron2", ",", 
       "deletecontracted", ",", "delcont1", ",", "pos", ",", "remlist", ",", 
       "remlist0", ",", "remlist01", ",", "remlist02", ",", "remlist1", ",", 
       "remlist2", ",", "remlist3", ",", "etet1", ",", "etet2", ",", 
       "tupdisc1", ",", "tupdisc2", ",", "nonunicdisc", ",", "pos2", ",", 
       "disconected", ",", "tabdiscon", ",", "sub", ",", "list", ",", "list2",
        ",", "list3", ",", "permbraket"}], "}"}], ",", "\[IndentingNewLine]", 
     
     RowBox[{
      RowBox[{"ls", "=", 
       RowBox[{"{", "}"}]}], ";", "   ", 
      RowBox[{"let1", "=", 
       RowBox[{"{", "}"}]}], ";", " ", 
      RowBox[{"num1", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Flatten", "[", "ete", "]"}], "[", 
             RowBox[{"[", "i1", "]"}], "]"}], "[", 
            RowBox[{"[", "0", "]"}], "]"}], "===", "SuperDagger"}], ",", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"ls", ",", 
            RowBox[{
             RowBox[{
              RowBox[{"Flatten", "[", "ete", "]"}], "[", 
              RowBox[{"[", "i1", "]"}], "]"}], "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ",", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"ls", ",", 
            RowBox[{
             RowBox[{"Flatten", "[", "ete", "]"}], "[", 
             RowBox[{"[", "i1", "]"}], "]"}]}], "]"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i1", ",", 
          RowBox[{"Length", "[", 
           RowBox[{"Flatten", "[", "ete", "]"}], "]"}]}], "}"}]}], "]"}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"let1", "=", 
       RowBox[{
        RowBox[{"ImportString", "[", 
         RowBox[{
          RowBox[{"ExportString", "[", 
           RowBox[{"ls", ",", "\"\<CSV\>\""}], "]"}], " ", ",", 
          RowBox[{"{", 
           RowBox[{"\"\<CSV\>\"", ",", "\"\<RawData\>\""}], "}"}]}], "]"}], 
        " ", "//", "InputForm"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"let1", "=", 
       RowBox[{"Flatten", "/@", " ", "let1"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"num1", "=", 
       RowBox[{"Table", "[", 
        RowBox[{"i1", ",", 
         RowBox[{"{", 
          RowBox[{"i1", ",", 
           RowBox[{"Length", "[", 
            RowBox[{"let1", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"parnum", "=", 
       RowBox[{
        RowBox[{"Length", "[", 
         RowBox[{"let1", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}], "/", "2"}]}], ";", 
      "\[IndentingNewLine]", " ", 
      RowBox[{"ld1", "=", 
       RowBox[{"{", "}"}]}], ";", " ", 
      RowBox[{"ld2", "=", 
       RowBox[{"{", "}"}]}], ";", "   ", 
      RowBox[{"ld3", "=", 
       RowBox[{"{", "}"}]}], ";", " ", 
      RowBox[{"ld4", "=", 
       RowBox[{"{", "}"}]}], ";", "   ", 
      RowBox[{"ld5", "=", 
       RowBox[{"{", "}"}]}], ";", "    ", 
      RowBox[{"ld6", "=", 
       RowBox[{"{", "}"}]}], ";", "    ", 
      RowBox[{"ld7", "=", 
       RowBox[{"{", "}"}]}], ";", " ", 
      RowBox[{"ld8", "=", 
       RowBox[{"{", "}"}]}], ";", "  ", "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"ete", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "[", 
              RowBox[{"[", "j1", "]"}], "]"}], "[", 
             RowBox[{"[", "0", "]"}], "]"}], "===", "SuperDagger"}], ",", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"ld1", ",", 
             RowBox[{
              RowBox[{
               RowBox[{"ete", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "[", 
               RowBox[{"[", "j1", "]"}], "]"}], "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ",", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"ld2", ",", 
             RowBox[{
              RowBox[{"ete", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "[", 
              RowBox[{"[", "j1", "]"}], "]"}]}], "]"}]}], "]"}], ";"}], 
        "\[IndentingNewLine]", ",", 
        RowBox[{"{", 
         RowBox[{"j1", ",", 
          RowBox[{"Length", "[", 
           RowBox[{"ete", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"ete", "[", 
               RowBox[{"[", "2", "]"}], "]"}], "[", 
              RowBox[{"[", "j1", "]"}], "]"}], "[", 
             RowBox[{"[", "0", "]"}], "]"}], "===", "SuperDagger"}], ",", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"ld3", ",", 
             RowBox[{
              RowBox[{
               RowBox[{"ete", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "[", 
               RowBox[{"[", "j1", "]"}], "]"}], "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ",", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"ld4", ",", 
             RowBox[{
              RowBox[{"ete", "[", 
               RowBox[{"[", "2", "]"}], "]"}], "[", 
              RowBox[{"[", "j1", "]"}], "]"}]}], "]"}]}], "]"}], ";"}], 
        "\[IndentingNewLine]", ",", 
        RowBox[{"{", 
         RowBox[{"j1", ",", 
          RowBox[{"Length", "[", 
           RowBox[{"ete", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"ete", "[", 
                RowBox[{"[", "3", "]"}], "]"}], "[", 
               RowBox[{"[", "j1", "]"}], "]"}], "[", 
              RowBox[{"[", "k1", "]"}], "]"}], "[", 
             RowBox[{"[", "0", "]"}], "]"}], "===", "SuperDagger"}], ",", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"ld5", ",", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"ete", "[", 
                 RowBox[{"[", "3", "]"}], "]"}], "[", 
                RowBox[{"[", "j1", "]"}], "]"}], "[", 
               RowBox[{"[", "k1", "]"}], "]"}], "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ",", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"ld6", ",", 
             RowBox[{
              RowBox[{
               RowBox[{"ete", "[", 
                RowBox[{"[", "3", "]"}], "]"}], "[", 
               RowBox[{"[", "j1", "]"}], "]"}], "[", 
              RowBox[{"[", "k1", "]"}], "]"}]}], "]"}]}], "]"}], ";"}], 
        "\[IndentingNewLine]", ",", 
        RowBox[{"{", 
         RowBox[{"j1", ",", 
          RowBox[{"Length", "[", 
           RowBox[{"ete", "[", 
            RowBox[{"[", "3", "]"}], "]"}], "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"k1", ",", 
          RowBox[{"Length", "[", 
           RowBox[{
            RowBox[{"ete", "[", 
             RowBox[{"[", "3", "]"}], "]"}], "[", 
            RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"ete", "[", 
               RowBox[{"[", "4", "]"}], "]"}], "[", 
              RowBox[{"[", "j1", "]"}], "]"}], "[", 
             RowBox[{"[", "0", "]"}], "]"}], "===", "SuperDagger"}], ",", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"ld7", ",", 
             RowBox[{
              RowBox[{
               RowBox[{"ete", "[", 
                RowBox[{"[", "4", "]"}], "]"}], "[", 
               RowBox[{"[", "j1", "]"}], "]"}], "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ",", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"ld8", ",", 
             RowBox[{
              RowBox[{"ete", "[", 
               RowBox[{"[", "4", "]"}], "]"}], "[", 
              RowBox[{"[", "j1", "]"}], "]"}]}], "]"}]}], "]"}], ";"}], 
        "\[IndentingNewLine]", ",", 
        RowBox[{"{", 
         RowBox[{"j1", ",", 
          RowBox[{"Length", "[", 
           RowBox[{"ete", "[", 
            RowBox[{"[", "4", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Contractions", " ", "between", " ", "the", " ", "bra", " ", "and", 
        " ", "ket"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"externalcontract", "=", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Length", "[", 
                RowBox[{"ete", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "]"}], "==", 
               RowBox[{
                RowBox[{"Length", "[", 
                 RowBox[{"ete", "[", 
                  RowBox[{"[", "4", "]"}], "]"}], "]"}], "+", "i1"}]}], ",", 
              "Null", ",", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"Element", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Length", "[", 
                    RowBox[{"ete", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "+", 
                   RowBox[{"Length", "[", 
                    RowBox[{"ete", "[", 
                    RowBox[{"[", "4", "]"}], "]"}], "]"}], "-", "i1"}], ",", 
                  "NegativeIntegers"}], "]"}], ",", "Null", ",", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"i1", "-", 
                    RowBox[{"Length", "[", 
                    RowBox[{"ete", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ">", "2"}], ",", 
                  "Null", ",", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"ete", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "+", 
                    RowBox[{"Length", "[", 
                    RowBox[{"ete", "[", 
                    RowBox[{"[", "4", "]"}], "]"}], "]"}], "-", "i1"}], ")"}],
                     "/", "2"}], ")"}]}], "]"}]}], "]"}]}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i1", ",", 
              RowBox[{"{", 
               RowBox[{"2", ",", "4", ",", "6"}], "}"}]}], "}"}]}], "]"}], 
          " ", "/.", " ", 
          RowBox[{"Null", " ", "->", " ", 
           RowBox[{"Sequence", "[", "]"}]}]}]}], ";"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Contractions", " ", "between", " ", "the", " ", "bra", " ", "and", 
        " ", "ket"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"externalcontract", "=", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Length", "[", 
                RowBox[{"ete", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "]"}], "==", 
               RowBox[{
                RowBox[{"Length", "[", 
                 RowBox[{"ete", "[", 
                  RowBox[{"[", "4", "]"}], "]"}], "]"}], "+", "i1"}]}], ",", 
              "Null", ",", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"Element", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Length", "[", 
                    RowBox[{"ete", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "+", 
                   RowBox[{"Length", "[", 
                    RowBox[{"ete", "[", 
                    RowBox[{"[", "4", "]"}], "]"}], "]"}], "-", "i1"}], ",", 
                  "NegativeIntegers"}], "]"}], ",", "Null", ",", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"i1", "<=", 
                   RowBox[{"Length", "[", 
                    RowBox[{"ete", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ",", "Null", ",", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"ete", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "+", 
                    RowBox[{"Length", "[", 
                    RowBox[{"ete", "[", 
                    RowBox[{"[", "4", "]"}], "]"}], "]"}], "-", "i1"}], ")"}],
                     "/", "2"}], ")"}]}], "]"}]}], "]"}]}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i1", ",", 
              RowBox[{"{", 
               RowBox[{"2", ",", "4", ",", "6"}], "}"}]}], "}"}]}], "]"}], 
          " ", "/.", " ", 
          RowBox[{"Null", " ", "->", " ", 
           RowBox[{"Sequence", "[", "]"}]}]}]}], ";"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"externalcontract", "=", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Length", "[", 
              RowBox[{"ete", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}], "==", 
             RowBox[{
              RowBox[{"Length", "[", 
               RowBox[{"ete", "[", 
                RowBox[{"[", "4", "]"}], "]"}], "]"}], "+", "i1"}]}], ",", 
            "Null", ",", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"Element", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Length", "[", 
                  RowBox[{"ete", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "]"}], "+", 
                 RowBox[{"Length", "[", 
                  RowBox[{"ete", "[", 
                   RowBox[{"[", "4", "]"}], "]"}], "]"}], "-", "i1"}], ",", 
                "NegativeIntegers"}], "]"}], ",", "Null", ",", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"ete", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "+", 
                    RowBox[{"Length", "[", 
                    RowBox[{"ete", "[", 
                    RowBox[{"[", "4", "]"}], "]"}], "]"}], "-", "i1"}], ")"}],
                    "/", "2"}], ")"}], ">", 
                 RowBox[{"Length", "[", 
                  RowBox[{"ete", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ",", "Null", ",", 
                
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"ete", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "+", 
                    RowBox[{"Length", "[", 
                    RowBox[{"ete", "[", 
                    RowBox[{"[", "4", "]"}], "]"}], "]"}], "-", "i1"}], ")"}],
                   "/", "2"}], ")"}]}], "]"}]}], "]"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i1", ",", 
            RowBox[{"{", 
             RowBox[{"2", ",", "4", ",", "6", ",", "8"}], "}"}]}], "}"}]}], 
         "]"}], "  ", "/.", " ", 
        RowBox[{"Null", " ", "->", " ", 
         RowBox[{"Sequence", "[", "]"}]}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "All", " ", "permutations", " ", "between", " ", "bra", " ", "and", 
        " ", "ket"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"delkron", "=", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"permbraket", "=", 
           RowBox[{"Subsets", "[", 
            RowBox[{
             RowBox[{"Union", "[", 
              RowBox[{
               RowBox[{"Tuples", "[", 
                RowBox[{"{", 
                 RowBox[{"ld1", ",", "ld8"}], "}"}], "]"}], ",", 
               RowBox[{"Tuples", "[", 
                RowBox[{"{", 
                 RowBox[{"ld2", ",", "ld7"}], "}"}], "]"}]}], "]"}], ",", 
             RowBox[{"{", "j1", "}"}]}], "]"}]}], " ", ";", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Length", "[", 
                 RowBox[{"DeleteDuplicates", "[", 
                  RowBox[{"Flatten", "[", 
                   RowBox[{"permbraket", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "]"}], "]"}], "]"}], "==",
                 " ", 
                RowBox[{"2", "*", "j1"}]}], ",", 
               RowBox[{"permbraket", "[", 
                RowBox[{"[", "i1", "]"}], "]"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i1", ",", 
               RowBox[{"Length", "[", "permbraket", "]"}]}], "}"}]}], "]"}], 
           " ", "/.", " ", 
           RowBox[{"Null", " ", "->", " ", 
            RowBox[{"Sequence", "[", "]"}]}]}]}], "\[IndentingNewLine]", ",", 
         
         RowBox[{"{", 
          RowBox[{"j1", ",", "externalcontract"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
         RowBox[{"All", " ", "permutations", " ", "bra"}], "-", "H"}], ",", 
        " ", 
        RowBox[{"bra", "-", 
         RowBox[{
          RowBox[{"T", "'"}], "s"}]}], ",", " ", 
        RowBox[{"bra", "-", 
         RowBox[{"ket", " ", "between"}]}]}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"a1", "=", 
       RowBox[{"Union", "[", 
        RowBox[{
         RowBox[{"Tuples", "[", 
          RowBox[{"{", 
           RowBox[{"ld2", ",", "ld3"}], "}"}], "]"}], ",", 
         RowBox[{"Tuples", "[", 
          RowBox[{"{", 
           RowBox[{"ld2", ",", "ld5"}], "}"}], "]"}], ",", 
         RowBox[{"Tuples", "[", 
          RowBox[{"{", 
           RowBox[{"ld2", ",", "ld7"}], "}"}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"a2", "=", 
       RowBox[{"Union", "[", 
        RowBox[{
         RowBox[{"Tuples", "[", 
          RowBox[{"{", 
           RowBox[{"ld1", ",", "ld4"}], "}"}], "]"}], ",", 
         RowBox[{"Tuples", "[", 
          RowBox[{"{", 
           RowBox[{"ld1", ",", "ld6"}], "}"}], "]"}], ",", 
         RowBox[{"Tuples", "[", 
          RowBox[{"{", 
           RowBox[{"ld1", ",", "ld8"}], "}"}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
         RowBox[{"All", " ", "permutations", " ", "H"}], "-", 
         RowBox[{
          RowBox[{"T", "'"}], "s"}]}], ",", " ", 
        RowBox[{"H", "-", 
         RowBox[{"ket", " ", "between"}]}]}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"a3", "=", 
       RowBox[{"Union", "[", 
        RowBox[{
         RowBox[{"Tuples", "[", 
          RowBox[{"{", 
           RowBox[{"ld3", ",", "ld6"}], "}"}], "]"}], ",", 
         RowBox[{"Tuples", "[", 
          RowBox[{"{", 
           RowBox[{"ld3", ",", "ld8"}], "}"}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"a4", "=", 
       RowBox[{"Union", "[", 
        RowBox[{
         RowBox[{"Tuples", "[", 
          RowBox[{"{", 
           RowBox[{"ld4", ",", "ld5"}], "}"}], "]"}], ",", 
         RowBox[{"Tuples", "[", 
          RowBox[{"{", 
           RowBox[{"ld4", ",", "ld7"}], "}"}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"tup1", ",", "tup2", ",", "tup3", ",", "tup4"}], "}"}], "=", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"j1", "=", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"{", "}"}], "\[IndentingNewLine]", ",", 
            RowBox[{"{", 
             RowBox[{"i1", ",", 
              RowBox[{"Length", "[", "delkron", "]"}]}], "}"}]}], "]"}]}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"j1", ",", "4"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"ld1", "^"}], "*"}], ",", "ld2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"ld3", "^"}], "*"}], ",", "ld4"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"ld5", "^"}], "*"}], ",", "ld6"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"ld7", "^"}], "*"}], ",", "ld8"}], "}"}]}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"remove", " ", "the", " ", "indices", " ", "of", " ", "a1"}], 
        ",", " ", "a2", ",", " ", "a3", ",", " ", 
        RowBox[{"a4", " ", "that", " ", "appear", " ", "in", " ", "delkron", 
         RowBox[{"(", 
          RowBox[{"bra", "-", "ket"}], ")"}]}], " ", ",", " ", 
        RowBox[{"and", " ", "genearte", " ", "tup1"}], ",", " ", "tup2", ",", 
        " ", 
        RowBox[{
        "tup3", " ", "and", " ", "tup4", " ", "for", " ", "each", " ", 
         "deltakron", " ", "we", " ", "have", " ", "as", " ", "much", " ", 
         "list", " ", "of", " ", "tups", " ", "as", " ", "the", " ", "size", 
         " ", "of", " ", "delkron"}]}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"tup1", "[", 
             RowBox[{"[", "i1", "]"}], "]"}], ",", 
            RowBox[{"tup2", "[", 
             RowBox[{"[", "i1", "]"}], "]"}]}], "}"}], "=", 
          RowBox[{"removecontracted", "[", 
           RowBox[{"a1", ",", "a2", ",", 
            RowBox[{"delkron", "[", 
             RowBox[{"[", "i1", "]"}], "]"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"tup3", "[", 
             RowBox[{"[", "i1", "]"}], "]"}], ",", 
            RowBox[{"tup4", "[", 
             RowBox[{"[", "i1", "]"}], "]"}]}], "}"}], "=", 
          RowBox[{"removecontracted", "[", 
           RowBox[{"a3", ",", "a4", ",", 
            RowBox[{"delkron", "[", 
             RowBox[{"[", "i1", "]"}], "]"}]}], "]"}]}], ";"}], 
        "\[IndentingNewLine]", ",", 
        RowBox[{"{", 
         RowBox[{"i1", ",", 
          RowBox[{"Length", "[", "delkron", "]"}]}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
         RowBox[{
         "Union", " ", "of", " ", "all", " ", "tuples", " ", "from", " ", 
          "bra"}], "-", "H"}], ",", " ", 
        RowBox[{"bra", "-", 
         RowBox[{
          RowBox[{"T", "'"}], "s"}]}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"a5", "=", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Union", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"tup3", "[", 
               RowBox[{"[", "j1", "]"}], "]"}], "[", 
              RowBox[{"[", "i1", "]"}], "]"}], ",", 
             RowBox[{
              RowBox[{"tup4", "[", 
               RowBox[{"[", "j1", "]"}], "]"}], "[", 
              RowBox[{"[", "i1", "]"}], "]"}]}], "]"}], "\[IndentingNewLine]",
            ",", 
           RowBox[{"{", 
            RowBox[{"i1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"tup3", "[", 
               RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"j1", ",", 
           RowBox[{"Length", "[", "tup3", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"N", "[", "bra", "]"}], "-"}], "*)"}], "\[IndentingNewLine]", 
      
      RowBox[{"kronlength", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", 
           RowBox[{"ete", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}], "-", 
          RowBox[{"Length", "[", 
           RowBox[{
            RowBox[{"delkron", "[", 
             RowBox[{"[", "i1", "]"}], "]"}], "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"i1", ",", 
           RowBox[{"Length", "[", "delkron", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "Select", " ", "wich", " ", "got", " ", "a", " ", "repeated", " ", 
         "index", " ", "either", " ", "a"}], " ", ",", " ", "b", ",", 
        RowBox[{
         RowBox[{
          RowBox[{"...", ".", " ", "if"}], " ", "contain", " ", "both"}], " ",
          "=", 
         RowBox[{
          RowBox[{"2", " ", "if", " ", "contain", " ", "one"}], " ", "=", 
          "1"}]}], ",", "..."}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"numinbra1", "=", "\[IndentingNewLine]", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Length", "[", 
            RowBox[{"Intersection", "[", 
             RowBox[{
              RowBox[{"DeleteDuplicates", "[", 
               RowBox[{"Flatten", "[", 
                RowBox[{
                 RowBox[{"tup1", "[", 
                  RowBox[{"[", "j1", "]"}], "]"}], "[", 
                 RowBox[{"[", "i1", "]"}], "]"}], "]"}], " ", "]"}], ",", 
              RowBox[{"Union", "[", 
               RowBox[{"ld1", ",", "ld2"}], "]"}]}], "]"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"tup1", "[", 
               RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"j1", ",", 
           RowBox[{"Length", "[", "tup1", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "Select", " ", "wich", " ", "got", " ", "a", " ", "repeated", " ", 
         "index", " ", "either", " ", "i", " ", "or", " ", "j"}], ",", " ", 
        RowBox[{
         RowBox[{"if", " ", "contain", " ", "boath"}], " ", "=", 
         RowBox[{
          RowBox[{"2", " ", "if", " ", "contain", " ", "one"}], " ", "=", 
          "1"}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"numinbra2", "=", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Length", "[", 
            RowBox[{"Intersection", "[", 
             RowBox[{
              RowBox[{"DeleteDuplicates", "[", 
               RowBox[{"Flatten", "[", 
                RowBox[{
                 RowBox[{"tup2", "[", 
                  RowBox[{"[", "j1", "]"}], "]"}], "[", 
                 RowBox[{"[", "i1", "]"}], "]"}], "]"}], " ", "]"}], ",", 
              RowBox[{"Union", "[", 
               RowBox[{"ld1", ",", "ld2"}], "]"}]}], "]"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"tup2", "[", 
               RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"j1", ",", 
           RowBox[{"Length", "[", "tup2", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "generate", "  ", "the", " ", "subsets", " ", "of", " ", "tup1", " ", 
        "of", " ", "length", " ", "equal", " ", "the", " ", "number", " ", 
        "of", " ", "niumbra"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"pretup1", "=", "\[IndentingNewLine]", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Length", "[", 
                  RowBox[{"DeleteDuplicates", "[", 
                   RowBox[{"Flatten", "[", 
                    RowBox[{
                    RowBox[{"Subsets", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"tup1", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"numinbra1", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "}"}]}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "]"}], "]"}], "]"}], "==", 
                 RowBox[{"2", "*", 
                  RowBox[{
                   RowBox[{"numinbra1", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                   RowBox[{"[", "j1", "]"}], "]"}]}]}], ",", 
                RowBox[{
                 RowBox[{"Subsets", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"tup1", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], ",", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"numinbra1", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "}"}]}], "]"}], "[", 
                 RowBox[{"[", "i1", "]"}], "]"}]}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"i1", ",", 
                RowBox[{"Length", "[", 
                 RowBox[{"Subsets", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"tup1", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], ",", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"numinbra1", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "}"}]}], "]"}], "]"}]}], 
               "}"}]}], "]"}], " ", "/.", " ", 
            RowBox[{"Null", " ", "->", " ", 
             RowBox[{"Sequence", "[", "]"}]}]}], "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"j1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"tup1", "[", 
               RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"k1", ",", 
           RowBox[{"Length", "[", "tup1", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "generate", "  ", "the", " ", "subsets", " ", "of", " ", "tup1", " ", 
        "of", " ", "length", " ", "equal", " ", "the", " ", "number", " ", 
        "of", " ", "contractions", " ", "en", " ", "each", " ", "tup2_", 
        RowBox[{"{", "ijk", "}"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"pretup2", "=", "\[IndentingNewLine]", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Length", "[", 
                  RowBox[{"DeleteDuplicates", "[", 
                   RowBox[{"Flatten", "[", 
                    RowBox[{
                    RowBox[{"Subsets", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"tup2", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"numinbra2", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "}"}]}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "]"}], "]"}], "]"}], "==", 
                 RowBox[{"2", "*", 
                  RowBox[{
                   RowBox[{"numinbra2", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                   RowBox[{"[", "j1", "]"}], "]"}]}]}], ",", 
                RowBox[{
                 RowBox[{"Subsets", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"tup2", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], ",", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"numinbra2", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "}"}]}], "]"}], "[", 
                 RowBox[{"[", "i1", "]"}], "]"}]}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"i1", ",", 
                RowBox[{"Length", "[", 
                 RowBox[{"Subsets", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"tup2", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], ",", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"numinbra2", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "}"}]}], "]"}], "]"}]}], 
               "}"}]}], "]"}], "  ", "/.", " ", 
            RowBox[{"Null", " ", "->", " ", 
             RowBox[{"Sequence", "[", "]"}]}]}], "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"j1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"tup2", "[", 
               RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"k1", ",", 
           RowBox[{"Length", "[", "tup1", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"delkron1", "=", "\[IndentingNewLine]", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"Map", "[", "Flatten", "]"}], "@", " ", 
            RowBox[{"Tuples", "[", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"pretup1", "[", 
                 RowBox[{"[", "j1", "]"}], "]"}], "[", 
                RowBox[{"[", "i1", "]"}], "]"}], ",", 
               RowBox[{
                RowBox[{"pretup2", "[", 
                 RowBox[{"[", "j1", "]"}], "]"}], "[", 
                RowBox[{"[", "i1", "]"}], "]"}]}], "}"}], "]"}]}], 
           "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"i1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"pretup1", "[", 
               RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"j1", ",", 
           RowBox[{"Length", "[", "pretup1", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "Separate", " ", "the", " ", "terms", " ", "in", " ", "pairs"}], ",", 
        " ", 
        RowBox[{
        "this", " ", "is", " ", "based", " ", "on", " ", "tup1", " ", "and", 
         " ", "tup2"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"delkron2", "=", "\[IndentingNewLine]", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Length", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"delkron1", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                   RowBox[{"[", "j1", "]"}], "]"}], "[", 
                  RowBox[{"[", "i1", "]"}], "]"}], "]"}], ">=", "4"}], ",", 
               RowBox[{"Partition", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"delkron1", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                   RowBox[{"[", "j1", "]"}], "]"}], "[", 
                  RowBox[{"[", "i1", "]"}], "]"}], ",", "2"}], "]"}], ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"delkron1", "[", 
                  RowBox[{"[", "k1", "]"}], "]"}], "[", 
                 RowBox[{"[", "j1", "]"}], "]"}], "[", 
                RowBox[{"[", "i1", "]"}], "]"}]}], "]"}], 
             "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"i1", ",", 
               RowBox[{"Length", "[", 
                RowBox[{
                 RowBox[{"delkron1", "[", 
                  RowBox[{"[", "k1", "]"}], "]"}], "[", 
                 RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
           "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"j1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"delkron1", "[", 
               RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"k1", ",", 
           RowBox[{"Length", "[", "delkron1", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
         RowBox[{
         "Look", " ", "fo", " ", "the", " ", "position", " ", "of", " ", 
          "delkron2"}], "=", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"Tuples", "[", 
            RowBox[{"pretup1", ",", "pretup2"}], "]"}], " ", "in", " ", 
           "a5"}], "=", 
          RowBox[{"tup3", " ", "U", " ", "tup4"}]}]}], ",", " ", 
        RowBox[{"this", " ", "is", " ", "based", " ", "on", " ", "a5"}]}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"deletecontracted", "=", "\[IndentingNewLine]", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"Table", "[", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"Floor", "[", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Position", "[", 
                    RowBox[{
                    RowBox[{"Flatten", "[", 
                    RowBox[{
                    RowBox[{"a5", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{"Flatten", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"delkron2", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}]}], "]"}], "+", "1"}], 
                    ")"}], "/", "2"}], "]"}], " ", "\[IndentingNewLine]", ",", 
                 RowBox[{"{", 
                  RowBox[{"i1", ",", 
                   RowBox[{"Length", "[", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"delkron2", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "]"}], "]"}]}], "}"}]}], 
                "]"}], "   ", "//", " ", "Flatten"}], " ", "//", " ", 
              "DeleteDuplicates"}], "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"j1", ",", 
               RowBox[{"Length", "[", 
                RowBox[{
                 RowBox[{"delkron2", "[", 
                  RowBox[{"[", "l1", "]"}], "]"}], "[", 
                 RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
           "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"k1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"delkron2", "[", 
               RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"l1", ",", 
           RowBox[{"Length", "[", "delkron2", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"deletecontracted", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"deletecontracted", "[", 
              RowBox[{"[", "l1", "]"}], "]"}], "[", 
             RowBox[{"[", "k1", "]"}], "]"}], "[", 
            RowBox[{"[", "j1", "]"}], "]"}], "[", 
           RowBox[{"[", "i1", "]"}], "]"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"l1", ",", 
           RowBox[{"Length", "[", "deletecontracted", "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"k1", ",", 
           RowBox[{"Length", "[", 
            RowBox[{"deletecontracted", "[", 
             RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"j1", ",", 
           RowBox[{"Length", "[", 
            RowBox[{
             RowBox[{"deletecontracted", "[", 
              RowBox[{"[", "l1", "]"}], "]"}], "[", 
             RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"i1", ",", 
           RowBox[{"Length", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"deletecontracted", "[", 
               RowBox[{"[", "l1", "]"}], "]"}], "[", 
              RowBox[{"[", "k1", "]"}], "]"}], "[", 
             RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "to", " ", "avoid", " ", "repeated", " ", "indexes", " ", "remove", 
         " ", "the", " ", "delkron2", " ", "that", " ", "are", " ", "in", " ",
          "a5"}], "=", 
        RowBox[{"tup3", " ", "U", " ", "tup4"}]}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"delcont1", "=", "\[IndentingNewLine]", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Delete", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"a5", "[", 
                 RowBox[{"[", "l1", "]"}], "]"}], "[", 
                RowBox[{"[", "k1", "]"}], "]"}], ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"deletecontracted", "[", 
                  RowBox[{"[", "l1", "]"}], "]"}], "[", 
                 RowBox[{"[", "k1", "]"}], "]"}], "[", 
                RowBox[{"[", "j1", "]"}], "]"}]}], "]"}], 
             "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"j1", ",", 
               RowBox[{"Length", "[", 
                RowBox[{
                 RowBox[{"deletecontracted", "[", 
                  RowBox[{"[", "l1", "]"}], "]"}], "[", 
                 RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
           "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"k1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"deletecontracted", "[", 
               RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"l1", ",", 
           RowBox[{"Length", "[", "deletecontracted", "]"}]}], "}"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Look", " ", "for", " ", "the", " ", "positions", " ", "in", " ", 
        "delcont1", " ", "where", " ", "we", " ", "can", "  ", "form", " ", 
        "4", " ", "tuples", " ", "each", " ", "one", " ", "containing", " ", 
        RowBox[{"{", 
         RowBox[{"p", ",", "q", ",", "r", ",", "s"}], "}"}], " ", "a", " ", 
        "WE", " ", "NEED", " ", "TO", " ", "RECHECK", " ", "THAT", " ", 
        "FUNCTION"}], "  ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Position", "[", 
            RowBox[{
             RowBox[{"Table", "[", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"Length", "[", 
                RowBox[{"Intersection", "[", 
                 RowBox[{
                  RowBox[{"Union", "[", 
                   RowBox[{"ld3", ",", "ld4"}], "]"}], ",", 
                  RowBox[{"DeleteDuplicates", "[", 
                   RowBox[{"Flatten", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"delcont1", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "]"}], "]"}]}], "]"}], 
                "]"}], "\[IndentingNewLine]", ",", 
               RowBox[{"{", 
                RowBox[{"i1", ",", 
                 RowBox[{"Length", "[", 
                  RowBox[{
                   RowBox[{"delcont1", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                   RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
             ",", " ", 
             RowBox[{"(", 
              RowBox[{"parnum", "-", 
               RowBox[{"Length", "[", 
                RowBox[{
                 RowBox[{"delkron", "[", 
                  RowBox[{"[", "k1", "]"}], "]"}], "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "]"}], "-", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"Length", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"delkron1", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "]"}], "/", "2"}], ")"}]}],
               ")"}]}], "]"}], "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"j1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"delcont1", "[", 
               RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"k1", ",", 
           RowBox[{"Length", "[", "delcont1", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Apply", " ", "the", " ", "possition", " ", "in", " ", "delcont", " ", 
        "where", " ", "we", " ", "can", " ", "form", "  ", "4", " ", "tuples",
         " ", "each", " ", "one", " ", "containing", " ", 
        RowBox[{"{", 
         RowBox[{"p", ",", "q", ",", "r", ",", "s"}], "}"}]}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"remlist0", "=", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"delcont1", "[", 
                 RowBox[{"[", "k1", "]"}], "]"}], "[", 
                RowBox[{"[", "j1", "]"}], "]"}], "[", 
               RowBox[{"[", "i1", "]"}], "]"}], "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i1", ",", 
               RowBox[{
                RowBox[{"pos", "[", 
                 RowBox[{"[", "k1", "]"}], "]"}], "[", 
                RowBox[{"[", "j1", "]"}], "]"}]}], "}"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"j1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"delcont1", "[", 
               RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"k1", ",", 
           RowBox[{"Length", "[", "delcont1", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"remlist1", "=", "\[IndentingNewLine]", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"delkron2", "[", 
                 RowBox[{"[", "k1", "]"}], "]"}], "[", 
                RowBox[{"[", "j1", "]"}], "]"}], "[", 
               RowBox[{"[", "i1", "]"}], "]"}], "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i1", ",", 
               RowBox[{
                RowBox[{"pos", "[", 
                 RowBox[{"[", "k1", "]"}], "]"}], "[", 
                RowBox[{"[", "j1", "]"}], "]"}]}], "}"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"j1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"delcont1", "[", 
               RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"k1", ",", 
           RowBox[{"Length", "[", "delcont1", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "Remove", " ", "the", " ", "disconected", " ", "terms", " ", "by", 
         " ", "counting", " ", "how", " ", "many", " ", "terms", " ", "from", 
         " ", "bra", " ", "and", " ", "ket", " ", "are", " ", "in", " ", 
         "delkron2"}], "=", " ", 
        RowBox[{"Tuples", "[", 
         RowBox[{
          RowBox[{"pretup1", 
           RowBox[{"(", "tup1", ")"}]}], ",", 
          RowBox[{"pretup2", 
           RowBox[{"(", "tup2", ")"}]}]}], "]"}]}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"remlist3", "=", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Length", "[", 
          RowBox[{"Intersection", "[", 
           RowBox[{
            RowBox[{"Flatten", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"remlist1", "[", 
                RowBox[{"[", "l1", "]"}], "]"}], "[", 
               RowBox[{"[", "k1", "]"}], "]"}], "[", 
              RowBox[{"[", "j1", "]"}], "]"}], "]"}], ",", 
            RowBox[{"Union", "[", 
             RowBox[{"ld1", ",", "ld2", ",", "ld7", ",", "ld8"}], "]"}]}], 
           "]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"l1", ",", 
           RowBox[{"Length", "[", "remlist1", "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"k1", ",", 
           RowBox[{"Length", "[", 
            RowBox[{"remlist1", "[", 
             RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"j1", ",", 
           RowBox[{"Length", "[", 
            RowBox[{
             RowBox[{"remlist1", "[", 
              RowBox[{"[", "l1", "]"}], "]"}], "[", 
             RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos2", "=", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Position", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"remlist3", "[", 
               RowBox[{"[", "j1", "]"}], "]"}], "[", 
              RowBox[{"[", "i1", "]"}], "]"}], ",", 
             RowBox[{
              RowBox[{"Length", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"delkron1", "[", 
                  RowBox[{"[", "j1", "]"}], "]"}], "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "[", 
                RowBox[{"[", "1", "]"}], "]"}], "]"}], "/", "2"}]}], "]"}], 
           "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"i1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"remlist3", "[", 
               RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"j1", ",", 
           RowBox[{"Length", "[", "remlist3", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"remlist01", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"remlist0", "[", 
                 RowBox[{"[", "k1", "]"}], "]"}], "[", 
                RowBox[{"[", "j1", "]"}], "]"}], "[", 
               RowBox[{"[", "i1", "]"}], "]"}], "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i1", ",", 
               RowBox[{
                RowBox[{"pos2", "[", 
                 RowBox[{"[", "k1", "]"}], "]"}], "[", 
                RowBox[{"[", "j1", "]"}], "]"}]}], "}"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"j1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"remlist0", "[", 
               RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
         
         RowBox[{"{", 
          RowBox[{"k1", ",", 
           RowBox[{"Length", "[", "remlist0", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"remlist02", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"remlist1", "[", 
                 RowBox[{"[", "k1", "]"}], "]"}], "[", 
                RowBox[{"[", "j1", "]"}], "]"}], "[", 
               RowBox[{"[", "i1", "]"}], "]"}], "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i1", ",", 
               RowBox[{
                RowBox[{"pos2", "[", 
                 RowBox[{"[", "k1", "]"}], "]"}], "[", 
                RowBox[{"[", "j1", "]"}], "]"}]}], "}"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"j1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"remlist1", "[", 
               RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
         
         RowBox[{"{", 
          RowBox[{"k1", ",", 
           RowBox[{"Length", "[", "remlist1", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
         RowBox[{
         "Generate", " ", "the", " ", "disconected", " ", "terms", " ", 
          "related", " ", "to", " ", "contraction"}], " ", "<", "BRA"}], "|", 
        
        RowBox[{
         RowBox[{"-", 
          RowBox[{"T", "'"}]}], "s"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"etet1", "=", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"ete", "[", 
                 RowBox[{"[", "3", "]"}], "]"}], "[", 
                RowBox[{"[", "j1", "]"}], "]"}], "[", 
               RowBox[{"[", "k1", "]"}], "]"}], "[", 
              RowBox[{"[", "0", "]"}], "]"}], "===", "SuperDagger"}], ",", 
            "Null", ",", 
            RowBox[{
             RowBox[{
              RowBox[{"ete", "[", 
               RowBox[{"[", "3", "]"}], "]"}], "[", 
              RowBox[{"[", "j1", "]"}], "]"}], "[", 
             RowBox[{"[", "k1", "]"}], "]"}]}], "]"}], "\[IndentingNewLine]", 
          ",", 
          RowBox[{"{", 
           RowBox[{"j1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{"ete", "[", 
              RowBox[{"[", "3", "]"}], "]"}], "]"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"k1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{
              RowBox[{"ete", "[", 
               RowBox[{"[", "3", "]"}], "]"}], "[", 
              RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], " ", "/.",
         " ", 
        RowBox[{"Null", " ", "->", " ", 
         RowBox[{"Sequence", "[", "]"}]}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"etet2", "=", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"ete", "[", 
                 RowBox[{"[", "3", "]"}], "]"}], "[", 
                RowBox[{"[", "j1", "]"}], "]"}], "[", 
               RowBox[{"[", "k1", "]"}], "]"}], "[", 
              RowBox[{"[", "0", "]"}], "]"}], "===", "SuperDagger"}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"ete", "[", 
                RowBox[{"[", "3", "]"}], "]"}], "[", 
               RowBox[{"[", "j1", "]"}], "]"}], "[", 
              RowBox[{"[", "k1", "]"}], "]"}], "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", "Null"}], "]"}], 
          "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"j1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{"ete", "[", 
              RowBox[{"[", "3", "]"}], "]"}], "]"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"k1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{
              RowBox[{"ete", "[", 
               RowBox[{"[", "3", "]"}], "]"}], "[", 
              RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], " ", "/.",
         " ", 
        RowBox[{"Null", " ", "->", " ", 
         RowBox[{"Sequence", "[", "]"}]}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"tupdisc1", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Tuples", "[", 
          RowBox[{"{", 
           RowBox[{"ld1", ",", 
            RowBox[{"etet1", "[", 
             RowBox[{"[", "i1", "]"}], "]"}]}], "}"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i1", ",", 
           RowBox[{"Length", "[", "etet1", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"tupdisc2", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Tuples", "[", 
          RowBox[{"{", 
           RowBox[{"ld2", ",", 
            RowBox[{"etet2", "[", 
             RowBox[{"[", "i1", "]"}], "]"}]}], "}"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i1", ",", 
           RowBox[{"Length", "[", "etet2", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"nonunicdisc", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Subsets", "[", 
          RowBox[{
           RowBox[{"Union", "[", 
            RowBox[{
             RowBox[{"tupdisc1", "[", 
              RowBox[{"[", "i1", "]"}], "]"}], ",", 
             RowBox[{"tupdisc2", "[", 
              RowBox[{"[", "i1", "]"}], "]"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"Length", "[", 
             RowBox[{
              RowBox[{"ete", "[", 
               RowBox[{"[", "3", "]"}], "]"}], "[", 
              RowBox[{"[", "i1", "]"}], "]"}], "]"}], "}"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i1", ",", 
           RowBox[{"Length", "[", 
            RowBox[{"ete", "[", 
             RowBox[{"[", "3", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"disconected", "=", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"Table", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"selectcorrectcontract", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"nonunicdisc", "[", 
                RowBox[{"[", "j1", "]"}], "]"}], "[", 
               RowBox[{"[", "i1", "]"}], "]"}], ",", 
              RowBox[{
               RowBox[{"ete", "[", 
                RowBox[{"[", "3", "]"}], "]"}], "[", 
               RowBox[{"[", "j1", "]"}], "]"}]}], "]"}], 
            "\[IndentingNewLine]", ",", 
            RowBox[{"{", 
             RowBox[{"i1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{"nonunicdisc", "[", 
                RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], " ",
           "/.", " ", 
          RowBox[{"Null", " ", "->", " ", 
           RowBox[{"Sequence", "[", "]"}]}]}], " ", "\[IndentingNewLine]", 
         ",", 
         RowBox[{"{", 
          RowBox[{"j1", ",", 
           RowBox[{"Length", "[", "nonunicdisc", "]"}]}], "}"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"tabdiscon", "=", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Table", "[", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"Table", "[", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"Position", "[", 
                  RowBox[{
                   RowBox[{"Table", "[", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"Intersection", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"remlist02", "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{"disconected", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}]}], "]"}], "]"}], "==", 
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{"ete", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], 
                    "\[IndentingNewLine]", ",", 
                    RowBox[{"{", 
                    RowBox[{"i1", ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{"remlist02", "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
                   ",", "True"}], "]"}], "\[IndentingNewLine]", ",", 
                 RowBox[{"{", 
                  RowBox[{"j1", ",", 
                   RowBox[{"Length", "[", 
                    RowBox[{"disconected", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
               "\[IndentingNewLine]", ",", 
               RowBox[{"{", 
                RowBox[{"k1", ",", 
                 RowBox[{"Length", "[", "disconected", "]"}]}], "}"}]}], 
              "]"}], " ", "//", " ", "Flatten"}], " ", "//", " ", "Sort"}], 
           "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"l1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"remlist02", "[", 
               RowBox[{"[", "m1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"m1", ",", 
           RowBox[{"Length", "[", "remlist02", "]"}]}], "}"}]}], "]"}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"remlist", "=", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Delete", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"remlist01", "[", 
               RowBox[{"[", "j1", "]"}], "]"}], "[", 
              RowBox[{"[", "i1", "]"}], "]"}], ",", 
             RowBox[{"Partition", "[", " ", 
              RowBox[{
               RowBox[{
                RowBox[{"tabdiscon", "[", 
                 RowBox[{"[", "j1", "]"}], "]"}], "[", 
                RowBox[{"[", "i1", "]"}], "]"}], ",", "1"}], "]"}]}], "]"}], 
           "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"i1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"tabdiscon", "[", 
               RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"j1", ",", 
           RowBox[{"Length", "[", "tabdiscon", "]"}]}], "}"}]}], "]"}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"remlist2", "=", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Delete", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"remlist02", "[", 
               RowBox[{"[", "j1", "]"}], "]"}], "[", 
              RowBox[{"[", "i1", "]"}], "]"}], ",", 
             RowBox[{"Partition", "[", " ", 
              RowBox[{
               RowBox[{
                RowBox[{"tabdiscon", "[", 
                 RowBox[{"[", "j1", "]"}], "]"}], "[", 
                RowBox[{"[", "i1", "]"}], "]"}], ",", "1"}], "]"}]}], "]"}], 
           "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"i1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"tabdiscon", "[", 
               RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"j1", ",", 
           RowBox[{"Length", "[", "tabdiscon", "]"}]}], "}"}]}], "]"}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"sub", "=", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"Subsets", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"remlist", "[", 
                  RowBox[{"[", "k1", "]"}], "]"}], "[", 
                 RowBox[{"[", "j1", "]"}], "]"}], "[", 
                RowBox[{"[", "i1", "]"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"Length", "[", 
                 RowBox[{"Intersection", "[", 
                  RowBox[{
                   RowBox[{"DeleteDuplicates", "[", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"remlist", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "]"}], "]"}], ",", 
                   RowBox[{"Union", "[", 
                    RowBox[{"ld3", ",", "ld4"}], "]"}]}], "]"}], "]"}], 
                "}"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i1", ",", 
               RowBox[{"Length", "[", 
                RowBox[{
                 RowBox[{"remlist", "[", 
                  RowBox[{"[", "k1", "]"}], "]"}], "[", 
                 RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
           "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"j1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"remlist", "[", 
               RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"k1", ",", 
           RowBox[{"Length", "[", "remlist", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"list", "=", "\[IndentingNewLine]", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Length", "[", 
                    RowBox[{"DeleteDuplicates", "[", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"sub", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "]"}], "]"}], "]"}], "==", 
                   RowBox[{"2", "*", 
                    RowBox[{"(", 
                    RowBox[{"parnum", "-", 
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{"delkron", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "-", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"delkron1", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "/", "2"}], 
                    ")"}]}], ")"}]}]}], ",", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"sub", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                   RowBox[{"[", "i1", "]"}], "]"}]}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"i1", ",", 
                  RowBox[{"Length", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"sub", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
              "  ", "/.", " ", 
              RowBox[{"Null", " ", "->", " ", 
               RowBox[{"Sequence", "[", "]"}]}]}], "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"j1", ",", 
               RowBox[{"Length", "[", 
                RowBox[{
                 RowBox[{"sub", "[", 
                  RowBox[{"[", "l1", "]"}], "]"}], "[", 
                 RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"k1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"sub", "[", 
               RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"l1", ",", 
           RowBox[{"Length", "[", "sub", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"The", " ", "complete", " ", "contractions"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"list2", "=", "\[IndentingNewLine]", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"Partition", "[", 
                RowBox[{
                 RowBox[{"Flatten", "[", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"delkron", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"list", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"remlist2", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}]}], "}"}], "]"}], ",", 
                 "2"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"i1", ",", 
                 RowBox[{"Length", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"list", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                   RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
             "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"j1", ",", 
               RowBox[{"Length", "[", 
                RowBox[{
                 RowBox[{"remlist2", "[", 
                  RowBox[{"[", "l1", "]"}], "]"}], "[", 
                 RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
           "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"k1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"delkron", "[", 
               RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"l1", ",", 
           RowBox[{"Length", "[", "list", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{"partilal", " ", "contractions"}], " ", ",", " ", 
        RowBox[{
        "avoiding", " ", "the", " ", "external", " ", "contractrions"}]}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"list3", "=", "\[IndentingNewLine]", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"Partition", "[", 
                RowBox[{
                 RowBox[{"Flatten", "[", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"list", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"remlist2", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}]}], "}"}], "]"}], ",", 
                 "2"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"i1", ",", 
                 RowBox[{"Length", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"list", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                   RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
             "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"j1", ",", 
               RowBox[{"Length", "[", 
                RowBox[{
                 RowBox[{"remlist2", "[", 
                  RowBox[{"[", "l1", "]"}], "]"}], "[", 
                 RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
           "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"k1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"delkron", "[", 
               RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"l1", ",", 
           RowBox[{"Length", "[", "list", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{"{", 
        RowBox[{"list2", ",", "list3", ",", "delkron"}], "}"}], "]"}], 
      ";"}]}], "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8740462136613283`*^9, 3.8740462696730337`*^9}, 
   3.8740463027244864`*^9, {3.874050620628778*^9, 3.874050692370591*^9}, {
   3.874050799265333*^9, 3.87405105118128*^9}, {3.874051165013463*^9, 
   3.874051177491848*^9}, 3.874051323782207*^9, {3.874051713579225*^9, 
   3.874051728954122*^9}, {3.8740519158199663`*^9, 3.874051948489339*^9}, 
   3.874055393871625*^9, {3.874056302495263*^9, 3.874056411256979*^9}, {
   3.874056495391468*^9, 3.874056524937037*^9}, {3.874060067142519*^9, 
   3.874060084727127*^9}, {3.876386213053688*^9, 3.876386225463839*^9}, {
   3.876566074564039*^9, 3.876566075782391*^9}, {3.8765661184378853`*^9, 
   3.8765661226377172`*^9}, {3.876823006921568*^9, 3.876823031048077*^9}, {
   3.876828075016243*^9, 3.876828075359166*^9}, {3.876828156078476*^9, 
   3.8768281562513027`*^9}, {3.876828424874578*^9, 3.876828438074842*^9}, {
   3.877519922125456*^9, 3.8775199299688263`*^9}, 3.8776876896047773`*^9, {
   3.877687723339065*^9, 3.877687873817952*^9}, {3.877694997211802*^9, 
   3.877694998314351*^9}, {3.87769542551853*^9, 3.8776954259697*^9}, {
   3.877757848867889*^9, 3.8777578734204063`*^9}, 3.885383274052952*^9, {
   3.88538424709728*^9, 3.885384280262682*^9}, {3.885454467319872*^9, 
   3.8854545004704227`*^9}, 3.885454993767891*^9, {3.88545704775596*^9, 
   3.885457048094132*^9}, {3.885458438282889*^9, 3.885458444462482*^9}, {
   3.885458565210349*^9, 3.88545857160496*^9}, {3.885458606779695*^9, 
   3.88545862686097*^9}, {3.885550469603838*^9, 3.885550471585639*^9}, {
   3.885550519968245*^9, 3.8855505223858128`*^9}, {3.885550569494059*^9, 
   3.8855505818537407`*^9}, 3.886059712241634*^9, 3.8865054327263107`*^9, 
   3.886576122009179*^9, {3.886577877091332*^9, 3.886577879773456*^9}, {
   3.886582132037608*^9, 3.886582139816516*^9}, {3.887433160357417*^9, 
   3.887433161589773*^9}, {3.887433199208783*^9, 3.8874332031608973`*^9}, {
   3.887433276407501*^9, 3.887433318705804*^9}, {3.887433528716878*^9, 
   3.887433529303619*^9}, {3.887453266588869*^9, 3.887453271805749*^9}, {
   3.887454533246707*^9, 3.887454535821306*^9}, {3.891057721632883*^9, 
   3.8910577217866077`*^9}, {3.891066173137312*^9, 3.891066350817617*^9}, {
   3.891332638715384*^9, 3.8913326471041193`*^9}, {3.891581717547339*^9, 
   3.891581718188017*^9}, {3.8920155605830097`*^9, 3.8920155922337303`*^9}, {
   3.8920156844049053`*^9, 3.892015686082747*^9}, {3.892015738984352*^9, 
   3.892015759568145*^9}, 3.892015868849118*^9, {3.892015916078726*^9, 
   3.8920159523868237`*^9}, {3.892016031814167*^9, 3.892016045200835*^9}, {
   3.892016235900589*^9, 3.892016247081257*^9}, {3.892016381127943*^9, 
   3.8920163876354856`*^9}},
 CellLabel->"In[12]:=",ExpressionUUID->"6b94466e-ee05-47fe-8420-3fe5ab532013"]
}, Closed]],

Cell[CellGroupData[{

Cell[TextData[{
 "Permutation symmetry ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["t", "1"], ",", 
    SubscriptBox["t", "2"], ",", 
    SubscriptBox["t", "3"], ",", "..."}], TraditionalForm]],ExpressionUUID->
  "4c034e2b-8196-47d9-9012-1cb6f1217d02"],
 " "
}], "Section",
 CellChangeTimes->{{3.8502124694131107`*^9, 3.850212483911498*^9}, {
   3.8508075976382303`*^9, 3.850807637386962*^9}, {3.85157491870508*^9, 
   3.8515749220559587`*^9}, {3.851575053203541*^9, 3.851575059139056*^9}, 
   3.851575661024029*^9, {3.85157970682765*^9, 3.851579715418345*^9}, {
   3.853485369144342*^9, 3.853485401318177*^9}, {3.8538499840059443`*^9, 
   3.853849987654407*^9}, {3.858858281395907*^9, 3.858858293975215*^9}, {
   3.85935042931706*^9, 3.85935043074402*^9}, 3.859354082555974*^9, {
   3.8605585516079884`*^9, 3.860558649112575*^9}, {3.886071266429615*^9, 
   3.886071271370454*^9}, {3.886071575630444*^9, 
   3.8860715807422743`*^9}},ExpressionUUID->"50eb3c8a-6bf8-4e01-962a-\
e0b58ba5593e"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"AntSymPermut", "[", 
    RowBox[{
    "DeltaKronecker_", ",", "ManyBodyTerms_", ",", "Amplitudes_", ",", 
     "Prefactors_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "strsgnbool", ",", "intermediatesv", ",", "coefficients", ",", 
       "amplitudes", ",", "intermediates0", ",", "positionstring", ",", 
       "strsgnboolmin", ",", "sqoperators", ",", "amplitudess", ",", "sign0", 
       ",", "strings0", ",", "int0", ",", "kronampl", ",", "prefact1", ",", 
       "amplitudesakron", ",", "creanh", ",", "dummycreanh", ",", 
       "dummycreanh2", ",", "intamplitudesdumy", ",", "ampdumy", ",", 
       "positiondumy", ",", "prefact2", ",", "sing1", ",", "repeatedterms", 
       ",", "sing2", ",", "finalprefact", ",", "eomccindx", ",", "amplipos", 
       ",", "amplipos0", ",", "positint", ",", "inter", ",", "inter2", ",", 
       "inter3", ",", "inter4", ",", "posmay6", ",", "intermediatesfinal", 
       ",", "eomccindx1", ",", "JusClusInd", ",", "LengClust", ",", 
       "SepClusIndN", ",", "SepClusInd", ",", "PosRepClos", ",", 
       "eomccindx2"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Table", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"coefficients", "=", "Prefactors"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"amplitudes", "=", "Amplitudes"}], ";", "\[IndentingNewLine]", 
        RowBox[{"strsgnbool", "=", 
         RowBox[{"DeltaKronecker", "[", 
          RowBox[{"[", "NN", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"intermediatesv", "=", 
         RowBox[{"ManyBodyTerms", "[", 
          RowBox[{"[", "NN", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"intermediates0", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", "4", "]"}], "]"}]}], "}"}], "&"}], "/@", 
          RowBox[{
           RowBox[{"ManyBodyTerms", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "1"}], "]"}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Localize", " ", "and", " ", "time", " ", "make", " ", "zero", " ", 
          "the", " ", "terms", " ", 
          RowBox[{"HT", "'"}], "s", " ", "inside", " ", "each", " ", 
          "intermediate", " ", "and", " ", "obtain", " ", "the", " ", 
          "positions", " ", "of", " ", "non", " ", "Zero"}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"positionstring", "=", 
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"Position", "[", 
             RowBox[{
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"strsgnbool", "[", 
                   RowBox[{"[", "j1", "]"}], "]"}], "[", 
                  RowBox[{"[", "i1", "]"}], "]"}], "[", 
                 RowBox[{"[", "2", "]"}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"i1", ",", 
                  RowBox[{"Length", "[", 
                   RowBox[{"intermediatesv", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
              ",", "True"}], "]"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"j1", ",", 
             RowBox[{"Length", "[", "strsgnbool", "]"}]}], "}"}]}], "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Use", " ", "the", " ", "positions", " ", "from", " ", 
          "positionstring", " ", "and", " ", "aply", " ", "it", " ", "to", 
          " ", "strsgnbool"}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"strsgnboolmin", "=", 
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Delete", "[", 
              RowBox[{"strsgnbool", ",", 
               RowBox[{"Position", "[", 
                RowBox[{"positionstring", ",", 
                 RowBox[{"{", "}"}]}], "]"}]}], "]"}], "[", 
             RowBox[{"[", "i1", "]"}], "]"}], "[", 
            RowBox[{"[", 
             RowBox[{
              RowBox[{"DeleteCases", "[", 
               RowBox[{"positionstring", ",", 
                RowBox[{"{", "}"}]}], "]"}], "[", 
              RowBox[{"[", "i1", "]"}], "]"}], "]"}], "]"}], 
           "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"i1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"DeleteCases", "[", 
               RowBox[{"positionstring", ",", 
                RowBox[{"{", "}"}]}], "]"}], "]"}]}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Use", " ", "the", " ", "positions", " ", "from", " ", 
          "positionstring", " ", "and", " ", "aply", " ", "it", " ", "to", 
          " ", "the", " ", "second", " ", "quantization", " ", "operators"}], 
         " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"sqoperators", "=", 
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Delete", "[", 
              RowBox[{"intermediatesv", ",", 
               RowBox[{"Position", "[", 
                RowBox[{"positionstring", ",", 
                 RowBox[{"{", "}"}]}], "]"}]}], "]"}], "[", 
             RowBox[{"[", "i1", "]"}], "]"}], "[", 
            RowBox[{"[", 
             RowBox[{
              RowBox[{"DeleteCases", "[", 
               RowBox[{"positionstring", ",", 
                RowBox[{"{", "}"}]}], "]"}], "[", 
              RowBox[{"[", "i1", "]"}], "]"}], "]"}], "]"}], 
           "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"i1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"DeleteCases", "[", 
               RowBox[{"positionstring", ",", 
                RowBox[{"{", "}"}]}], "]"}], "]"}]}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Use", " ", "the", " ", "positions", " ", "from", " ", 
          "positionstring", " ", "and", " ", "aply", " ", "it", " ", "to", 
          " ", "the", " ", "amplitudes"}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"amplitudess", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"amplitudes", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "[", 
            RowBox[{"[", 
             RowBox[{
              RowBox[{"DeleteCases", "[", 
               RowBox[{"positionstring", ",", 
                RowBox[{"{", "}"}]}], "]"}], "[", 
              RowBox[{"[", "i1", "]"}], "]"}], "]"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"DeleteCases", "[", 
               RowBox[{"positionstring", ",", 
                RowBox[{"{", "}"}]}], "]"}], "]"}]}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Use", " ", "the", " ", "positions", " ", "from", " ", 
          "positionstring", " ", "to", " ", "the", " ", "sign"}], " ", "*)"}],
         "\[IndentingNewLine]", 
        RowBox[{"sign0", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Flatten", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"strsgnboolmin", "[", 
                 RowBox[{"[", "j1", "]"}], "]"}], "[", 
                RowBox[{"[", "i1", "]"}], "]"}], "[", 
               RowBox[{"[", "3", "]"}], "]"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i1", ",", 
               RowBox[{"Length", "[", 
                RowBox[{"strsgnboolmin", "[", 
                 RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
           "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"j1", ",", 
             RowBox[{"Length", "[", "strsgnboolmin", "]"}]}], "}"}]}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Use", " ", "the", " ", "positions", " ", "from", " ", 
          "positionstring", " ", "to", " ", "the", " ", "delta", " ", 
          "kronekers"}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"strings0", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Partition", "[", 
              RowBox[{
               RowBox[{"Partition", "[", 
                RowBox[{
                 RowBox[{"Flatten", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"strsgnboolmin", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", "2"}], "]"}], 
               ",", 
               RowBox[{"Length", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"strsgnboolmin", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "]"}], 
             "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"i1", ",", 
               RowBox[{"Length", "[", 
                RowBox[{"strsgnboolmin", "[", 
                 RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"j1", ",", 
             RowBox[{"Length", "[", "strsgnboolmin", "]"}]}], "}"}]}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Obtain", " ", "the", " ", "positions", " ", "of", " ", "the", " ", 
          "amplitudes", " ", "that", " ", "are", " ", "repeated"}], " ", 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{"amplipos0", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Flatten", "[", "#", "]"}], "&"}], "@", 
                RowBox[{"krontonint", "[", 
                 RowBox[{
                  RowBox[{"{", "#", "}"}], " ", ",", 
                  RowBox[{
                   RowBox[{"sqoperators", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                   RowBox[{"[", "i1", "]"}], "]"}], ",", "2"}], "]"}]}], 
               "&"}], "/@", " ", 
              RowBox[{
               RowBox[{"strings0", "[", 
                RowBox[{"[", "j1", "]"}], "]"}], "[", 
               RowBox[{"[", "i1", "]"}], "]"}]}], " ", "\[IndentingNewLine]", 
             ",", 
             RowBox[{"{", 
              RowBox[{"i1", ",", 
               RowBox[{"Length", "[", 
                RowBox[{"sqoperators", "[", 
                 RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"j1", ",", 
             RowBox[{"Length", "[", "sqoperators", "]"}]}], "}"}]}], "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"amplipos", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"Flatten", "[", "#", "]"}], "&"}], "@", 
                  RowBox[{"Position", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"amplipos0", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], " ", ",", "#"}], "]"}]}],
                  "&"}], "/@", 
                RowBox[{"DeleteDuplicates", "[", " ", 
                 RowBox[{
                  RowBox[{"amplipos0", "[", 
                   RowBox[{"[", "j1", "]"}], "]"}], "[", 
                  RowBox[{"[", "i1", "]"}], "]"}], " ", "]"}]}], ")"}], "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "1"}], "]"}], "]"}], "\[IndentingNewLine]",
              ",", 
             RowBox[{"{", 
              RowBox[{"i1", ",", 
               RowBox[{"Length", "[", 
                RowBox[{"sqoperators", "[", 
                 RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"j1", ",", 
             RowBox[{"Length", "[", "sqoperators", "]"}]}], "}"}]}], "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Use", " ", "the", " ", "positions", " ", "obtained", " ", "by", " ",
           "amplipos", " ", "and", " ", "apply", " ", "them", " ", "to", " ", 
          "the", " ", "integrals"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"int0", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"Flatten", "[", "#", "]"}], "&"}], "/@", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"krontonint", "[", 
                   RowBox[{
                    RowBox[{"{", "#", "}"}], " ", ",", 
                    RowBox[{
                    RowBox[{"sqoperators", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], ",", "1"}], "]"}], "&"}],
                  "/@", " ", 
                 RowBox[{
                  RowBox[{"strings0", "[", 
                   RowBox[{"[", "j1", "]"}], "]"}], "[", 
                  RowBox[{"[", "i1", "]"}], "]"}]}], ")"}], " ", "[", 
               RowBox[{"[", 
                RowBox[{
                 RowBox[{"amplipos", "[", 
                  RowBox[{"[", "j1", "]"}], "]"}], "[", 
                 RowBox[{"[", "i1", "]"}], "]"}], "]"}], "]"}]}], 
             "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"i1", ",", 
               RowBox[{"Length", "[", 
                RowBox[{"sqoperators", "[", 
                 RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"j1", ",", 
             RowBox[{"Length", "[", "sqoperators", "]"}]}], "}"}]}], "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Use", " ", "the", " ", "positions", " ", "obtained", " ", "by", " ",
           "amplitudess", " ", "and", " ", "apli", " ", "them", " ", "to", 
          " ", "the", " ", "remaining", " ", "kroneker", " ", "deltas"}], " ",
          "*)"}], "\[IndentingNewLine]", 
        RowBox[{"kronampl", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"krontonint", "[", 
                  RowBox[{
                   RowBox[{"{", "#", "}"}], " ", ",", 
                   RowBox[{
                    RowBox[{"sqoperators", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], ",", "2"}], "]"}], "&"}],
                 "/@", 
                RowBox[{
                 RowBox[{"strings0", "[", 
                  RowBox[{"[", "j1", "]"}], "]"}], "[", 
                 RowBox[{"[", "i1", "]"}], "]"}]}], ")"}], " ", "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"amplipos", "[", 
                 RowBox[{"[", "j1", "]"}], "]"}], "[", 
                RowBox[{"[", "i1", "]"}], "]"}], "]"}], "]"}], 
             "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"i1", ",", 
               RowBox[{"Length", "[", 
                RowBox[{"sqoperators", "[", 
                 RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"j1", ",", 
             RowBox[{"Length", "[", "sqoperators", "]"}]}], "}"}]}], "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Use", " ", "the", " ", "positions", " ", "obtained", " ", "by", " ",
           "amplitudess", " ", "and", " ", "apli", " ", "them", " ", "to", 
          " ", "the", " ", "sign"}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"sing1", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"sign0", "[", 
                RowBox[{"[", "j1", "]"}], "]"}], "[", 
               RowBox[{"[", "i1", "]"}], "]"}], "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"amplipos", "[", 
                 RowBox[{"[", "j1", "]"}], "]"}], "[", 
                RowBox[{"[", "i1", "]"}], "]"}], "]"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i1", ",", 
               RowBox[{"Length", "[", 
                RowBox[{"sqoperators", "[", 
                 RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"j1", ",", 
             RowBox[{"Length", "[", "sqoperators", "]"}]}], "}"}]}], "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
          "Use", " ", "the", " ", "delta", " ", "kronekers", " ", "form", " ",
            "kronampl", " ", "and", " ", "aply", " ", "it", " ", "to", " ", 
           "the", " ", "amplitudes", " ", 
           RowBox[{"t1", "[", 
            RowBox[{"i", ",", "a"}], "]"}]}], ",", 
          RowBox[{"t2", "[", 
           RowBox[{"i", ",", "j", ",", "a", ",", "b"}], "]"}]}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"amplitudesakron", "=", "\[IndentingNewLine]", 
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Table", "[", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"amplitudess", "[", 
                  RowBox[{"[", "l1", "]"}], "]"}], "[", 
                 RowBox[{"[", "k1", "]"}], "]"}], "/.", 
                RowBox[{"Table", "[", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Partition", "[", 
                    RowBox[{
                    RowBox[{"Flatten", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"kronampl", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "]"}], ",", "2"}], "]"}],
                     "===", 
                    RowBox[{"{", "}"}]}], ",", 
                    RowBox[{"{", "}"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Reverse", "[", "#", "]"}], "&"}], "/@", 
                    RowBox[{"Partition", "[", 
                    RowBox[{
                    RowBox[{"Flatten", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"kronampl", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "]"}], ",", "2"}], 
                    "]"}]}], ")"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "->", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Reverse", "[", "#", "]"}], "&"}], "/@", 
                    RowBox[{"Partition", "[", 
                    RowBox[{
                    RowBox[{"Flatten", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"kronampl", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "]"}], ",", "2"}], 
                    "]"}]}], ")"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}]}], "]"}], 
                  "\[IndentingNewLine]", ",", 
                  RowBox[{"{", 
                   RowBox[{"i1", ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{"Partition", "[", 
                    RowBox[{
                    RowBox[{"Flatten", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"kronampl", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "]"}], ",", "2"}], "]"}],
                     "]"}]}], "}"}]}], "]"}]}], "\[IndentingNewLine]", ",", 
               RowBox[{"{", 
                RowBox[{"j1", ",", 
                 RowBox[{"Length", "[", 
                  RowBox[{
                   RowBox[{"kronampl", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                   RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
             "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"k1", ",", 
               RowBox[{"Length", "[", 
                RowBox[{"kronampl", "[", 
                 RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
           "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"l1", ",", 
             RowBox[{"Length", "[", "kronampl", "]"}]}], "}"}]}], "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
          "Extract", " ", "the", " ", "second", " ", "quantization", " ", 
           "indexes", " ", "from", " ", "the", " ", "amplitudes", " ", "in", 
           " ", "order", " ", "o1"}], ",", "o2", ",", "o3", ",", "o4", ",", "...",
           ",", "v1", ",", "v2", ",", "v3", ",", "v4"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"creanh", "=", 
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"Flatten", " ", "[", "#", "]"}], "&"}], "/@", 
               RowBox[{"Transpose", "[", 
                RowBox[{"Table", "[", 
                 RowBox[{
                  RowBox[{"Partition", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"amplitudess", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"amplitudess", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "/", "2"}]}], 
                   "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"i1", ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{"amplitudess", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
                "]"}]}], ")"}], "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"k1", ",", 
               RowBox[{"Length", "[", 
                RowBox[{"kronampl", "[", 
                 RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
           "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"l1", ",", 
             RowBox[{"Length", "[", "kronampl", "]"}]}], "}"}]}], "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "All", " ", "the", " ", "indexes", " ", "of", " ", "the", " ", 
          "amplitudes", " ", "that", " ", "are", " ", "dummy"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"dummycreanh", "=", 
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Table", "[", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"amplitudesakron", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                   RowBox[{"[", "k1", "]"}], "]"}], "===", 
                  RowBox[{"{", "}"}]}], ",", 
                 RowBox[{"{", "}"}], ",", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Intersection", "[", 
                    RowBox[{
                    RowBox[{"Flatten", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"int0", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"amplitudesakron", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}]}], "}"}], "]"}], 
                    ",", "#"}], "]"}], "&"}], "/@", " ", 
                  RowBox[{
                   RowBox[{"creanh", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                   RowBox[{"[", "k1", "]"}], "]"}]}]}], "]"}], 
               "\[IndentingNewLine]", ",", 
               RowBox[{"{", 
                RowBox[{"i1", ",", 
                 RowBox[{"Length", "[", 
                  RowBox[{
                   RowBox[{"amplitudesakron", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                   RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
             "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"k1", ",", 
               RowBox[{"Length", "[", 
                RowBox[{"amplitudesakron", "[", 
                 RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
           "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"l1", ",", 
             RowBox[{"Length", "[", "amplitudesakron", "]"}]}], "}"}]}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"dummycreanh2", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"Table", "[", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"Table", "[", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"creanh", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                   RowBox[{"[", "i1", "]"}], "]"}], "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Range", "[", "#", "]"}], "&"}], "@", " ", 
                    RowBox[{"Length", "[", "#", "]"}]}], "&"}], "/@", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"dummycreanh", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}]}], ")"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "]"}], "]"}], 
                 "\[IndentingNewLine]", ",", 
                 RowBox[{"{", 
                  RowBox[{"i1", ",", 
                   RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{"creanh", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
               "\[IndentingNewLine]", ",", 
               RowBox[{"{", 
                RowBox[{"j1", ",", 
                 RowBox[{"Length", "[", 
                  RowBox[{
                   RowBox[{"dummycreanh", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                   RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
             ",", 
             RowBox[{"{", 
              RowBox[{"k1", ",", 
               RowBox[{"Length", "[", 
                RowBox[{"dummycreanh", "[", 
                 RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"l1", ",", 
             RowBox[{"Length", "[", "dummycreanh", "]"}]}], "}"}]}], "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"intamplitudesdumy", "=", 
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"int0", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                   RowBox[{"[", "i1", "]"}], "]"}], ",", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"amplitudesakron", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                   RowBox[{"[", "i1", "]"}], "]"}]}], "}"}], "/.", 
                RowBox[{"AssociationThread", "[", 
                 RowBox[{
                  RowBox[{"Flatten", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"dummycreanh", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "]"}], "->", 
                  RowBox[{"Flatten", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"dummycreanh2", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "]"}]}], "]"}]}], ",", 
               RowBox[{"{", 
                RowBox[{"i1", ",", 
                 RowBox[{"Length", "[", 
                  RowBox[{
                   RowBox[{"dummycreanh2", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                   RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
             "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"j1", ",", 
               RowBox[{"Length", "[", 
                RowBox[{"dummycreanh2", "[", 
                 RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
           "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"k1", ",", 
             RowBox[{"Length", "[", "dummycreanh2", "]"}]}], "}"}]}], "]"}]}],
         ";", "\[IndentingNewLine]", 
        RowBox[{"ampdumy", "=", 
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"Insert", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"amplitudesakron", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", 
                   RowBox[{"Unevaluated", "[", 
                    RowBox[{"Sequence", "@@", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"int0", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "}"}]}], "]"}], ",", 
                   "1"}], "]"}], "}"}], "/.", 
                RowBox[{"AssociationThread", "[", 
                 RowBox[{
                  RowBox[{"Flatten", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"dummycreanh", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "]"}], "->", 
                  RowBox[{"Flatten", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"dummycreanh2", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "]"}]}], "]"}]}], ",", 
               RowBox[{"{", 
                RowBox[{"i1", ",", 
                 RowBox[{"Length", "[", 
                  RowBox[{
                   RowBox[{"dummycreanh2", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                   RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
             "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"j1", ",", 
               RowBox[{"Length", "[", 
                RowBox[{"dummycreanh2", "[", 
                 RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
           "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"k1", ",", 
             RowBox[{"Length", "[", "dummycreanh2", "]"}]}], "}"}]}], "]"}]}],
         ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Find", " ", "the", " ", "possition", " ", "of", " ", "the", " ", 
          "dummy", " ", "integrals", " ", "and", " ", "amplitudes", " ", "to",
           " ", "remove", " ", "them"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"positiondumy", "=", 
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Flatten", "[", "#", "]"}], "&"}], "/@", 
                RowBox[{"Position", "[", 
                 RowBox[{
                  RowBox[{"Table", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Sort", "[", "#", "]"}], "&"}], "/@", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"ampdumy", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ",", 
                    RowBox[{"{", 
                    RowBox[{"i1", ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{"ampdumy", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
                  ",", "#"}], "]"}]}], "&"}], "/@", 
              RowBox[{"DeleteDuplicates", "[", 
               RowBox[{"Table", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"Sort", "[", "#", "]"}], "&"}], "/@", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"ampdumy", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                   RowBox[{"[", "1", "]"}], "]"}]}], ",", 
                 RowBox[{"{", 
                  RowBox[{"i1", ",", 
                   RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{"ampdumy", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
               "]"}]}], "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"j1", ",", 
               RowBox[{"Length", "[", 
                RowBox[{"ampdumy", "[", 
                 RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
           "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"k1", ",", 
             RowBox[{"Length", "[", "ampdumy", "]"}]}], "}"}]}], "]"}]}], ";",
         "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Find", " ", "the", " ", "possition", " ", "of", " ", "the", " ", 
          "dummy", " ", "integrals", " ", "and", " ", "amplitudes", " ", "to",
           " ", "remove", " ", "them"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"positiondumy", "=", 
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Flatten", "[", "#", "]"}], "&"}], "/@", 
                RowBox[{"Position", "[", 
                 RowBox[{
                  RowBox[{"Table", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Sort", "[", "#", "]"}], "&"}], "/@", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"ampdumy", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ",", 
                    RowBox[{"{", 
                    RowBox[{"i1", ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{"ampdumy", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
                  ",", "#"}], "]"}]}], "&"}], "/@", 
              RowBox[{"DeleteDuplicates", "[", 
               RowBox[{"Table", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"Sort", "[", "#", "]"}], "&"}], "/@", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"ampdumy", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                   RowBox[{"[", "1", "]"}], "]"}]}], ",", 
                 RowBox[{"{", 
                  RowBox[{"i1", ",", 
                   RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{"ampdumy", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
               "]"}]}], "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"j1", ",", 
               RowBox[{"Length", "[", 
                RowBox[{"ampdumy", "[", 
                 RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
           "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"k1", ",", 
             RowBox[{"Length", "[", "ampdumy", "]"}]}], "}"}]}], "]"}]}], ";",
         "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "The", " ", "terms", " ", "repeated", " ", "after", " ", 
          "anisymetricaly", " ", "permute", " ", "the", " ", "integrals", " ",
           "and", " ", "the", " ", "amplitudes"}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"repeatedterms", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"Length", "[", "#", "]"}], "&"}], "/@", 
              RowBox[{
               RowBox[{"positiondumy", "[", 
                RowBox[{"[", "k1", "]"}], "]"}], "[", 
               RowBox[{"[", "i1", "]"}], "]"}]}], "\[IndentingNewLine]", ",", 
             
             RowBox[{"{", 
              RowBox[{"i1", ",", 
               RowBox[{"Length", "[", 
                RowBox[{"intamplitudesdumy", "[", 
                 RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"k1", ",", 
             RowBox[{"Length", "[", "intamplitudesdumy", "]"}]}], "}"}]}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"Obtain", " ", "the", " ", "prefactor", "  ", "sing"}], " ", 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{"sing2", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"sing1", "[", 
                RowBox[{"[", "k1", "]"}], "]"}], "[", 
               RowBox[{"[", "i1", "]"}], "]"}], "[", 
              RowBox[{"[", 
               RowBox[{"Flatten", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"positiondumy", "[", 
                   RowBox[{"[", "k1", "]"}], "]"}], "[", 
                  RowBox[{"[", "i1", "]"}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "1"}], "]"}], "]"}], "]"}], "]"}], 
              "]"}], "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"i1", ",", 
               RowBox[{"Length", "[", 
                RowBox[{"intamplitudesdumy", "[", 
                 RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"k1", ",", 
             RowBox[{"Length", "[", "intamplitudesdumy", "]"}]}], "}"}]}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"finalprefact", "=", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"coefficients", "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{"DeleteCases", "[", 
                RowBox[{"positionstring", ",", 
                 RowBox[{"{", "}"}]}], "]"}], "[", 
               RowBox[{"[", "i1", "]"}], "]"}], "]"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{"DeleteCases", "[", 
                RowBox[{"positionstring", ",", 
                 RowBox[{"{", "}"}]}], "]"}], "]"}]}], "}"}]}], "]"}], " ", 
          "repeatedterms", " ", "sing2"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"eomccindx1", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"intamplitudesdumy", "[", 
                RowBox[{"[", "k1", "]"}], "]"}], "[", 
               RowBox[{"[", "i1", "]"}], "]"}], "[", 
              RowBox[{"[", 
               RowBox[{"Flatten", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"positiondumy", "[", 
                   RowBox[{"[", "k1", "]"}], "]"}], "[", 
                  RowBox[{"[", "i1", "]"}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "1"}], "]"}], "]"}], "]"}], "]"}], 
              "]"}], "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"i1", ",", 
               RowBox[{"Length", "[", 
                RowBox[{"intamplitudesdumy", "[", 
                 RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"k1", ",", 
             RowBox[{"Length", "[", "intamplitudesdumy", "]"}]}], "}"}]}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "JusClusInd", ",", "LengClust", ",", "SepClusIndN", ",", 
          "SepClusInd", ",", "PosRepClos", ",", "eomccindx2"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
          "This", " ", "variable", " ", "reduce", " ", "the", " ", "number", 
           " ", "of", " ", 
           RowBox[{"t", "'"}], "s"}], ",", " ", 
          RowBox[{
           RowBox[{"v", "'"}], "s"}], ",", " ", 
          RowBox[{"and", " ", 
           RowBox[{"f", "'"}], "s", " ", "by", " ", "permuting", " ", "the", 
           " ", "number"}]}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"eomccindx2", "=", 
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Signature", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Length", "[", "#", "]"}], "&"}], "/@", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}], "&"}], "@", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"eomccindx1", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ")"}]}], "]"}], "===", 
                "0"}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"JusClusInd", "=", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"#", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}], "&"}], "/@", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"eomccindx1", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}]}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"LengClust", "=", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Length", "[", "#", "]"}], "&"}], "/@", 
                   RowBox[{"JusClusInd", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ")"}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"SepClusIndN", "=", 
                 RowBox[{"GatherBy", "[", 
                  RowBox[{
                   RowBox[{"Range", "@", 
                    RowBox[{"Length", "[", "LengClust", "]"}]}], ",", 
                   RowBox[{
                    RowBox[{"LengClust", "[", 
                    RowBox[{"[", "#", "]"}], "]"}], "&"}]}], "]"}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"SepClusInd", "=", 
                 RowBox[{"Table", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"JusClusInd", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "#", "]"}], "]"}], "&"}], "/@", " ", 
                    "SepClusIndN"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"i1", ",", 
                    RowBox[{"Length", "[", "JusClusInd", "]"}]}], "}"}]}], 
                  "]"}]}], ";", "\[IndentingNewLine]", 
                RowBox[{"PosRepClos", "=", " ", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Position", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Sort", "[", "#", "]"}], "&"}], "/@", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Sort", "[", "#", "]"}], "&"}], "/@", 
                    RowBox[{"SepClusInd", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}]}], " ", "/.", " ", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Alternatives", "@@", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"creanh", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "->", "Vd"}], ",", 
                    RowBox[{
                    RowBox[{"Alternatives", "@@", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"creanh", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "->", "Od"}]}], "}"}]}],
                     ")"}]}], ",", "#"}], "]"}], " ", "&"}], "/@", " ", 
                  RowBox[{"DeleteDuplicates", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Sort", "[", "#", "]"}], "&"}], "/@", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Sort", "[", "#", "]"}], "&"}], "/@", 
                    RowBox[{"SepClusInd", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}]}], " ", "/.", " ", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Alternatives", "@@", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"creanh", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "->", "Vd"}], ",", 
                    RowBox[{
                    RowBox[{"Alternatives", "@@", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"creanh", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "->", "Od"}]}], "}"}]}],
                     ")"}]}], "]"}]}]}], " ", ";", "\[IndentingNewLine]", 
                RowBox[{"(*", " ", 
                 RowBox[{
                  RowBox[{"PosRepClos", "=", 
                   RowBox[{"Table", "[", " ", "\[IndentingNewLine]", " ", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Position", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Sort", "[", "#", "]"}], "&"}], "/@", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Sort", "[", "#", "]"}], "&"}], "/@", 
                    RowBox[{"SepClusInd", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "i1"}], "]"}], "]"}]}], " ", "/.", 
                    " ", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Alternatives", "@@", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"creanh", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "->", "Vd"}], ",", 
                    RowBox[{
                    RowBox[{"Alternatives", "@@", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"creanh", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "->", "Od"}]}], "}"}]}],
                     ")"}]}], ",", "#"}], "]"}], " ", "&"}], "/@", " ", 
                    RowBox[{"DeleteDuplicates", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Sort", "[", "#", "]"}], "&"}], "/@", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Sort", "[", "#", "]"}], "&"}], "/@", 
                    RowBox[{"SepClusInd", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "i1"}], "]"}], "]"}]}], " ", "/.", 
                    " ", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Alternatives", "@@", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"creanh", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "->", "Vd"}], ",", 
                    RowBox[{
                    RowBox[{"Alternatives", "@@", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"creanh", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "->", "Od"}]}], "}"}]}],
                     ")"}]}], "]"}]}], " ", "\[IndentingNewLine]", ",", 
                    RowBox[{"{", 
                    RowBox[{"i1", ",", 
                    RowBox[{"Length", "[", "SepClusIndN", "]"}]}], "}"}]}], 
                    "]"}]}], ";"}], "*)"}], "\[IndentingNewLine]", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", "#", "]"}], "&"}], "/@", 
                    "PosRepClos"}], " ", ")"}], 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"finalprefact", "[", 
                    RowBox[{"[", 
                    RowBox[{"k1", ",", "j1"}], "]"}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{"PosRepClos", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}], "]"}], "]"}], 
                    "]"}], ")"}]}], ")"}], ",", 
                  RowBox[{
                   RowBox[{"eomccindx1", "[", 
                    RowBox[{"[", 
                    RowBox[{"k1", ",", "j1"}], "]"}], "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{"PosRepClos", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}], "]"}], "]"}], 
                   "]"}]}], "}"}]}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"finalprefact", "[", 
                  RowBox[{"[", 
                   RowBox[{"k1", ",", "j1"}], "]"}], "]"}], ",", 
                 RowBox[{"eomccindx1", "[", 
                  RowBox[{"[", 
                   RowBox[{"k1", ",", "j1"}], "]"}], "]"}]}], "}"}]}], "]"}], 
             "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"j1", ",", 
               RowBox[{"Length", "[", 
                RowBox[{"eomccindx1", "[", 
                 RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
           "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"k1", ",", 
             RowBox[{"Length", "[", "eomccindx1", "]"}]}], "}"}]}], "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"finalprefact", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"eomccindx2", "[", 
                RowBox[{"[", "j1", "]"}], "]"}], "[", 
               RowBox[{"[", "i1", "]"}], "]"}], "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i1", ",", 
               RowBox[{"Length", "[", 
                RowBox[{"eomccindx2", "[", 
                 RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"j1", ",", 
             RowBox[{"Length", "[", "eomccindx2", "]"}]}], "}"}]}], "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"eomccindx1", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"eomccindx2", "[", 
                RowBox[{"[", "j1", "]"}], "]"}], "[", 
               RowBox[{"[", "i1", "]"}], "]"}], "[", 
              RowBox[{"[", "2", "]"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i1", ",", 
               RowBox[{"Length", "[", 
                RowBox[{"eomccindx2", "[", 
                 RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"j1", ",", 
             RowBox[{"Length", "[", "eomccindx2", "]"}]}], "}"}]}], "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"Here", " ", "is", " ", "an", " ", "error", " ", 
          RowBox[{"for", " ", "[", 
           RowBox[{"[", " ", "]"}], "]"}]}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"eomccindx", "=", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Total", "[", "#", "]"}], "&"}], "@", 
            RowBox[{"Flatten", "[", "#", "]"}]}], "&"}], "/@", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"(", "finalprefact", ")"}], 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"Table", "[", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"Times", "@@", 
                    RowBox[{"Flatten", "[", "#", "]"}]}], "&"}], "@", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"eomccindx1", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "==", "4"}], ",", 
                    "ERI", ",", "F"}], "]"}], "[", 
                    RowBox[{"Sequence", "@@", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ",", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ";;"}], "]"}], "]"}]}], "}"}]}], "&"}], "/@", 
                 RowBox[{
                  RowBox[{"eomccindx1", "[", 
                   RowBox[{"[", "j1", "]"}], "]"}], "[", 
                  RowBox[{"[", "i1", "]"}], "]"}]}], " ", 
                "\[IndentingNewLine]", ",", 
                RowBox[{"{", 
                 RowBox[{"i1", ",", 
                  RowBox[{"Length", "[", 
                   RowBox[{"eomccindx1", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
              " ", ",", 
              RowBox[{"{", 
               RowBox[{"j1", ",", 
                RowBox[{"Length", "[", "eomccindx1", "]"}]}], "}"}]}], 
             "]"}]}], ")"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"eomccindx", "=", 
         RowBox[{"ChangeSqParforDSq", "[", "eomccindx", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"AllTrue", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"MemberQ", "[", 
                   RowBox[{"#", ",", "4"}], "]"}], "&"}], "@", 
                 RowBox[{"Flatten", "[", "#", "]"}]}], "&"}], "@", 
               RowBox[{"Position", "[", 
                RowBox[{"#", ",", 
                 RowBox[{"{", "}"}]}], "]"}]}], "&"}], "/@", 
             "intermediatesv"}], ",", 
            RowBox[{
             RowBox[{"#", "===", "True"}], "&"}]}], "]"}], ",", 
          RowBox[{"Return", "[", "eomccindx", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"eomccindx1", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "[", 
                RowBox[{"[", "1", "]"}], "]"}], "]"}], "==", "4"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"inter", "=", 
               RowBox[{"Table", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"eomccindx1", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "[", 
                  RowBox[{"[", "1", "]"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"i1", ",", 
                   RowBox[{"Length", "[", "eomccindx1", "]"}]}], "}"}]}], 
                "]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"inter2", "=", 
               RowBox[{"Table", "[", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"DeleteCases", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{"Alternatives", "@@", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    "o1", ",", "o2", ",", "o3", ",", "o4", ",", "o5", ",", 
                    "o6", ",", "o7", ",", "o8", ",", "o9", ",", "o10"}], 
                    "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    "v1", ",", "v2", ",", "v3", ",", "v4", ",", "v5", ",", 
                    "v6", ",", "v7", ",", "v8", ",", "v9", ",", "v10"}], 
                    "}"}]}], "}"}], "]"}]}]}], "]"}], "&"}], "/@", " ", 
                  "\[IndentingNewLine]", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Flatten", "[", "#", "]"}], "&"}], "/@", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"inter", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"inter", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "==", 
                    RowBox[{"{", "}"}]}], ",", 
                    RowBox[{"{", "}"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"inter", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}]}], "]"}]}], 
                    "}"}]}], ")"}]}], "\[IndentingNewLine]", ",", 
                 RowBox[{"{", 
                  RowBox[{"i1", ",", 
                   RowBox[{"Length", "[", "inter", "]"}]}], "}"}]}], "]"}]}], 
              ";", "\[IndentingNewLine]", 
              RowBox[{"posmay6", "=", 
               RowBox[{"Position", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", "#", "]"}], "&"}], "@", 
                    RowBox[{"Flatten", "[", "#", "]"}]}], "&"}], "/@", 
                  "inter2"}], ",", 
                 RowBox[{"(", 
                  RowBox[{"n_", "/;", 
                   RowBox[{"n", ">=", "6"}]}], ")"}]}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"inter3", "=", 
               RowBox[{"Table", "[", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Table", "[", 
                   RowBox[{
                    RowBox[{"Table", "[", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"inter2", "[", 
                    RowBox[{"[", 
                    RowBox[{"Flatten", "[", "posmay6", "]"}], "]"}], "]"}], 
                    "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{"Position", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"StringTake", "[", " ", 
                    RowBox[{
                    RowBox[{"ToString", "[", "#", "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "1"}], "}"}]}], "]"}], "===", 
                    "\"\<h\>\""}], "&"}], "/@", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"inter2", "[", 
                    RowBox[{"[", 
                    RowBox[{"Flatten", "[", "posmay6", "]"}], "]"}], "]"}], 
                    "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}]}], ",", "j1"}], "]"}], 
                    "]"}], "]"}], "]"}], "\[IndentingNewLine]", ",", 
                    RowBox[{"{", 
                    RowBox[{"i1", ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{"inter2", "[", 
                    RowBox[{"[", 
                    RowBox[{"Flatten", "[", "posmay6", "]"}], "]"}], "]"}], 
                    "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
                    ",", 
                    RowBox[{"{", 
                    RowBox[{"j1", ",", 
                    RowBox[{"{", 
                    RowBox[{"True", ",", "False"}], "}"}]}], "}"}]}], "]"}], 
                  " ", "//", " ", "Transpose"}], "\[IndentingNewLine]", ",", 
                 RowBox[{"{", 
                  RowBox[{"k1", ",", 
                   RowBox[{"Length", "[", 
                    RowBox[{"inter2", "[", 
                    RowBox[{"[", 
                    RowBox[{"Flatten", "[", "posmay6", "]"}], "]"}], "]"}], 
                    "]"}]}], "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"inter4", "=", 
               RowBox[{"Table", "[", " ", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"Flatten", "[", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"inter3", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"inter3", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"inter3", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"inter3", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "}"}], "]"}], 
                 "\[IndentingNewLine]", ",", 
                 RowBox[{"{", 
                  RowBox[{"i1", ",", 
                   RowBox[{"Length", "[", "inter3", "]"}]}], "}"}]}], "]"}]}],
               ";", "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{"Here", " ", "is", " ", "an", " ", "error", " ", 
                RowBox[{"for", " ", "[", 
                 RowBox[{"[", " ", "]"}], "]"}]}], " ", "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{"intermediatesfinal", "=", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"\[Chi]", "[", 
                    RowBox[{"Sequence", "@@", "#"}], "]"}], "&"}], "@", 
                  RowBox[{"Flatten", "[", "#", "]"}]}], "&"}], "/@", 
                RowBox[{"(", 
                 RowBox[{"inter2", "/.", 
                  RowBox[{"AssociationThread", "[", 
                   RowBox[{
                    RowBox[{"inter2", "[", 
                    RowBox[{"[", 
                    RowBox[{"Flatten", "[", "posmay6", "]"}], "]"}], "]"}], "->",
                     "inter4"}], "]"}]}], ")"}]}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"intermediatesfinal", "=", 
               RowBox[{
               "ChangeSqParforDSq", "[", "intermediatesfinal", "]"}]}], ";"}],
              "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{"For", "[", 
               RowBox[{
                RowBox[{"i", "=", "0"}], ",", 
                RowBox[{"i", "<", 
                 RowBox[{"Length", "[", "intermediatesfinal", "]"}]}], ",", 
                RowBox[{"i", "++"}], ",", 
                RowBox[{"Print", "[", 
                 RowBox[{
                  RowBox[{"intermediatesfinal", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], "==", 
                  RowBox[{"eomcc", "[", 
                   RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], "]"}], "*)"}], 
             ",", 
             RowBox[{"Sequence", "[", "]"}]}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"positint", "=", 
            RowBox[{"Flatten", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Position", "[", 
                RowBox[{"intermediates0", ",", "#"}], "]"}], "&"}], "/@", 
              RowBox[{"Delete", "[", 
               RowBox[{"intermediates0", " ", ",", 
                RowBox[{"Position", "[", 
                 RowBox[{"positionstring", ",", 
                  RowBox[{"{", "}"}]}], "]"}]}], "]"}]}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"Return", "[", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Length", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"eomccindx1", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "]"}], "==", "4"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"{", 
               RowBox[{"intermediatesfinal", ",", 
                RowBox[{"ReplacePart", "[", 
                 RowBox[{
                  RowBox[{"Table", "[", "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"SubsetQ", "[", 
                    RowBox[{"positint", ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Range", "[", 
                    RowBox[{"Length", "[", "intermediates0", "]"}], "]"}], 
                    "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "}"}]}], "]"}], ",", 
                    RowBox[{
                    RowBox[{"Range", "[", 
                    RowBox[{"Length", "[", "intermediates0", "]"}], "]"}], 
                    "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], ",", "0"}], "]"}], 
                    "\[IndentingNewLine]", ",", 
                    RowBox[{"{", 
                    RowBox[{"i1", ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{"Range", "[", 
                    RowBox[{"Length", "[", "intermediates0", "]"}], "]"}], 
                    "]"}]}], "}"}]}], "]"}], ",", 
                  RowBox[{"Flatten", "[", 
                   RowBox[{"Table", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"positint", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "->", 
                    RowBox[{"eomccindx", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}]}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"i1", ",", 
                    RowBox[{"Length", "[", "positint", "]"}]}], "}"}]}], 
                    "]"}], " ", "]"}]}], "]"}]}], "}"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"ReplacePart", "[", 
               RowBox[{
                RowBox[{"Table", "[", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{"SubsetQ", "[", 
                    RowBox[{"positint", ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Range", "[", 
                    RowBox[{"Length", "[", "intermediates0", "]"}], "]"}], 
                    "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "}"}]}], "]"}], ",", 
                    RowBox[{
                    RowBox[{"Range", "[", 
                    RowBox[{"Length", "[", "intermediates0", "]"}], "]"}], 
                    "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], ",", "0"}], "]"}], 
                  "\[IndentingNewLine]", ",", 
                  RowBox[{"{", 
                   RowBox[{"i1", ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{"Range", "[", 
                    RowBox[{"Length", "[", "intermediates0", "]"}], "]"}], 
                    "]"}]}], "}"}]}], "]"}], ",", 
                RowBox[{"Flatten", "[", 
                 RowBox[{"Table", "[", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"positint", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "->", 
                    RowBox[{"eomccindx", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}]}], "}"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"i1", ",", 
                    RowBox[{"Length", "[", "positint", "]"}]}], "}"}]}], 
                  "]"}], " ", "]"}]}], "]"}]}], "]"}], "\[IndentingNewLine]", 
            "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";"}], 
       "\[IndentingNewLine]", ",", 
       RowBox[{"{", 
        RowBox[{"NN", ",", "2"}], "}"}]}], "]"}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8860628702765837`*^9, 3.886062880703899*^9}, {
   3.8860629405269623`*^9, 3.88606294384328*^9}, {3.8860630071984663`*^9, 
   3.88606302284795*^9}, {3.886063053472775*^9, 3.8860630841672373`*^9}, {
   3.886063115839707*^9, 3.8860631377217913`*^9}, {3.886063175292593*^9, 
   3.8860632429678583`*^9}, {3.886063276877873*^9, 3.8860632796977167`*^9}, {
   3.886063340975194*^9, 3.88606336213799*^9}, {3.88606343303765*^9, 
   3.8860634420864153`*^9}, {3.886063504307991*^9, 3.886063554255464*^9}, {
   3.886063604470256*^9, 3.886063648885097*^9}, {3.886063894556819*^9, 
   3.886063895310685*^9}, {3.8860639997190733`*^9, 3.8860640247353363`*^9}, {
   3.886064069474101*^9, 3.886064092658533*^9}, {3.886064135991671*^9, 
   3.886064160003872*^9}, {3.886064273767416*^9, 3.8860642900539007`*^9}, {
   3.886064329907082*^9, 3.886064347360639*^9}, {3.886064408406473*^9, 
   3.886064520791869*^9}, {3.886064708258203*^9, 3.886064744159582*^9}, {
   3.886070827644452*^9, 3.886070870719316*^9}, {3.886071962818578*^9, 
   3.8860719696836987`*^9}, {3.886073849956029*^9, 3.886073866431122*^9}, {
   3.8860739619433537`*^9, 3.886073973708498*^9}, {3.886074917732397*^9, 
   3.8860749794841423`*^9}, {3.886078001468233*^9, 3.886078006599991*^9}, {
   3.886078090077388*^9, 3.886078151821027*^9}, {3.886078193791655*^9, 
   3.886078354752843*^9}, 3.8860786863263273`*^9, {3.886129466240177*^9, 
   3.886129469144033*^9}, {3.88613035157917*^9, 3.886130361944088*^9}, {
   3.886132490799782*^9, 3.886132491335733*^9}, {3.886489826154681*^9, 
   3.886489964709588*^9}, {3.886490020992407*^9, 3.886490051266398*^9}, {
   3.886490090356393*^9, 3.886490139687887*^9}, {3.886490309834961*^9, 
   3.886490357540464*^9}, 3.886490510365011*^9, {3.886490609054481*^9, 
   3.8864906138524513`*^9}, {3.886491254528427*^9, 3.886491287285247*^9}, {
   3.8864915111669073`*^9, 3.886491511218322*^9}, {3.886491650486681*^9, 
   3.886491651996566*^9}, 3.8864917981631536`*^9, {3.886492023750308*^9, 
   3.886492099068016*^9}, {3.886496638404159*^9, 3.886496642414446*^9}, {
   3.886496674046069*^9, 3.886496718262271*^9}, {3.8864967680631866`*^9, 
   3.886496776975647*^9}, {3.886582403779586*^9, 3.886582420610222*^9}, {
   3.88658724348046*^9, 3.886587249961626*^9}, {3.886587761656577*^9, 
   3.88658777106684*^9}, 3.8877975070239058`*^9, 3.8883929966211843`*^9, {
   3.8883930331173058`*^9, 3.888393128718055*^9}, 3.888394130018012*^9, {
   3.890875779195706*^9, 3.8908757899411592`*^9}, 3.8908861955910378`*^9, {
   3.8909949130695467`*^9, 3.890994940585044*^9}, 3.8909950278930063`*^9, 
   3.890995059105584*^9, {3.8909951056950283`*^9, 3.890995128145934*^9}, {
   3.891420021837028*^9, 3.891420085758833*^9}, {3.891420117550269*^9, 
   3.891420132065292*^9}, {3.8915018787374077`*^9, 3.891501891503333*^9}},
 CellLabel->"In[14]:=",ExpressionUUID->"9f77d3e4-ac51-400e-83be-172117124189"]
}, Closed]],

Cell[CellGroupData[{

Cell["Main", "Section",
 CellChangeTimes->{{3.8502124694131107`*^9, 3.850212483911498*^9}, {
   3.8508075976382303`*^9, 3.850807637386962*^9}, {3.85157491870508*^9, 
   3.8515749220559587`*^9}, {3.851575053203541*^9, 3.851575059139056*^9}, 
   3.851575661024029*^9, {3.85157970682765*^9, 3.851579715418345*^9}, {
   3.853485369144342*^9, 3.853485401318177*^9}, {3.8538499840059443`*^9, 
   3.853849987654407*^9}, {3.858858281395907*^9, 3.858858293975215*^9}, {
   3.858933373401108*^9, 3.8589333741657867`*^9}, 3.8593504401846657`*^9, 
   3.8593540895014963`*^9},ExpressionUUID->"3436a351-fd66-47e8-92d7-\
a0bd0cc01347"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"EOMCCgen", "[", 
    RowBox[{"ClusterOperator_", ",", "EOMOperator_"}], "]"}], ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "Prefactors", ",", "Amplitudes", ",", "StringS", ",", "ManyBodyBlocks", 
       ",", "ManyBodyTerms", ",", "DeltaKronecker", ",", 
       "ManyBodyTermsEquations", ",", "time"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"time", "=", 
       RowBox[{
        RowBox[{"Timing", "[", "\[IndentingNewLine]", 
         RowBox[{"(*", Cell["\<\
PrefAmplStr module  generates the pre-factors, amplitudes, and strings of \
second quantization\
\>", "Text",
           CellChangeTimes->{{3.887368635731531*^9, 3.887368728241324*^9}},
           ExpressionUUID->"7546cac2-602d-42b7-98ff-e3b481db7ce7"], "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"Prefactors", ",", "Amplitudes", ",", "StringS"}], "}"}], 
           "=", 
           RowBox[{"PrefAmplStr", "[", 
            RowBox[{"ClusterOperator", ",", "EOMOperator"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"(*", Cell["\<\
ManyBodyHamiltonian module  generates the eomcc equations in terms of \
many-body terms, the set of non-redundant many body terms and and the \
intermediates in second quantization\
\>", "Text",
            CellChangeTimes->{{3.887368635731531*^9, 3.887368728241324*^9}},
            ExpressionUUID->"0d8919a8-20dc-4d6f-85ea-40692e67d88a"], "*)"}], 
          "\[IndentingNewLine]", "  ", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"ManyBodyBlocks", ",", "ManyBodyTerms"}], "}"}], "=", 
           RowBox[{"ManyBodyHamiltonian", "[", "StringS", "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"(*", Cell["\<\
WicksContract module  generates the deltas Kronekers and the signs \
correspondingly\
\>", "Text",
            CellChangeTimes->{{3.887368635731531*^9, 3.887368728241324*^9}},
            ExpressionUUID->"7087baf3-8f3d-42da-9aed-9d620da7681c"], "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{"DeltaKronecker", "=", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"Table", "[", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"Table", "[", 
                RowBox[{
                 RowBox[{"WicksContract", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"ManyBodyTerms", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                   RowBox[{"[", "i1", "]"}], "]"}], "]"}], " ", ",", 
                 RowBox[{"{", 
                  RowBox[{"i1", ",", 
                   RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{"ManyBodyTerms", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
               "\[IndentingNewLine]", ",", 
               RowBox[{"{", 
                RowBox[{"j1", ",", 
                 RowBox[{"Length", "[", 
                  RowBox[{"ManyBodyTerms", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
             ",", 
             RowBox[{"{", 
              RowBox[{"k1", ",", 
               RowBox[{"Length", "[", "ManyBodyTerms", "]"}]}], "}"}]}], 
            "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"(*", Cell["\<\
AntySymPermut Module  generates the pre-factors, amplitudes, and strings of \
second quantization\
\>", "Text",
            CellChangeTimes->{{3.887368635731531*^9, 3.887368728241324*^9}},
            ExpressionUUID->"253829b9-6c6e-431b-af0f-e97237564530"], "*)"}], 
          " ", "\[IndentingNewLine]", 
          RowBox[{"ManyBodyTermsEquations", "=", 
           RowBox[{"AntSymPermut", "[", 
            RowBox[{
            "DeltaKronecker", ",", "ManyBodyTerms", ",", "Amplitudes", ",", 
             "Prefactors"}], "]"}]}], ";"}], "\[IndentingNewLine]", "]"}], 
        " ", "/.", " ", 
        RowBox[{"Null", " ", "->", 
         RowBox[{"Sequence", "[", "]"}]}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", Cell["Printing options", "Text",
        CellChangeTimes->{{3.887368635731531*^9, 3.887368728241324*^9}},
        ExpressionUUID->"5287208a-6ce9-41d1-bcab-2fa11d3aa6fd"], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"Style", "[", 
        RowBox[{"\"\<Output\>\"", ",", "Bold", ",", "24"}], "]"}], "]"}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"Style", "[", 
        RowBox[{"\"\<Execution Time\>\"", ",", "Bold", ",", "Blue"}], "]"}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", "time", "]"}], " ", ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"Style", "[", 
        RowBox[{"\"\<Many-body terms\>\"", ",", "Bold", ",", "Blue"}], "]"}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"TableForm", "[", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"ManyBodyTermsEquations", "[", 
               RowBox[{"[", "2", "]"}], "]"}], "[", 
              RowBox[{"[", "1", "]"}], "]"}], "[", 
             RowBox[{"[", "1", "]"}], "]"}], "[", 
            RowBox[{"[", "i1", "]"}], "]"}], "==", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"(", " ", 
               RowBox[{
                RowBox[{
                 RowBox[{"ManyBodyTermsEquations", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "+", 
                RowBox[{
                 RowBox[{
                  RowBox[{"ManyBodyTermsEquations", "[", 
                   RowBox[{"[", "2", "]"}], "]"}], "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], ")"}], "/.", " ", 
              RowBox[{"0", " ", "->", " ", 
               RowBox[{"Sequence", "[", "]"}]}]}], ")"}], "[", 
            RowBox[{"[", "i1", "]"}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"ManyBodyTermsEquations", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "[", 
               RowBox[{"[", "1", "]"}], "]"}], "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], "]"}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"Style", "[", 
        RowBox[{"\"\<EOM-CC equations\>\"", ",", "Bold", ",", "Blue"}], "]"}],
        "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", "ManyBodyBlocks", "]"}], ";"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.853480378711502*^9, {3.8534805665284567`*^9, 3.853480583482067*^9}, {
   3.85348148126723*^9, 3.853481526110957*^9}, {3.853482074962281*^9, 
   3.8534820815113497`*^9}, 3.853482127020323*^9, {3.85348217250499*^9, 
   3.853482184035735*^9}, {3.8534830556422863`*^9, 3.853483212330266*^9}, {
   3.853484619166396*^9, 3.8534846436173773`*^9}, {3.853484893226053*^9, 
   3.8534850364422073`*^9}, 3.853485092983137*^9, {3.853485207934641*^9, 
   3.853485262314402*^9}, {3.8534904164403887`*^9, 3.853490443855022*^9}, {
   3.853493843023603*^9, 3.8534938467051086`*^9}, {3.853494665757327*^9, 
   3.853494667489562*^9}, {3.8535577198001833`*^9, 3.853557723610811*^9}, {
   3.853589103268445*^9, 3.853589106310793*^9}, {3.8535895927938547`*^9, 
   3.853589597461602*^9}, {3.853589775665537*^9, 3.853589777690363*^9}, {
   3.853589948091682*^9, 3.853589970314218*^9}, {3.853822469833658*^9, 
   3.853822469941988*^9}, {3.85392731452606*^9, 3.853927315095944*^9}, {
   3.853927988060256*^9, 3.853927988858214*^9}, {3.853997254425767*^9, 
   3.85399734594383*^9}, {3.8540777037321177`*^9, 3.854077725079319*^9}, {
   3.854093985595593*^9, 3.854094015052782*^9}, {3.858858079344387*^9, 
   3.858858101543788*^9}, {3.85891509633799*^9, 3.858915099084292*^9}, 
   3.858918147404271*^9, {3.8589294455143557`*^9, 3.858929447060217*^9}, {
   3.858933411684271*^9, 3.858933553100418*^9}, {3.8593507494486847`*^9, 
   3.859350759239324*^9}, {3.859354092922209*^9, 3.859354100170932*^9}, {
   3.860658391267634*^9, 3.8606583923097153`*^9}, {3.86065858551674*^9, 
   3.860658609525893*^9}, {3.860658691305871*^9, 3.8606587113936033`*^9}, {
   3.860658757123204*^9, 3.8606587650941963`*^9}, {3.860659459782556*^9, 
   3.8606594830408173`*^9}, {3.86065978950071*^9, 3.860659792317163*^9}, {
   3.860659854695496*^9, 3.860659923049326*^9}, 3.860660008297353*^9, {
   3.860660120885869*^9, 3.860660121207405*^9}, {3.860660362607555*^9, 
   3.860660393953298*^9}, {3.8606604839103937`*^9, 3.8606605985468082`*^9}, {
   3.8606608659014597`*^9, 3.860660913850699*^9}, {3.860660990536624*^9, 
   3.860661023051462*^9}, {3.860661889547598*^9, 3.860661914007555*^9}, {
   3.860662026322112*^9, 3.8606620278127813`*^9}, {3.8763926691914177`*^9, 
   3.876392789138793*^9}, 3.876451517891654*^9, {3.8764516132618113`*^9, 
   3.876451620898875*^9}, {3.876451672363502*^9, 3.8764516947124863`*^9}, {
   3.8764517531760073`*^9, 3.876451860279558*^9}, {3.87645191522838*^9, 
   3.876451925532276*^9}, {3.876452031293944*^9, 3.8764520956987343`*^9}, {
   3.8764528524701757`*^9, 3.876452920326171*^9}, {3.876453007975161*^9, 
   3.876453010251786*^9}, {3.876453045944579*^9, 3.876453046312729*^9}, {
   3.8764531406353416`*^9, 3.876453143276493*^9}, 3.8764681727348757`*^9, {
   3.8764682098524857`*^9, 3.876468252166006*^9}, 3.876470409566757*^9, 
   3.876471430268311*^9, {3.8764774142085733`*^9, 3.876477430237659*^9}, {
   3.876477506460228*^9, 3.876477559030897*^9}, 3.876541284913409*^9, 
   3.876541378512224*^9, 3.876541825718071*^9, {3.8765422588239727`*^9, 
   3.876542291975607*^9}, {3.876542332671247*^9, 3.87654235985083*^9}, {
   3.876542432579852*^9, 3.876542505971046*^9}, {3.876542543279347*^9, 
   3.876542562913742*^9}, {3.8765426425524797`*^9, 3.876542658626173*^9}, {
   3.876542719774538*^9, 3.8765427204055243`*^9}, 3.876542759863143*^9, 
   3.876542790822418*^9, {3.8765429510515947`*^9, 3.876542952813653*^9}, {
   3.8775204418477917`*^9, 3.877520442407831*^9}, {3.885388163629043*^9, 
   3.885388166368857*^9}, {3.88736908098905*^9, 3.887369359637871*^9}, {
   3.8873693966747*^9, 3.8873694067730103`*^9}, {3.887428484746799*^9, 
   3.887428492464999*^9}, {3.8874285270525312`*^9, 3.8874285360147657`*^9}, {
   3.88742880953618*^9, 3.887428918319582*^9}, {3.8874289708541117`*^9, 
   3.887428983479742*^9}, {3.887429058188202*^9, 3.8874291083267*^9}, {
   3.887429160789589*^9, 3.8874291919086637`*^9}, {3.887430195392013*^9, 
   3.887430237095497*^9}, {3.887430288158751*^9, 3.88743029078371*^9}, {
   3.887445501265873*^9, 3.887445603093956*^9}, {3.8874532982152452`*^9, 
   3.887453304438463*^9}, {3.8874547287732153`*^9, 3.887454734877046*^9}, {
   3.887454863989217*^9, 3.8874550069493523`*^9}, {3.887785700829331*^9, 
   3.887785751310053*^9}, {3.887788105868289*^9, 3.887788118915358*^9}, {
   3.887797484907496*^9, 3.887797519820375*^9}, 3.890149766821556*^9, 
   3.890189357338543*^9, 3.8908763322500067`*^9, 3.891059496364546*^9, 
   3.891071152255864*^9},
 CellLabel->"In[15]:=",ExpressionUUID->"dbb5a5f3-12f2-4abb-baeb-51337762cfd7"],

Cell[, "Input",ExpressionUUID->"7476b777-9498-400a-b4ee-681a4bb77fda"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Examples ", "Title",
 CellChangeTimes->{{3.858323676094317*^9, 3.858323685587489*^9}, {
   3.860053063669647*^9, 3.860053080799135*^9}, {3.8600531394052887`*^9, 
   3.860053141660288*^9}, {3.860660534554838*^9, 3.860660543565796*^9}, 
   3.8764521200458317`*^9, {3.886065021841052*^9, 3.88606505824818*^9}, {
   3.886584594929537*^9, 
   3.886584601682254*^9}},ExpressionUUID->"29ca02b7-292d-4475-87e0-\
9f1bc42060a2"],

Cell[CellGroupData[{

Cell[, "Section",ExpressionUUID->"b12cda75-0a82-41cf-baca-d47ee48a96e3"],

Cell[, "Text",ExpressionUUID->"79f77511-b75b-44c1-970f-fc8c2de67687"],

Cell[, "Text",ExpressionUUID->"2b1e9254-3a9f-4daa-b0fd-07480dafb6d9"],

Cell[CellGroupData[{

Cell[, "Input",ExpressionUUID->"75f8d824-bb00-4596-817d-ffc6d0068bff"],

Cell[CellGroupData[{

Cell[, "Print",ExpressionUUID->"7969b244-97fd-4327-ae9a-c37c3af842a1"],

Cell[, "Print",ExpressionUUID->"20aa1ae0-c363-4d9f-953f-28031f5e9dc9"]
}, Open  ]],

Cell[, "Output",ExpressionUUID->"71999752-f843-4276-9842-f2f3ec52ec00"]
}, Open  ]],

Cell[CellGroupData[{

Cell[, "Input",ExpressionUUID->"b48d5797-0723-4a71-afa4-bc507b47a062"],

Cell[, "Output",ExpressionUUID->"2ce21daf-ccb5-496f-8c8b-438df73b83f4"]
}, Open  ]],

Cell[CellGroupData[{

Cell[, "Input",ExpressionUUID->"41193bee-647c-40ae-9562-f179c6387a37"],

Cell[, "Output",ExpressionUUID->"48dc2350-4b3a-4fa4-ac51-23e4479ad77d"]
}, Open  ]],

Cell[, "Input",ExpressionUUID->"c0a2769f-76c4-4cbc-bc7c-e8d163419970"]
}, Closed]],

Cell[CellGroupData[{

Cell[, "Section",ExpressionUUID->"f109d640-d6b5-4ad1-b813-d01579a048c9"],

Cell[, "Text",ExpressionUUID->"b8dcee47-aac1-44a3-9221-c27902aa9929"],

Cell[CellGroupData[{

Cell[, "Input",ExpressionUUID->"22aab238-3115-4fb4-93d3-17335e719fee"],

Cell[CellGroupData[{

Cell[, "Print",ExpressionUUID->"ebe78b8c-54b1-42b5-9038-5c1a83ab2c30"],

Cell[, "Print",ExpressionUUID->"80e67e04-dec6-48d9-9525-8e6e5beffe89"],

Cell[, "Print",ExpressionUUID->"1ffdc98d-d085-4a50-9839-722ef10d23f3"],

Cell[, "Print",ExpressionUUID->"9670a145-e01d-4cd8-abdb-050c112f9eef"],

Cell[, "Print",ExpressionUUID->"3147a2a5-0073-4001-b820-3d9694822541"],

Cell[, "Print",ExpressionUUID->"654c945f-6c5f-463a-8683-c37b01a808bd"],

Cell[, "Print",ExpressionUUID->"63a96344-5f5f-4ca3-8e8d-2a3e9635daae"]
}, Open  ]]
}, Open  ]],

Cell[, "Input",ExpressionUUID->"baccd54a-a717-4f2c-898d-393c8bf08fe1"]
}, Closed]],

Cell[CellGroupData[{

Cell[, "Section",ExpressionUUID->"07e70351-fe32-466a-af78-37e978d58a5b"],

Cell[, "Text",ExpressionUUID->"98280eac-668c-4643-92bf-78430aa6f202"],

Cell[CellGroupData[{

Cell[, "Input",ExpressionUUID->"1d682547-5476-48c8-899a-c2bd712e2820"],

Cell[CellGroupData[{

Cell[, "Print",ExpressionUUID->"fecd3130-b53d-43da-a485-c9fdf5598f5d"],

Cell[, "Print",ExpressionUUID->"00a43acb-14f7-4fa5-a8be-ea0188bf716c"],

Cell[, "Print",ExpressionUUID->"43333a57-30cf-432e-aae1-a247bb269a53"],

Cell[, "Print",ExpressionUUID->"958ad858-4cc0-46a9-a2be-9e41abb6bfed"],

Cell[, "Print",ExpressionUUID->"b2bf4f7e-3e43-4f80-96f0-269e89b5802f"]
}, Open  ]]
}, Open  ]],

Cell[, "Input",ExpressionUUID->"a2a18a0a-ffdd-44c7-858d-335f1dfc456e"]
}, Closed]],

Cell[CellGroupData[{

Cell[, "Section",ExpressionUUID->"17fb1a3e-3f71-4f47-a11a-49ad9e109fcb"],

Cell[, "Text",ExpressionUUID->"fea153e6-55c3-4427-99f8-8407c26f4e70"],

Cell[, "Text",ExpressionUUID->"bd7aa1c3-67eb-416a-8264-9f0344490ebf"],

Cell[CellGroupData[{

Cell[, "Input",ExpressionUUID->"f1461427-57de-4e92-963d-f5bc5f83dd17"],

Cell[CellGroupData[{

Cell[, "Print",ExpressionUUID->"81ba589e-c9a2-40f6-a28a-0ea26f596672"],

Cell[, "Print",ExpressionUUID->"79ba447c-68e2-4278-a250-65e095a20a3c"],

Cell[, "Print",ExpressionUUID->"916b5e01-7f6c-449d-b1a7-ea00466328fc"],

Cell[, "Print",ExpressionUUID->"44eeabe9-3ab6-42b9-9cdd-f2c834fdd9fe"],

Cell[, "Print",ExpressionUUID->"c9317d4e-cb3b-4830-b506-d316e22d06d8"]
}, Open  ]]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell[, "Section",ExpressionUUID->"1bf8c2bc-900a-46b8-abdb-a29d70d5b19e"],

Cell[, "Text",ExpressionUUID->"0fc3a552-6740-4389-8aab-456858c085e3"],

Cell[, "Text",ExpressionUUID->"72398fb2-faa5-4d40-8e30-d9fe735f0057"],

Cell[CellGroupData[{

Cell[, "Input",ExpressionUUID->"b9ab802d-37a8-413e-88c6-94786d1453b6"],

Cell[CellGroupData[{

Cell[, "Print",ExpressionUUID->"a2e82f09-f812-4174-8374-551d64dc22ec"],

Cell[, "Print",ExpressionUUID->"a91ad6cc-dd14-4a81-a821-2abe750de617"],

Cell[, "Print",ExpressionUUID->"f7e1b347-77ac-4a5b-868e-2fdb89f60a39"],

Cell[, "Print",ExpressionUUID->"7125deb1-56e8-4964-958d-0420bad108b2"],

Cell[, "Print",ExpressionUUID->"25a53bfe-9b8b-4651-967a-ba956b2fde72"]
}, Open  ]]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell[, "Section",ExpressionUUID->"1bbe590b-cf10-42d8-89fa-0eac894ece62"],

Cell[, "Text",ExpressionUUID->"0127995e-31f0-4283-81a3-fc3a57f32576"],

Cell[, "Text",ExpressionUUID->"dd26250f-aa77-4195-889e-63c682c8c250"],

Cell[CellGroupData[{

Cell[, "Input",ExpressionUUID->"69af8fdf-6ec7-4fc6-b6c1-646c034a6d8c"],

Cell[CellGroupData[{

Cell[, "Print",ExpressionUUID->"fce4fe01-2a1c-4d1d-9839-6ad7e62d1059"],

Cell[, "Print",ExpressionUUID->"d2a1f61e-0694-46db-bcde-b684f4457451"],

Cell[, "Print",ExpressionUUID->"eb9720c3-f182-4cef-beb8-c94c6a4be8d1"],

Cell[, "Print",ExpressionUUID->"b42f238b-f897-45e8-838c-45bbfbba3ffc"],

Cell[, "Print",ExpressionUUID->"b1648c1e-81e6-436b-92b2-b2c806e9d8ce"]
}, Open  ]]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell[, "Section",ExpressionUUID->"7ad6dc8b-0121-4178-b735-2d531bc4306d"],

Cell[, "Text",ExpressionUUID->"c554eb2b-4f71-46a5-8c07-73e258ee3654"],

Cell[, "Text",ExpressionUUID->"32bde7ac-37d3-484e-acf8-0febf80b00e8"],

Cell[CellGroupData[{

Cell[, "Input",ExpressionUUID->"8b8c8cdf-36b1-4839-bb0c-eb7071e6d022"],

Cell[CellGroupData[{

Cell[, "Print",ExpressionUUID->"1b6abd22-45cd-4e31-b1af-9d59cf4a5908"],

Cell[, "Print",ExpressionUUID->"569563ed-1d05-4b77-b948-cb0c6c8caf5a"],

Cell[, "Print",ExpressionUUID->"4ca873bf-ff30-4398-b33b-eb08978b6912"],

Cell[, "Print",ExpressionUUID->"b507c33e-2095-4def-9da1-d609a8927a35"],

Cell[, "Print",ExpressionUUID->"bc973c5d-165b-4a70-ad35-f7fe6303d7d1"]
}, Open  ]]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell[, "Section",ExpressionUUID->"626a6a78-6cc5-427d-83d6-5d9c00926041"],

Cell[, "Text",ExpressionUUID->"ec237eae-00d1-4720-ac00-8c3c203df6ec"],

Cell[, "Text",ExpressionUUID->"d7f9ba48-24ab-4a26-99d0-0122d6339b3a"],

Cell[CellGroupData[{

Cell[, "Input",ExpressionUUID->"e1c9915d-496b-44c3-b713-ab6638a8849b"],

Cell[CellGroupData[{

Cell[, "Print",ExpressionUUID->"22f3e565-2d30-44f6-a87e-fe8dafb28787"],

Cell[, "Print",ExpressionUUID->"e7c8eb83-9eff-4923-8448-7989fb204043"],

Cell[, "Print",ExpressionUUID->"af2f4519-7984-4ef1-860f-1ed757114064"],

Cell[, "Print",ExpressionUUID->"e9b76888-f798-4de2-a3b0-4eef7b2466aa"],

Cell[, "Print",ExpressionUUID->"ee61c4da-e010-444c-8c63-85af1dd098e4"],

Cell[, "Print",ExpressionUUID->"18ccbfdb-f44d-4a1a-97e9-3f9bd48d213a"],

Cell[, "Print",ExpressionUUID->"37d91352-510d-4879-a8de-db042df68230"]
}, Open  ]]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell[, "Section",ExpressionUUID->"b25ae3dd-5554-4cfb-9d2a-0b8083242125"],

Cell[, "Text",ExpressionUUID->"3a1f1f32-2a62-4237-86e8-7430543b231d"],

Cell[, "Text",ExpressionUUID->"84815ce8-e15d-4a49-bfe2-5351d9a66c63"],

Cell[CellGroupData[{

Cell[, "Input",ExpressionUUID->"070c458e-6f39-481e-8c42-386f2f858153"],

Cell[CellGroupData[{

Cell[, "Print",ExpressionUUID->"550a34f8-f94c-4cef-9192-442f714e0a50"],

Cell[, "Print",ExpressionUUID->"00d4c5a2-805a-4f7c-9033-c871073debc5"],

Cell[, "Print",ExpressionUUID->"b76e08b0-3bfe-4275-af2b-a860dfa16e46"],

Cell[, "Print",ExpressionUUID->"1d358df2-74bf-40e4-9a2b-ff9e58a5d998"],

Cell[, "Print",ExpressionUUID->"12a11430-c7b0-4b3b-a524-2da867feec8f"],

Cell[, "Print",ExpressionUUID->"3307689b-ddee-47de-a97b-da9b9aded6f1"],

Cell[, "Print",ExpressionUUID->"8d76da4d-4fd2-4f48-af0e-0bcf30c0c8cd"]
}, Open  ]]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell[, "Section",ExpressionUUID->"2d8cfcb1-0611-40a2-b7ca-9e2eb6a295fd"],

Cell[, "Text",ExpressionUUID->"89dd3eb6-686b-4d25-81c6-d0aec5e4623f"],

Cell[, "Text",ExpressionUUID->"450df8f4-3a9d-4433-b2c4-caf4817a449a"],

Cell[CellGroupData[{

Cell[, "Input",ExpressionUUID->"ce5cbdd8-b7c0-4ed9-8913-9e33343ebc3e"],

Cell[CellGroupData[{

Cell[, "Print",ExpressionUUID->"e261003c-8326-4f64-8c94-21c180e21298"],

Cell[, "Print",ExpressionUUID->"5f98f2c1-81b6-4c2f-a370-0f7e048339eb"],

Cell[, "Print",ExpressionUUID->"0da6e9e3-c6f3-40bb-a242-920e069785af"],

Cell[, "Print",ExpressionUUID->"7fbf955a-135a-444a-a9bc-04333c87d2d5"],

Cell[, "Print",ExpressionUUID->"a66824f5-4cc3-4656-8da8-edadab4baf99"],

Cell[, "Print",ExpressionUUID->"d6db1d53-90e8-49af-bf3a-e1b68ad2e627"],

Cell[, "Print",ExpressionUUID->"7774facd-eb20-48c9-ab45-56ee2a83289e"]
}, Open  ]]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell[, "Section",ExpressionUUID->"4bc1c026-13ff-42d6-9529-f0dac01ecae8"],

Cell[, "Text",ExpressionUUID->"6be367af-ff2e-43ca-beed-92c9a44e44c6"],

Cell[CellGroupData[{

Cell[, "Input",ExpressionUUID->"8925830b-1a44-4348-a1e3-70d4de1904e5"],

Cell[CellGroupData[{

Cell[, "Print",ExpressionUUID->"37b23f0c-fdda-4de7-bf84-649fb917d8dd"],

Cell[, "Print",ExpressionUUID->"075e4f8a-28d1-408b-b779-184a0e082c17"],

Cell[, "Print",ExpressionUUID->"c689d450-e882-4b1c-bebe-bbb66e53e090"],

Cell[, "Print",ExpressionUUID->"f575a3bc-2a90-43c0-b581-f7f6b060e957"],

Cell[, "Print",ExpressionUUID->"77a72f8f-d2ec-4b32-89c6-a8c903feb7c8"],

Cell[, "Print",ExpressionUUID->"b58beeab-291e-44f4-af43-bb3791efe7f1"],

Cell[, "Print",ExpressionUUID->"6ae0b64f-e2be-4265-a623-1efeb3a178c6"]
}, Open  ]]
}, Open  ]]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["Trial for Einstein Summation", "Title",
 CellChangeTimes->{{3.858323676094317*^9, 3.858323685587489*^9}, {
   3.860053063669647*^9, 3.860053080799135*^9}, {3.8600531394052887`*^9, 
   3.860053141660288*^9}, {3.860660534554838*^9, 3.860660543565796*^9}, 
   3.8764521200458317`*^9, {3.886065021841052*^9, 3.88606505824818*^9}, {
   3.886584594929537*^9, 3.886584601682254*^9}, {3.891068349097814*^9, 
   3.891068350755382*^9}, {3.891068573825432*^9, 3.891068576637699*^9}, 
   3.8910687438438387`*^9, {3.891072731256119*^9, 3.891072734222782*^9}, 
   3.891414018173113*^9, {3.8915733397642384`*^9, 
   3.8915733432471037`*^9}},ExpressionUUID->"fe352605-1bea-4f34-b2b5-\
0141f38eedf4"],

Cell[, "Input",ExpressionUUID->"58946208-10b2-4a6e-9af8-f586d7b2d75c"],

Cell[CellGroupData[{

Cell[, "Input",ExpressionUUID->"6de971c6-f881-4c73-9b4d-31619548b6d4"],

Cell[, "Output",ExpressionUUID->"bfe14bf9-df88-40df-a41d-62ed2bede81c"]
}, Open  ]],

Cell[, "Input",ExpressionUUID->"c3eb4bd3-e666-4970-9e5d-907f75e0f8c8"],

Cell[, "Input",ExpressionUUID->"85f4f745-8082-40f4-94f1-7a9d3592d341"],

Cell[, "Input",ExpressionUUID->"f30001c7-09d3-4df3-a365-4ae888cb6fee"],

Cell[, "Input",ExpressionUUID->"9c902585-99ce-459e-8841-9eb06a26cc78"],

Cell[CellGroupData[{

Cell[, "Input",ExpressionUUID->"19b57ad3-4277-46b6-9335-c44fdae97ea4"],

Cell[, "Output",ExpressionUUID->"6cf60f36-565b-4a5f-aa9b-ee7967bf76fa"]
}, Open  ]],

Cell[, "Input",ExpressionUUID->"30243c51-32f6-49ad-a504-23989df76a74"],

Cell[CellGroupData[{

Cell[, "Input",ExpressionUUID->"19161adf-f8e1-41be-b7ca-2b68eedfcc31"],

Cell[, "Output",ExpressionUUID->"c58b5e14-9164-40a8-8459-f1277e89dcc0"]
}, Open  ]],

Cell[, "Input",ExpressionUUID->"c0df4d5c-044c-4077-8b9c-d84a507b22c3"]
}, Closed]],

Cell[CellGroupData[{

Cell["Exampled for the paper", "Title",
 CellChangeTimes->{{3.858323676094317*^9, 3.858323685587489*^9}, {
   3.860053063669647*^9, 3.860053080799135*^9}, {3.8600531394052887`*^9, 
   3.860053141660288*^9}, {3.860660534554838*^9, 3.860660543565796*^9}, 
   3.8764521200458317`*^9, {3.886065021841052*^9, 3.88606505824818*^9}, {
   3.886584594929537*^9, 3.886584601682254*^9}, {3.891068349097814*^9, 
   3.891068350755382*^9}, {3.891068573825432*^9, 3.891068576637699*^9}, 
   3.8910687438438387`*^9, {3.891072731256119*^9, 3.891072734222782*^9}, 
   3.891414018173113*^9, {3.8915733397642384`*^9, 3.8915733432471037`*^9}, {
   3.891588063927285*^9, 
   3.891588068747768*^9}},ExpressionUUID->"1e4c3b07-d92e-4eb7-9869-\
0bcc8e57ad27"],

Cell[BoxData[{
 RowBox[{
  SubscriptBox["\[Delta]", 
   RowBox[{"p_", ",", "q_"}]], ":=", 
  RowBox[{"KroneckerDelta", "[", 
   RowBox[{"p", ",", "q"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ClusterOperator", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", "\"\<1h1p\>\"", "}"}], ",", 
     RowBox[{"{", "\"\<2h2p\>\"", "}"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"EOMOperator", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", "\"\<1h1p\>\"", "}"}], ",", 
     RowBox[{"{", "\"\<2h2p\>\"", "}"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"EOMCCgen", "[", 
    RowBox[{"ClusterOperator", ",", "EOMOperator"}], "]"}], 
   "*)"}]}]}], "Input",
 CellChangeTimes->{{3.891655632679503*^9, 3.891655672703898*^9}, {
   3.892002948220996*^9, 3.892002957926404*^9}, 3.8920029954629383`*^9, {
   3.8920030393601837`*^9, 3.892003043218944*^9}, {3.8920255184017773`*^9, 
   3.8920255296840887`*^9}, {3.8920284952334223`*^9, 3.892028497151544*^9}, {
   3.892028969863318*^9, 3.892028971967545*^9}, {3.892030196078964*^9, 
   3.8920301977308407`*^9}},ExpressionUUID->"ed700842-98b4-4a59-bc1e-\
16354f56d166"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"Prefactors", ",", "Amplitudes", ",", "StringS"}], "}"}], "=", 
   RowBox[{"PrefAmplStr", "[", 
    RowBox[{"ClusterOperator", ",", "EOMOperator"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"  ", 
  RowBox[{
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ManyBodyBlocks", ",", "ManyBodyTerms"}], "}"}], "=", 
    RowBox[{"ManyBodyHamiltonian", "[", "StringS", "]"}]}], ";"}]}]}], "Input",\

 CellChangeTimes->{{3.892003018077409*^9, 3.892003024997754*^9}},
 CellLabel->
  "In[1381]:=",ExpressionUUID->"6df5c636-144a-4388-8271-05a41896f48c"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ManyBodyTerms", "=", 
  RowBox[{
   RowBox[{
    RowBox[{"ManyBodyTerms", "[", 
     RowBox[{"[", "2", "]"}], "]"}], "[", 
    RowBox[{"[", "7", "]"}], "]"}], "[", 
   RowBox[{"[", "5", "]"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.892017173048917*^9, 3.89201722787184*^9}},
 CellLabel->
  "In[1390]:=",ExpressionUUID->"38b00cae-510c-4c4c-8866-4bdcda2bad67"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     SuperscriptBox["h1", "\[Dagger]"], ",", 
     SuperscriptBox["h2", "\[Dagger]"], ",", "p2"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     SuperscriptBox["q1", "\[Dagger]"], ",", 
     SuperscriptBox["q2", "\[Dagger]"], ",", "q4", ",", "q3"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"{", 
     RowBox[{
      SuperscriptBox["v1", "\[Dagger]"], ",", "o1", ",", 
      SuperscriptBox["v2", "\[Dagger]"], ",", "o2"}], "}"}], "}"}], ",", 
   RowBox[{"{", "h3", "}"}]}], "}"}]], "Output",
 CellChangeTimes->{{3.892017174986052*^9, 3.892017228906345*^9}},
 CellLabel->
  "Out[1390]=",ExpressionUUID->"053d015f-cfb8-4461-8a2d-d146153761d4"]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"DeltaKronecker", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"Table", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"WicksContract", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"ManyBodyTerms", "[", 
             RowBox[{"[", "k1", "]"}], "]"}], "[", 
            RowBox[{"[", "j1", "]"}], "]"}], "[", 
           RowBox[{"[", "i1", "]"}], "]"}], "]"}], " ", ",", 
         RowBox[{"{", 
          RowBox[{"i1", ",", 
           RowBox[{"Length", "[", 
            RowBox[{
             RowBox[{"ManyBodyTerms", "[", 
              RowBox[{"[", "k1", "]"}], "]"}], "[", 
             RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
       "\[IndentingNewLine]", ",", 
       RowBox[{"{", 
        RowBox[{"j1", ",", 
         RowBox[{"Length", "[", 
          RowBox[{"ManyBodyTerms", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"k1", ",", 
       RowBox[{"Length", "[", "ManyBodyTerms", "]"}]}], "}"}]}], "]"}]}], 
  ";"}]], "Input",ExpressionUUID->"9c183f9e-2705-456a-89eb-7dbef92915ed"],

Cell[BoxData[
 RowBox[{" ", 
  RowBox[{
   RowBox[{
    RowBox[{"Op1", "=", 
     RowBox[{"{", "}"}]}], ";", " ", 
    RowBox[{"Op2", "=", 
     RowBox[{"{", "}"}]}], ";", "   ", 
    RowBox[{"Op3", "=", 
     RowBox[{"{", "}"}]}], ";", " ", 
    RowBox[{"Op4", "=", 
     RowBox[{"{", "}"}]}], ";", "   ", 
    RowBox[{"Op5", "=", 
     RowBox[{"{", "}"}]}], ";", "    ", 
    RowBox[{"Op6", "=", 
     RowBox[{"{", "}"}]}], ";", "    ", 
    RowBox[{"Op7", "=", 
     RowBox[{"{", "}"}]}], ";", " ", 
    RowBox[{"Op8", "=", 
     RowBox[{"{", "}"}]}], ";"}], "  ", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Do", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"ManyBodyTerms", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "[", 
            RowBox[{"[", "j1", "]"}], "]"}], "[", 
           RowBox[{"[", "0", "]"}], "]"}], "===", "SuperDagger"}], ",", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"Op1", ",", 
           RowBox[{
            RowBox[{
             RowBox[{"ManyBodyTerms", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "[", 
             RowBox[{"[", "j1", "]"}], "]"}], "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ",", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"Op2", ",", 
           RowBox[{
            RowBox[{"ManyBodyTerms", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "[", 
            RowBox[{"[", "j1", "]"}], "]"}]}], "]"}]}], "]"}], ";"}], 
      "\[IndentingNewLine]", ",", 
      RowBox[{"{", 
       RowBox[{"j1", ",", 
        RowBox[{"Length", "[", 
         RowBox[{"ManyBodyTerms", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Do", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"ManyBodyTerms", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "[", 
            RowBox[{"[", "j1", "]"}], "]"}], "[", 
           RowBox[{"[", "0", "]"}], "]"}], "===", "SuperDagger"}], ",", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"Op3", ",", 
           RowBox[{
            RowBox[{
             RowBox[{"ManyBodyTerms", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "[", 
             RowBox[{"[", "j1", "]"}], "]"}], "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ",", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"Op4", ",", 
           RowBox[{
            RowBox[{"ManyBodyTerms", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "[", 
            RowBox[{"[", "j1", "]"}], "]"}]}], "]"}]}], "]"}], ";"}], 
      "\[IndentingNewLine]", ",", 
      RowBox[{"{", 
       RowBox[{"j1", ",", 
        RowBox[{"Length", "[", 
         RowBox[{"ManyBodyTerms", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Op5", "=", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"ManyBodyTerms", "[", 
               RowBox[{"[", "3", "]"}], "]"}], "[", 
              RowBox[{"[", "j1", "]"}], "]"}], "[", 
             RowBox[{"[", "k1", "]"}], "]"}], "[", 
            RowBox[{"[", "0", "]"}], "]"}], "===", "SuperDagger"}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"ManyBodyTerms", "[", 
              RowBox[{"[", "3", "]"}], "]"}], "[", 
             RowBox[{"[", "j1", "]"}], "]"}], "[", 
            RowBox[{"[", "k1", "]"}], "]"}], "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], "]"}], " ", "/.", 
        RowBox[{"Null", " ", "->", " ", 
         RowBox[{"Sequence", "[", "]"}]}]}], "\[IndentingNewLine]", ",", 
       RowBox[{"{", 
        RowBox[{"j1", ",", 
         RowBox[{"Length", "[", 
          RowBox[{"ManyBodyTerms", "[", 
           RowBox[{"[", "3", "]"}], "]"}], "]"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"k1", ",", 
         RowBox[{"Length", "[", 
          RowBox[{
           RowBox[{"ManyBodyTerms", "[", 
            RowBox[{"[", "3", "]"}], "]"}], "[", 
           RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Op6", "=", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"ManyBodyTerms", "[", 
               RowBox[{"[", "3", "]"}], "]"}], "[", 
              RowBox[{"[", "j1", "]"}], "]"}], "[", 
             RowBox[{"[", "k1", "]"}], "]"}], "[", 
            RowBox[{"[", "0", "]"}], "]"}], "=!=", "SuperDagger"}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{"ManyBodyTerms", "[", 
             RowBox[{"[", "3", "]"}], "]"}], "[", 
            RowBox[{"[", "j1", "]"}], "]"}], "[", 
           RowBox[{"[", "k1", "]"}], "]"}]}], "]"}], "/.", 
        RowBox[{"Null", " ", "->", " ", 
         RowBox[{"Sequence", "[", "]"}]}]}], "\[IndentingNewLine]", ",", 
       RowBox[{"{", 
        RowBox[{"j1", ",", 
         RowBox[{"Length", "[", 
          RowBox[{"ManyBodyTerms", "[", 
           RowBox[{"[", "3", "]"}], "]"}], "]"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"k1", ",", 
         RowBox[{"Length", "[", 
          RowBox[{
           RowBox[{"ManyBodyTerms", "[", 
            RowBox[{"[", "3", "]"}], "]"}], "[", 
           RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Do", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"ManyBodyTerms", "[", 
             RowBox[{"[", "4", "]"}], "]"}], "[", 
            RowBox[{"[", "j1", "]"}], "]"}], "[", 
           RowBox[{"[", "0", "]"}], "]"}], "===", "SuperDagger"}], ",", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"Op7", ",", 
           RowBox[{
            RowBox[{
             RowBox[{"ManyBodyTerms", "[", 
              RowBox[{"[", "4", "]"}], "]"}], "[", 
             RowBox[{"[", "j1", "]"}], "]"}], "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ",", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"Op8", ",", 
           RowBox[{
            RowBox[{"ManyBodyTerms", "[", 
             RowBox[{"[", "4", "]"}], "]"}], "[", 
            RowBox[{"[", "j1", "]"}], "]"}]}], "]"}]}], "]"}], ";"}], 
      "\[IndentingNewLine]", ",", 
      RowBox[{"{", 
       RowBox[{"j1", ",", 
        RowBox[{"Length", "[", 
         RowBox[{"ManyBodyTerms", "[", 
          RowBox[{"[", "4", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "Contract", " ", "the", " ", "operators", " ", "in", " ", "hamiltonian", 
     " ", "with", " ", "the", " ", "ket"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ConHcKa", "=", 
     RowBox[{"Subsets", "[", 
      RowBox[{
       RowBox[{"Tuples", "[", 
        RowBox[{"{", 
         RowBox[{"Op3", ",", "Op8"}], "}"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"Min", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Length", "[", "Op3", "]"}], ",", 
           RowBox[{"Length", "[", "Op8", "]"}]}], "}"}], "]"}], "}"}]}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ConHaKc", "=", " ", 
     RowBox[{"Subsets", "[", 
      RowBox[{
       RowBox[{"Tuples", "[", 
        RowBox[{"{", 
         RowBox[{"Op4", ",", "Op7"}], "}"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"Min", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Length", "[", "Op4", "]"}], ",", 
           RowBox[{"Length", "[", "Op7", "]"}]}], "}"}], "]"}], "}"}]}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "Check", " ", "for", " ", "the", " ", "valid", " ", "contractions", " ", 
     "between", " ", "hamiltonian", " ", "and", " ", "ket"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"conHcKa2", "=", 
     RowBox[{
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", 
            RowBox[{"Intersection", "[", 
             RowBox[{"Flatten", "[", 
              RowBox[{"ConHcKa", "[", 
               RowBox[{"[", "i1", "]"}], "]"}], "]"}], "]"}], "]"}], "==", 
           RowBox[{
            RowBox[{"Min", "[", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Length", "[", "Op3", "]"}], ",", 
               RowBox[{"Length", "[", "Op8", "]"}]}], "}"}], "]"}], "*", 
            "2"}]}], ",", 
          RowBox[{"ConHcKa", "[", 
           RowBox[{"[", "i1", "]"}], "]"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i1", ",", 
          RowBox[{"Length", "[", "ConHcKa", "]"}]}], "}"}]}], "]"}], " ", "/.",
       " ", 
      RowBox[{"Null", " ", "->", " ", 
       RowBox[{"Sequence", "[", "]"}]}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"conHaKc2", "=", 
     RowBox[{
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", 
            RowBox[{"Intersection", "[", 
             RowBox[{"Flatten", "[", 
              RowBox[{"ConHaKc", "[", 
               RowBox[{"[", "i1", "]"}], "]"}], "]"}], "]"}], "]"}], "==", 
           RowBox[{
            RowBox[{"Min", "[", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Length", "[", "Op4", "]"}], ",", 
               RowBox[{"Length", "[", "Op7", "]"}]}], "}"}], "]"}], "*", 
            "2"}]}], ",", 
          RowBox[{"ConHaKc", "[", 
           RowBox[{"[", "i1", "]"}], "]"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i1", ",", 
          RowBox[{"Length", "[", "ConHaKc", "]"}]}], "}"}]}], "]"}], " ", "/.",
       " ", 
      RowBox[{"Null", " ", "->", " ", 
       RowBox[{"Sequence", "[", "]"}]}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "All", " ", "the", " ", "possible", " ", "convinations", " ", "between", 
     " ", "the", " ", "valid", " ", "contractions", " ", "of", " ", 
     "Hamiltonianand", " ", "Ket"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ValConHK", "=", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Partition", "[", 
          RowBox[{"#", ",", "2"}], "]"}], "&"}], " ", "@", 
        RowBox[{"Flatten", "[", "#", "]"}]}], "&"}], "/@", 
      RowBox[{"Tuples", "[", 
       RowBox[{"{", 
        RowBox[{"conHcKa2", ",", "conHaKc2"}], "}"}], "]"}]}]}], " ", ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "For", " ", "each", " ", "case", " ", "separate", " ", "the", "  ", 
     "Hamiltonian", " ", "and", " ", "Ket", " ", "contractions", " ", "and", 
     " ", "the", " ", "uncontracted", " ", "terms", " ", "in", " ", "the", 
     " ", "Hamiltonian"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"remainOpHamiltonian", "=", 
     RowBox[{"Table", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"MemberQ", "[", 
              RowBox[{
               RowBox[{"Intersection", "[", 
                RowBox[{
                 RowBox[{"Flatten", "[", 
                  RowBox[{"ValConHK", "[", 
                   RowBox[{"[", "j1", "]"}], "]"}], "]"}], ",", 
                 RowBox[{"Flatten", "[", 
                  RowBox[{"{", 
                   RowBox[{"Op3", ",", "Op4"}], "}"}], "]"}]}], "]"}], ",", 
               RowBox[{
                RowBox[{"Flatten", "[", 
                 RowBox[{"{", 
                  RowBox[{"Op3", ",", "Op4"}], "}"}], "]"}], "[", 
                RowBox[{"[", "i1", "]"}], "]"}]}], "]"}], "==", "False"}], 
            ",", 
            RowBox[{
             RowBox[{"Flatten", "[", 
              RowBox[{"{", 
               RowBox[{"Op3", ",", "Op4"}], "}"}], "]"}], "[", 
             RowBox[{"[", "i1", "]"}], "]"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{"Flatten", "[", 
              RowBox[{"{", 
               RowBox[{"Op3", ",", "Op4"}], "}"}], "]"}], "]"}]}], "}"}]}], 
         "]"}], " ", "/.", " ", 
        RowBox[{"Null", "->", " ", 
         RowBox[{"Sequence", "[", "]"}]}]}], "\[IndentingNewLine]", ",", 
       RowBox[{"{", 
        RowBox[{"j1", ",", 
         RowBox[{"Length", "[", "ValConHK", "]"}]}], "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"remainOpHamiltonian1", "=", "\[IndentingNewLine]", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Intersection", "[", 
          RowBox[{"Op3", ",", 
           RowBox[{"remainOpHamiltonian", "[", 
            RowBox[{"[", "i1", "]"}], "]"}]}], "]"}], ",", 
         RowBox[{"Intersection", "[", 
          RowBox[{"Op4", ",", 
           RowBox[{"remainOpHamiltonian", "[", 
            RowBox[{"[", "i1", "]"}], "]"}]}], "]"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"i1", ",", 
         RowBox[{"Length", "[", "remainOpHamiltonian", "]"}]}], "}"}]}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "This", " ", "variable", " ", "is", " ", "the", " ", "must", " ", 
     "important", " ", "it", " ", "checks", " ", "if", " ", "the", " ", 
     "string", " ", "will", " ", "be", " ", "zero", " ", "or", " ", "not"}], 
    " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"BoolString", "=", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"ManyBodyTerms", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "===", 
        RowBox[{"ManyBodyTerms", "[", 
         RowBox[{"[", "4", "]"}], "]"}], "===", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{
        RowBox[{"Length", "[", 
         RowBox[{"ManyBodyTerms", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "]"}], "==", 
        RowBox[{"Length", "[", 
         RowBox[{"Flatten", "[", 
          RowBox[{"ManyBodyTerms", "[", 
           RowBox[{"[", "3", "]"}], "]"}], "]"}], "]"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"ManyBodyTerms", "[", 
           RowBox[{"[", "3", "]"}], "]"}], "===", 
          RowBox[{"{", "}"}]}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", 
            RowBox[{"ManyBodyTerms", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "]"}], "+", 
           RowBox[{"Length", "[", 
            RowBox[{"ManyBodyTerms", "[", 
             RowBox[{"[", "4", "]"}], "]"}], "]"}]}], "===", 
          RowBox[{"Length", "[", 
           RowBox[{"ManyBodyTerms", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "]"}]}], ",", 
         RowBox[{
          RowBox[{"MemberQ", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Length", "[", 
                RowBox[{"Flatten", "[", 
                 RowBox[{"ManyBodyTerms", "[", 
                  RowBox[{"[", "3", "]"}], "]"}], "]"}], "]"}], "-", 
               RowBox[{"Select", "[", 
                RowBox[{
                 RowBox[{"Range", "[", 
                  RowBox[{"Length", "[", 
                   RowBox[{"Flatten", "[", 
                    RowBox[{"remainOpHamiltonian1", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "]"}], ",", 
                 
                 RowBox[{
                  RowBox[{"#", ">=", 
                   RowBox[{"Length", "[", 
                    RowBox[{"ManyBodyTerms", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "]"}]}], "&"}]}], "]"}]}],
               ")"}], "+", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Length", "[", 
                RowBox[{"Flatten", "[", 
                 RowBox[{"remainOpHamiltonian1", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "-", 
               RowBox[{"Select", "[", 
                RowBox[{
                 RowBox[{"Range", "[", 
                  RowBox[{"Length", "[", 
                   RowBox[{"Flatten", "[", 
                    RowBox[{"remainOpHamiltonian1", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "]"}], ",", 
                 
                 RowBox[{
                  RowBox[{"#", ">=", 
                   RowBox[{"Length", "[", 
                    RowBox[{"ManyBodyTerms", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "]"}]}], "&"}]}], "]"}]}],
               ")"}]}], ",", 
            RowBox[{"Length", "[", 
             RowBox[{"ManyBodyTerms", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "]"}], "&&", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"Length", "[", 
             RowBox[{"ManyBodyTerms", "[", 
              RowBox[{"[", "4", "]"}], "]"}], "]"}], "<", 
            RowBox[{"Length", "[", 
             RowBox[{"ManyBodyTerms", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "]"}]}], ")"}]}]}], "]"}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"numHcont", "=", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"ManyBodyTerms", "[", 
         RowBox[{"[", "3", "]"}], "]"}], "===", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"{", "0", "}"}], ",", 
       RowBox[{
        RowBox[{"Select", "[", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", 
            RowBox[{"Flatten", "[", 
             RowBox[{"remainOpHamiltonian1", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "]"}], ",", 
          RowBox[{
           RowBox[{"#", ">=", 
            RowBox[{"Length", "[", 
             RowBox[{"ManyBodyTerms", "[", 
              RowBox[{"[", "3", "]"}], "]"}], "]"}]}], "&"}]}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"Flatten", "[", 
          RowBox[{"Position", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Length", "[", 
                RowBox[{"Flatten", "[", 
                 RowBox[{"ManyBodyTerms", "[", 
                  RowBox[{"[", "3", "]"}], "]"}], "]"}], "]"}], "-", 
               RowBox[{"Select", "[", 
                RowBox[{
                 RowBox[{"Range", "[", 
                  RowBox[{"Length", "[", 
                   RowBox[{"Flatten", "[", 
                    RowBox[{"remainOpHamiltonian1", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "]"}], ",", 
                 
                 RowBox[{
                  RowBox[{"#", ">=", 
                   RowBox[{"Length", "[", 
                    RowBox[{"ManyBodyTerms", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "]"}]}], "&"}]}], "]"}]}],
               ")"}], "+", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Length", "[", 
                RowBox[{"Flatten", "[", 
                 RowBox[{"remainOpHamiltonian1", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "-", 
               RowBox[{"Select", "[", 
                RowBox[{
                 RowBox[{"Range", "[", 
                  RowBox[{"Length", "[", 
                   RowBox[{"Flatten", "[", 
                    RowBox[{"remainOpHamiltonian1", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "]"}], ",", 
                 
                 RowBox[{
                  RowBox[{"#", ">=", 
                   RowBox[{"Length", "[", 
                    RowBox[{"ManyBodyTerms", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "]"}]}], "&"}]}], "]"}]}],
               ")"}]}], ",", 
            RowBox[{"Length", "[", 
             RowBox[{"ManyBodyTerms", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "]"}], "]"}], "]"}], 
        "]"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "If", "  ", "BoolString", " ", "is", " ", "false", " ", "goes", " ", "to",
      " ", "the", " ", 
     RowBox[{"end", ".", "  ", "If"}], " ", "it", " ", "is", " ", "true", " ",
      "the", " ", "string", " ", "continue", " ", "the", " ", "contraction"}],
     " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"FullContract", "=", 
     RowBox[{"If", "[", 
      RowBox[{"BoolString", ",", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "From", " ", "the", " ", "remaining", " ", "terms", " ", "in", " ", 
         "the", " ", "Hamiltonian", " ", "check", " ", "if", " ", "it", " ", 
         "is", " ", "possible", " ", "to", " ", "do", " ", "one", " ", "or", 
         " ", "multiple", " ", "contractions", " ", "wich", " ", "the", " ", 
         "Cluster", " ", "Operators"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"ConHClust", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"Tuples", "[", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"remainOpHamiltonian1", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                   RowBox[{"[", "k1", "]"}], "]"}], ",", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Op6", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], ",", 
                    RowBox[{"Op5", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}]}], "}"}], "[", 
                   RowBox[{"[", "k1", "]"}], "]"}]}], "}"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"i1", ",", 
                 RowBox[{"Length", "[", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{"Op6", ",", "Op5"}], "}"}], "[", 
                   RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
             ",", 
             RowBox[{"{", 
              RowBox[{"j1", ",", 
               RowBox[{"Length", "[", "remainOpHamiltonian1", "]"}]}], 
              "}"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"k1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"{", 
               RowBox[{"Op6", ",", "Op5"}], "}"}], "]"}]}], "}"}]}], "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "All", " ", "possible", " ", "combinations", " ", "of", " ", 
          "contraction", " ", "between", " ", "Hamiltonian", " ", "with", " ",
           "Cluster", " ", "Operators"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"RandomHClust", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Subsets", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"Partition", "[", 
                RowBox[{"#", ",", "2"}], "]"}], "&"}], "@", 
              RowBox[{"Flatten", "[", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  RowBox[{"ConHClust", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "[", 
                  RowBox[{"[", "i1", "]"}], "]"}], ",", 
                 RowBox[{
                  RowBox[{"ConHClust", "[", 
                   RowBox[{"[", "2", "]"}], "]"}], "[", 
                  RowBox[{"[", "i1", "]"}], "]"}]}], "}"}], "]"}]}], ",", 
             "numHcont"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"ConHClust", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}], ";",
         "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "combinations", " ", "of", " ", "length", " ", "of", " ", "asigned", 
          " ", "contractions"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"NonRepHTs", "=", 
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"RandomHClust", "[", 
             RowBox[{"[", "i1", "]"}], "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"Flatten", " ", "@", 
              RowBox[{"Position", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", "#", "]"}], "&"}], "@", 
                    RowBox[{"DeleteDuplicates", "[", "#", "]"}]}], "&"}], "@", 
                   RowBox[{"Flatten", "[", "#", "]"}]}], "&"}], "/@", 
                 RowBox[{"RandomHClust", "[", 
                  RowBox[{"[", "i1", "]"}], "]"}]}], ",", 
                RowBox[{"2", 
                 RowBox[{"numHcont", "[", 
                  RowBox[{"[", "1", "]"}], "]"}]}]}], "]"}]}], "]"}], "]"}], 
           "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"i1", ",", 
             RowBox[{"Length", "[", "RandomHClust", "]"}]}], "}"}]}], "]"}]}],
         ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Look", " ", "ath", " ", "the", " ", "possitions", " ", "of", " ", 
          "the", " ", "connected", " ", "Hamiltonian", " ", "and", " ", 
          "Cluster"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"PositionConected", "=", "\[IndentingNewLine]", 
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"Position", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Times", "@@", 
                RowBox[{"Table", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", "#", "]"}], "&"}], "@", 
                    RowBox[{"Intersection", "[", 
                    RowBox[{"i1", ",", "#"}], "]"}]}], "&"}], "@", " ", 
                    RowBox[{"Flatten", "[", "#", "]"}]}], "&"}], "/@", 
                   RowBox[{"NonRepHTs", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}]}], ",", 
                  RowBox[{"{", 
                   RowBox[{"i1", ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Flatten", "[", "#", "]"}], "&"}], "/@", 
                    RowBox[{"Transpose", "[", 
                    RowBox[{"{", 
                    RowBox[{"Op6", ",", "Op5"}], "}"}], "]"}]}]}], "}"}]}], 
                 "]"}]}], "//", " ", "Transpose"}], ",", 
              RowBox[{"_", "?", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"#", ">", "0"}], "&"}], ")"}]}]}], "]"}], " ", "//", 
            " ", "Flatten"}], "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"j1", ",", 
             RowBox[{"Length", "[", "NonRepHTs", "]"}]}], "}"}]}], "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Based", " ", "on", " ", "the", " ", "position", " ", "ccombine", 
          " ", "the", " ", "possible", " ", "contractions", " ", 
          "Hamiltonian", " ", "and", " ", "Cluster"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"CombineHTs", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"NonRepHTs", "[", 
             RowBox[{"[", "i1", "]"}], "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"PositionConected", "[", 
              RowBox[{"[", "i1", "]"}], "]"}], "]"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i1", ",", 
             RowBox[{"Length", "[", "PositionConected", "]"}]}], "}"}]}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "For", " ", "each", " ", "combination", " ", "obtain", " ", "the", 
          " ", "remaining", " ", "contractions", " ", "in", " ", "the", " ", 
          "hamiltonian", " ", "and", " ", "Cluster", " ", "Operator"}], 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{"RemainHTs", "=", 
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"Complement", "[", 
                RowBox[{"#", ",", "i1"}], "]"}], "&"}], " ", "/@", " ", 
              RowBox[{"Insert", "[", 
               RowBox[{
                RowBox[{"remainOpHamiltonian1", "[", 
                 RowBox[{"[", "j1", "]"}], "]"}], ",", 
                RowBox[{"Unevaluated", "[", 
                 RowBox[{"Sequence", "@@", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"Flatten", "[", "Op5", "]"}], ",", 
                    RowBox[{"Flatten", "[", "Op6", "]"}]}], "}"}]}], "]"}], 
                ",", "1"}], "]"}]}], ",", 
             RowBox[{"{", 
              RowBox[{"i1", ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"Flatten", "[", "#", "]"}], "&"}], "/@", 
                RowBox[{"CombineHTs", "[", 
                 RowBox[{"[", "j1", "]"}], "]"}]}]}], "}"}]}], "]"}], " ", 
           "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"j1", ",", 
             RowBox[{"Length", "[", "CombineHTs", "]"}]}], "}"}]}], "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Contracting", " ", "fo", " ", "the", " ", "remaining", " ", 
          "operators"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"contBrHTs", "=", "\[IndentingNewLine]", 
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Subsets", "[", 
              RowBox[{
               RowBox[{"Tuples", "[", 
                RowBox[{"{", 
                 RowBox[{"Op2", ",", 
                  RowBox[{"Flatten", "[", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"RemainHTs", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"RemainHTs", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "3", "]"}], "]"}]}], "}"}], "]"}]}], "}"}], 
                "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"Length", "[", "Op2", "]"}], "}"}]}], "]"}], 
             "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"i1", ",", 
               RowBox[{"Length", "[", 
                RowBox[{"RemainHTs", "[", 
                 RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
           "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"j1", ",", 
             RowBox[{"Length", "[", "RemainHTs", "]"}]}], "}"}]}], "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"contBrHTs2", "=", "\[IndentingNewLine]", 
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Subsets", "[", 
              RowBox[{
               RowBox[{"Tuples", "[", 
                RowBox[{"{", 
                 RowBox[{"Op1", ",", 
                  RowBox[{"Flatten", "[", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"RemainHTs", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"RemainHTs", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "4", "]"}], "]"}]}], "}"}], "]"}]}], "}"}], 
                "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"Length", "[", "Op1", "]"}], "}"}]}], "]"}], 
             "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"i1", ",", 
               RowBox[{"Length", "[", 
                RowBox[{"RemainHTs", "[", 
                 RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
           "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"j1", ",", 
             RowBox[{"Length", "[", "RemainHTs", "]"}]}], "}"}]}], "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"contractBrHTs", "=", "\[IndentingNewLine]", 
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Partition", "[", 
                  RowBox[{"#", ",", "2"}], "]"}], "&"}], "@", 
                RowBox[{"Flatten", "[", "#", "]"}]}], "&"}], "/@", 
              RowBox[{"Tuples", "[", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"contBrHTs", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                   RowBox[{"[", "i1", "]"}], "]"}], "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{"Position", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", "#", "]"}], "&"}], "@", 
                    RowBox[{"DeleteDuplicates", "[", "#", "]"}]}], "&"}], "@", 
                    RowBox[{"Flatten", "[", "#", "]"}]}], "&"}], "/@", " ", 
                    RowBox[{
                    RowBox[{"contBrHTs", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}]}], ",", 
                    RowBox[{"2", "*", 
                    RowBox[{"Length", "[", "Op2", "]"}]}]}], "]"}], "//", 
                    "Flatten"}], "]"}], "]"}], ",", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"contBrHTs2", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                   RowBox[{"[", "i1", "]"}], "]"}], "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{"Position", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", "#", "]"}], "&"}], "@", 
                    RowBox[{"DeleteDuplicates", "[", "#", "]"}]}], "&"}], "@", 
                    RowBox[{"Flatten", "[", "#", "]"}]}], "&"}], "/@", " ", 
                    RowBox[{
                    RowBox[{"contBrHTs2", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}]}], ",", 
                    RowBox[{"2", "*", 
                    RowBox[{"Length", "[", "Op1", "]"}]}]}], "]"}], "//", 
                    "Flatten"}], "]"}], "]"}]}], "}"}], "]"}]}], 
             "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"i1", ",", 
               RowBox[{"Length", "[", 
                RowBox[{"RemainHTs", "[", 
                 RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
           "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"j1", ",", 
             RowBox[{"Length", "[", "RemainHTs", "]"}]}], "}"}]}], "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"Table", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Table", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Table", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"Partition", "[", 
                   RowBox[{"#", ",", "2"}], "]"}], "&"}], "@", 
                 RowBox[{"Flatten", "[", "#", "]"}]}], "&"}], "@", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"contractBrHTs", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                   RowBox[{"[", "j1", "]"}], "]"}], "[", 
                  RowBox[{"[", "i1", "]"}], "]"}], ",", 
                 RowBox[{"ValConHK", "[", 
                  RowBox[{"[", "k1", "]"}], "]"}], ",", 
                 RowBox[{
                  RowBox[{"CombineHTs", "[", 
                   RowBox[{"[", "k1", "]"}], "]"}], "[", 
                  RowBox[{"[", "j1", "]"}], "]"}]}], "}"}]}], 
              "\[IndentingNewLine]", ",", 
              RowBox[{"{", 
               RowBox[{"i1", ",", 
                RowBox[{"Length", "[", 
                 RowBox[{
                  RowBox[{"contractBrHTs", "[", 
                   RowBox[{"[", "k1", "]"}], "]"}], "[", 
                  RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
            "\[IndentingNewLine]", ",", 
            RowBox[{"{", 
             RowBox[{"j1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{"CombineHTs", "[", 
                RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
          "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"k1", ",", 
            RowBox[{"Length", "[", "ValConHK", "]"}]}], "}"}]}], "]"}]}], ",", 
       RowBox[{"Sequence", "[", "]"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"SignCont", "=", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"sign", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"FullContract", "[", 
                 RowBox[{"[", "k1", "]"}], "]"}], "[", 
                RowBox[{"[", "j1", "]"}], "]"}], "[", 
               RowBox[{"[", "i1", "]"}], "]"}], "}"}], ",", "ManyBodyTerms"}],
             "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{
               RowBox[{"FullContract", "[", 
                RowBox[{"[", "k1", "]"}], "]"}], "[", 
               RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
         
         RowBox[{"{", 
          RowBox[{"j1", ",", 
           RowBox[{"Length", "[", 
            RowBox[{"FullContract", "[", 
             RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"k1", ",", 
         RowBox[{"Length", "[", "FullContract", "]"}]}], "}"}]}], "]"}]}], 
    ";"}]}]}]], "Input",
 CellChangeTimes->{{3.892017703279008*^9, 
  3.892017703811137*^9}},ExpressionUUID->"5c2a1da8-33be-4b2f-afda-\
00304996784a"]
}, Open  ]]
},
WindowSize->{1086.6, 574.8},
WindowMargins->{{2.4, Automatic}, {Automatic, -591}},
TaggingRules->Association["TryRealOnly" -> False],
Magnification:>1.5 Inherited,
FrontEndVersion->"12.3 for Linux x86 (64-bit) (July 9, 2021)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"170a8321-5221-40d5-be8c-6e272ccfb26a"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[422, 15, 564, 10, 177, "Title",ExpressionUUID->"60337e77-32f7-4c0c-ad67-85dc0cdc42d1"],
Cell[CellGroupData[{
Cell[1011, 29, 537, 8, 75, "Section",ExpressionUUID->"1b8c064c-e9a6-48fb-b021-965f16e7d98c"],
Cell[1551, 39, 64865, 1500, 5115, "Input",ExpressionUUID->"ad2d5759-89d8-40d3-a748-224610d23fcc",
 InitializationCell->True],
Cell[66419, 1541, 70, 0, 33, "Input",ExpressionUUID->"2ecbf699-25b4-4183-8742-db4b06657a97"]
}, Closed]],
Cell[CellGroupData[{
Cell[66526, 1546, 577, 9, 59, "Section",ExpressionUUID->"0161bfa9-ac96-4cca-a50b-f6602c447dc7",
 InitializationCell->True],
Cell[67106, 1557, 35158, 832, 2174, "Input",ExpressionUUID->"2436486f-eeec-469a-ab38-0b8dd8542b64",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[102301, 2394, 1043, 23, 102, "Section",ExpressionUUID->"5c729b93-e4ec-40a4-bfbd-8ff5fa424dcf",
 InitializationCell->True],
Cell[103347, 2419, 106394, 2556, 5919, "Input",ExpressionUUID->"86f446cc-8121-424b-969b-991b96e89d63",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[209778, 4980, 957, 14, 59, "Section",ExpressionUUID->"e9f99a08-7c66-4f0d-adeb-d35819a90a9c",
 InitializationCell->True],
Cell[210738, 4996, 126392, 3039, 8678, "Input",ExpressionUUID->"6b94466e-ee05-47fe-8420-3fe5ab532013",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[337167, 8040, 1004, 21, 59, "Section",ExpressionUUID->"50eb3c8a-6bf8-4e01-962a-e0b58ba5593e"],
Cell[338174, 8063, 82576, 1891, 4795, "Input",ExpressionUUID->"9f77d3e4-ac51-400e-83be-172117124189",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[420787, 9959, 620, 9, 59, "Section",ExpressionUUID->"3436a351-fd66-47e8-92d7-a0bd0cc01347"],
Cell[421410, 9970, 11663, 226, 761, "Input",ExpressionUUID->"dbb5a5f3-12f2-4abb-baeb-51337762cfd7",
 InitializationCell->True],
Cell[433076, 10198, 70, 0, 33, "Input",ExpressionUUID->"7476b777-9498-400a-b4ee-681a4bb77fda"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[433195, 10204, 424, 7, 109, "Title",ExpressionUUID->"29ca02b7-292d-4475-87e0-9f1bc42060a2"],
Cell[CellGroupData[{
Cell[433644, 10215, 72, 0, 75, "Section",ExpressionUUID->"b12cda75-0a82-41cf-baca-d47ee48a96e3"],
Cell[433719, 10217, 69, 0, 108, "Text",ExpressionUUID->"79f77511-b75b-44c1-970f-fc8c2de67687"],
Cell[433791, 10219, 69, 0, 51, "Text",ExpressionUUID->"2b1e9254-3a9f-4daa-b0fd-07480dafb6d9"],
Cell[CellGroupData[{
Cell[433885, 10223, 70, 0, 84, "Input",ExpressionUUID->"75f8d824-bb00-4596-817d-ffc6d0068bff"],
Cell[CellGroupData[{
Cell[433980, 10227, 70, 0, 43, "Print",ExpressionUUID->"7969b244-97fd-4327-ae9a-c37c3af842a1"],
Cell[434053, 10229, 70, 0, 25, "Print",ExpressionUUID->"20aa1ae0-c363-4d9f-953f-28031f5e9dc9"]
}, Open  ]],
Cell[434138, 10232, 71, 0, 137, "Output",ExpressionUUID->"71999752-f843-4276-9842-f2f3ec52ec00"]
}, Open  ]],
Cell[CellGroupData[{
Cell[434246, 10237, 70, 0, 33, "Input",ExpressionUUID->"b48d5797-0723-4a71-afa4-bc507b47a062"],
Cell[434319, 10239, 71, 0, 40, "Output",ExpressionUUID->"2ce21daf-ccb5-496f-8c8b-438df73b83f4"]
}, Open  ]],
Cell[CellGroupData[{
Cell[434427, 10244, 70, 0, 33, "Input",ExpressionUUID->"41193bee-647c-40ae-9562-f179c6387a37"],
Cell[434500, 10246, 71, 0, 40, "Output",ExpressionUUID->"48dc2350-4b3a-4fa4-ac51-23e4479ad77d"]
}, Open  ]],
Cell[434586, 10249, 70, 0, 33, "Input",ExpressionUUID->"c0a2769f-76c4-4cbc-bc7c-e8d163419970"]
}, Closed]],
Cell[CellGroupData[{
Cell[434693, 10254, 72, 0, 66, "Section",ExpressionUUID->"f109d640-d6b5-4ad1-b813-d01579a048c9"],
Cell[434768, 10256, 69, 0, 152, "Text",ExpressionUUID->"b8dcee47-aac1-44a3-9221-c27902aa9929"],
Cell[CellGroupData[{
Cell[434862, 10260, 70, 0, 103, "Input",ExpressionUUID->"22aab238-3115-4fb4-93d3-17335e719fee"],
Cell[CellGroupData[{
Cell[434957, 10264, 70, 0, 43, "Print",ExpressionUUID->"ebe78b8c-54b1-42b5-9038-5c1a83ab2c30"],
Cell[435030, 10266, 70, 0, 25, "Print",ExpressionUUID->"80e67e04-dec6-48d9-9525-8e6e5beffe89"],
Cell[435103, 10268, 70, 0, 25, "Print",ExpressionUUID->"1ffdc98d-d085-4a50-9839-722ef10d23f3"],
Cell[435176, 10270, 70, 0, 25, "Print",ExpressionUUID->"9670a145-e01d-4cd8-abdb-050c112f9eef"],
Cell[435249, 10272, 70, 0, 121, "Print",ExpressionUUID->"3147a2a5-0073-4001-b820-3d9694822541"],
Cell[435322, 10274, 70, 0, 25, "Print",ExpressionUUID->"654c945f-6c5f-463a-8683-c37b01a808bd"],
Cell[435395, 10276, 70, 0, 443, "Print",ExpressionUUID->"63a96344-5f5f-4ca3-8e8d-2a3e9635daae"]
}, Open  ]]
}, Open  ]],
Cell[435492, 10280, 70, 0, 33, "Input",ExpressionUUID->"baccd54a-a717-4f2c-898d-393c8bf08fe1"]
}, Closed]],
Cell[CellGroupData[{
Cell[435599, 10285, 72, 0, 59, "Section",ExpressionUUID->"07e70351-fe32-466a-af78-37e978d58a5b"],
Cell[435674, 10287, 69, 0, 147, "Text",ExpressionUUID->"98280eac-668c-4643-92bf-78430aa6f202"],
Cell[CellGroupData[{
Cell[435768, 10291, 70, 0, 106, "Input",ExpressionUUID->"1d682547-5476-48c8-899a-c2bd712e2820"],
Cell[CellGroupData[{
Cell[435863, 10295, 70, 0, 43, "Print",ExpressionUUID->"fecd3130-b53d-43da-a485-c9fdf5598f5d"],
Cell[435936, 10297, 70, 0, 25, "Print",ExpressionUUID->"00a43acb-14f7-4fa5-a8be-ea0188bf716c"],
Cell[436009, 10299, 70, 0, 25, "Print",ExpressionUUID->"43333a57-30cf-432e-aae1-a247bb269a53"],
Cell[436082, 10301, 70, 0, 25, "Print",ExpressionUUID->"958ad858-4cc0-46a9-a2be-9e41abb6bfed"],
Cell[436155, 10303, 70, 0, 50, "Print",ExpressionUUID->"b2bf4f7e-3e43-4f80-96f0-269e89b5802f"]
}, Open  ]]
}, Open  ]],
Cell[436252, 10307, 70, 0, 33, "Input",ExpressionUUID->"a2a18a0a-ffdd-44c7-858d-335f1dfc456e"]
}, Closed]],
Cell[CellGroupData[{
Cell[436359, 10312, 72, 0, 59, "Section",ExpressionUUID->"17fb1a3e-3f71-4f47-a11a-49ad9e109fcb"],
Cell[436434, 10314, 69, 0, 116, "Text",ExpressionUUID->"fea153e6-55c3-4427-99f8-8407c26f4e70"],
Cell[436506, 10316, 69, 0, 51, "Text",ExpressionUUID->"bd7aa1c3-67eb-416a-8264-9f0344490ebf"],
Cell[CellGroupData[{
Cell[436600, 10320, 70, 0, 80, "Input",ExpressionUUID->"f1461427-57de-4e92-963d-f5bc5f83dd17"],
Cell[CellGroupData[{
Cell[436695, 10324, 70, 0, 43, "Print",ExpressionUUID->"81ba589e-c9a2-40f6-a28a-0ea26f596672"],
Cell[436768, 10326, 70, 0, 25, "Print",ExpressionUUID->"79ba447c-68e2-4278-a250-65e095a20a3c"],
Cell[436841, 10328, 70, 0, 25, "Print",ExpressionUUID->"916b5e01-7f6c-449d-b1a7-ea00466328fc"],
Cell[436914, 10330, 70, 0, 25, "Print",ExpressionUUID->"44eeabe9-3ab6-42b9-9cdd-f2c834fdd9fe"],
Cell[436987, 10332, 70, 0, 271, "Print",ExpressionUUID->"c9317d4e-cb3b-4830-b506-d316e22d06d8"]
}, Open  ]]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[437118, 10339, 72, 0, 59, "Section",ExpressionUUID->"1bf8c2bc-900a-46b8-abdb-a29d70d5b19e"],
Cell[437193, 10341, 69, 0, 116, "Text",ExpressionUUID->"0fc3a552-6740-4389-8aab-456858c085e3"],
Cell[437265, 10343, 69, 0, 51, "Text",ExpressionUUID->"72398fb2-faa5-4d40-8e30-d9fe735f0057"],
Cell[CellGroupData[{
Cell[437359, 10347, 70, 0, 80, "Input",ExpressionUUID->"b9ab802d-37a8-413e-88c6-94786d1453b6"],
Cell[CellGroupData[{
Cell[437454, 10351, 70, 0, 43, "Print",ExpressionUUID->"a2e82f09-f812-4174-8374-551d64dc22ec"],
Cell[437527, 10353, 70, 0, 25, "Print",ExpressionUUID->"a91ad6cc-dd14-4a81-a821-2abe750de617"],
Cell[437600, 10355, 70, 0, 25, "Print",ExpressionUUID->"f7e1b347-77ac-4a5b-868e-2fdb89f60a39"],
Cell[437673, 10357, 70, 0, 25, "Print",ExpressionUUID->"7125deb1-56e8-4964-958d-0420bad108b2"],
Cell[437746, 10359, 70, 0, 960, "Print",ExpressionUUID->"25a53bfe-9b8b-4651-967a-ba956b2fde72"]
}, Open  ]]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[437877, 10366, 72, 0, 59, "Section",ExpressionUUID->"1bbe590b-cf10-42d8-89fa-0eac894ece62"],
Cell[437952, 10368, 69, 0, 115, "Text",ExpressionUUID->"0127995e-31f0-4283-81a3-fc3a57f32576"],
Cell[438024, 10370, 69, 0, 52, "Text",ExpressionUUID->"dd26250f-aa77-4195-889e-63c682c8c250"],
Cell[CellGroupData[{
Cell[438118, 10374, 70, 0, 82, "Input",ExpressionUUID->"69af8fdf-6ec7-4fc6-b6c1-646c034a6d8c"],
Cell[CellGroupData[{
Cell[438213, 10378, 70, 0, 44, "Print",ExpressionUUID->"fce4fe01-2a1c-4d1d-9839-6ad7e62d1059"],
Cell[438286, 10380, 70, 0, 27, "Print",ExpressionUUID->"d2a1f61e-0694-46db-bcde-b684f4457451"],
Cell[438359, 10382, 70, 0, 27, "Print",ExpressionUUID->"eb9720c3-f182-4cef-beb8-c94c6a4be8d1"],
Cell[438432, 10384, 70, 0, 27, "Print",ExpressionUUID->"b42f238b-f897-45e8-838c-45bbfbba3ffc"],
Cell[438505, 10386, 70, 0, 4160, "Print",ExpressionUUID->"b1648c1e-81e6-436b-92b2-b2c806e9d8ce"]
}, Open  ]]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[438636, 10393, 72, 0, 59, "Section",ExpressionUUID->"7ad6dc8b-0121-4178-b735-2d531bc4306d"],
Cell[438711, 10395, 69, 0, 149, "Text",ExpressionUUID->"c554eb2b-4f71-46a5-8c07-73e258ee3654"],
Cell[438783, 10397, 69, 0, 51, "Text",ExpressionUUID->"32bde7ac-37d3-484e-acf8-0febf80b00e8"],
Cell[CellGroupData[{
Cell[438877, 10401, 70, 0, 80, "Input",ExpressionUUID->"8b8c8cdf-36b1-4839-bb0c-eb7071e6d022"],
Cell[CellGroupData[{
Cell[438972, 10405, 70, 0, 43, "Print",ExpressionUUID->"1b6abd22-45cd-4e31-b1af-9d59cf4a5908"],
Cell[439045, 10407, 70, 0, 25, "Print",ExpressionUUID->"569563ed-1d05-4b77-b948-cb0c6c8caf5a"],
Cell[439118, 10409, 70, 0, 25, "Print",ExpressionUUID->"4ca873bf-ff30-4398-b33b-eb08978b6912"],
Cell[439191, 10411, 70, 0, 25, "Print",ExpressionUUID->"b507c33e-2095-4def-9da1-d609a8927a35"],
Cell[439264, 10413, 70, 0, 66575, "Print",ExpressionUUID->"bc973c5d-165b-4a70-ad35-f7fe6303d7d1"]
}, Open  ]]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[439395, 10420, 72, 0, 59, "Section",ExpressionUUID->"626a6a78-6cc5-427d-83d6-5d9c00926041"],
Cell[439470, 10422, 69, 0, 123, "Text",ExpressionUUID->"ec237eae-00d1-4720-ac00-8c3c203df6ec"],
Cell[439542, 10424, 69, 0, 51, "Text",ExpressionUUID->"d7f9ba48-24ab-4a26-99d0-0122d6339b3a"],
Cell[CellGroupData[{
Cell[439636, 10428, 70, 0, 80, "Input",ExpressionUUID->"e1c9915d-496b-44c3-b713-ab6638a8849b"],
Cell[CellGroupData[{
Cell[439731, 10432, 70, 0, 43, "Print",ExpressionUUID->"22f3e565-2d30-44f6-a87e-fe8dafb28787"],
Cell[439804, 10434, 70, 0, 25, "Print",ExpressionUUID->"e7c8eb83-9eff-4923-8448-7989fb204043"],
Cell[439877, 10436, 70, 0, 25, "Print",ExpressionUUID->"af2f4519-7984-4ef1-860f-1ed757114064"],
Cell[439950, 10438, 70, 0, 25, "Print",ExpressionUUID->"e9b76888-f798-4de2-a3b0-4eef7b2466aa"],
Cell[440023, 10440, 70, 0, 292, "Print",ExpressionUUID->"ee61c4da-e010-444c-8c63-85af1dd098e4"],
Cell[440096, 10442, 70, 0, 25, "Print",ExpressionUUID->"18ccbfdb-f44d-4a1a-97e9-3f9bd48d213a"],
Cell[440169, 10444, 70, 0, 422, "Print",ExpressionUUID->"37d91352-510d-4879-a8de-db042df68230"]
}, Open  ]]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[440300, 10451, 72, 0, 59, "Section",ExpressionUUID->"b25ae3dd-5554-4cfb-9d2a-0b8083242125"],
Cell[440375, 10453, 69, 0, 122, "Text",ExpressionUUID->"3a1f1f32-2a62-4237-86e8-7430543b231d"],
Cell[440447, 10455, 69, 0, 51, "Text",ExpressionUUID->"84815ce8-e15d-4a49-bfe2-5351d9a66c63"],
Cell[CellGroupData[{
Cell[440541, 10459, 70, 0, 80, "Input",ExpressionUUID->"070c458e-6f39-481e-8c42-386f2f858153"],
Cell[CellGroupData[{
Cell[440636, 10463, 70, 0, 43, "Print",ExpressionUUID->"550a34f8-f94c-4cef-9192-442f714e0a50"],
Cell[440709, 10465, 70, 0, 25, "Print",ExpressionUUID->"00d4c5a2-805a-4f7c-9033-c871073debc5"],
Cell[440782, 10467, 70, 0, 25, "Print",ExpressionUUID->"b76e08b0-3bfe-4275-af2b-a860dfa16e46"],
Cell[440855, 10469, 70, 0, 25, "Print",ExpressionUUID->"1d358df2-74bf-40e4-9a2b-ff9e58a5d998"],
Cell[440928, 10471, 70, 0, 184, "Print",ExpressionUUID->"12a11430-c7b0-4b3b-a524-2da867feec8f"],
Cell[441001, 10473, 70, 0, 25, "Print",ExpressionUUID->"3307689b-ddee-47de-a97b-da9b9aded6f1"],
Cell[441074, 10475, 70, 0, 93, "Print",ExpressionUUID->"8d76da4d-4fd2-4f48-af0e-0bcf30c0c8cd"]
}, Open  ]]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[441205, 10482, 72, 0, 59, "Section",ExpressionUUID->"2d8cfcb1-0611-40a2-b7ca-9e2eb6a295fd"],
Cell[441280, 10484, 69, 0, 122, "Text",ExpressionUUID->"89dd3eb6-686b-4d25-81c6-d0aec5e4623f"],
Cell[441352, 10486, 69, 0, 51, "Text",ExpressionUUID->"450df8f4-3a9d-4433-b2c4-caf4817a449a"],
Cell[CellGroupData[{
Cell[441446, 10490, 70, 0, 80, "Input",ExpressionUUID->"ce5cbdd8-b7c0-4ed9-8913-9e33343ebc3e"],
Cell[CellGroupData[{
Cell[441541, 10494, 70, 0, 43, "Print",ExpressionUUID->"e261003c-8326-4f64-8c94-21c180e21298"],
Cell[441614, 10496, 70, 0, 25, "Print",ExpressionUUID->"5f98f2c1-81b6-4c2f-a370-0f7e048339eb"],
Cell[441687, 10498, 70, 0, 25, "Print",ExpressionUUID->"0da6e9e3-c6f3-40bb-a242-920e069785af"],
Cell[441760, 10500, 70, 0, 25, "Print",ExpressionUUID->"7fbf955a-135a-444a-a9bc-04333c87d2d5"],
Cell[441833, 10502, 70, 0, 203, "Print",ExpressionUUID->"a66824f5-4cc3-4656-8da8-edadab4baf99"],
Cell[441906, 10504, 70, 0, 25, "Print",ExpressionUUID->"d6db1d53-90e8-49af-bf3a-e1b68ad2e627"],
Cell[441979, 10506, 70, 0, 575, "Print",ExpressionUUID->"7774facd-eb20-48c9-ab45-56ee2a83289e"]
}, Open  ]]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[442110, 10513, 72, 0, 59, "Section",ExpressionUUID->"4bc1c026-13ff-42d6-9529-f0dac01ecae8"],
Cell[442185, 10515, 69, 0, 188, "Text",ExpressionUUID->"6be367af-ff2e-43ca-beed-92c9a44e44c6"],
Cell[CellGroupData[{
Cell[442279, 10519, 70, 0, 80, "Input",ExpressionUUID->"8925830b-1a44-4348-a1e3-70d4de1904e5"],
Cell[CellGroupData[{
Cell[442374, 10523, 70, 0, 43, "Print",ExpressionUUID->"37b23f0c-fdda-4de7-bf84-649fb917d8dd"],
Cell[442447, 10525, 70, 0, 25, "Print",ExpressionUUID->"075e4f8a-28d1-408b-b779-184a0e082c17"],
Cell[442520, 10527, 70, 0, 25, "Print",ExpressionUUID->"c689d450-e882-4b1c-bebe-bbb66e53e090"],
Cell[442593, 10529, 70, 0, 25, "Print",ExpressionUUID->"f575a3bc-2a90-43c0-b581-f7f6b060e957"],
Cell[442666, 10531, 70, 0, 489, "Print",ExpressionUUID->"77a72f8f-d2ec-4b32-89c6-a8c903feb7c8"],
Cell[442739, 10533, 70, 0, 27, "Print",ExpressionUUID->"b58beeab-291e-44f4-af43-bb3791efe7f1"],
Cell[442812, 10535, 70, 0, 7500, "Print",ExpressionUUID->"6ae0b64f-e2be-4265-a623-1efeb3a178c6"]
}, Open  ]]
}, Open  ]]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[442955, 10543, 689, 10, 79, "Title",ExpressionUUID->"fe352605-1bea-4f34-b2b5-0141f38eedf4"],
Cell[443647, 10555, 70, 0, 57, "Input",ExpressionUUID->"58946208-10b2-4a6e-9af8-f586d7b2d75c"],
Cell[CellGroupData[{
Cell[443742, 10559, 70, 0, 33, "Input",ExpressionUUID->"6de971c6-f881-4c73-9b4d-31619548b6d4"],
Cell[443815, 10561, 71, 0, 69, "Output",ExpressionUUID->"bfe14bf9-df88-40df-a41d-62ed2bede81c"]
}, Open  ]],
Cell[443901, 10564, 70, 0, 33, "Input",ExpressionUUID->"c3eb4bd3-e666-4970-9e5d-907f75e0f8c8"],
Cell[443974, 10566, 70, 0, 57, "Input",ExpressionUUID->"85f4f745-8082-40f4-94f1-7a9d3592d341"],
Cell[444047, 10568, 70, 0, 33, "Input",ExpressionUUID->"f30001c7-09d3-4df3-a365-4ae888cb6fee"],
Cell[444120, 10570, 70, 0, 33, "Input",ExpressionUUID->"9c902585-99ce-459e-8841-9eb06a26cc78"],
Cell[CellGroupData[{
Cell[444215, 10574, 70, 0, 33, "Input",ExpressionUUID->"19b57ad3-4277-46b6-9335-c44fdae97ea4"],
Cell[444288, 10576, 71, 0, 65, "Output",ExpressionUUID->"6cf60f36-565b-4a5f-aa9b-ee7967bf76fa"]
}, Open  ]],
Cell[444374, 10579, 70, 0, 33, "Input",ExpressionUUID->"30243c51-32f6-49ad-a504-23989df76a74"],
Cell[CellGroupData[{
Cell[444469, 10583, 70, 0, 33, "Input",ExpressionUUID->"19161adf-f8e1-41be-b7ca-2b68eedfcc31"],
Cell[444542, 10585, 71, 0, 65, "Output",ExpressionUUID->"c58b5e14-9164-40a8-8459-f1277e89dcc0"]
}, Open  ]],
Cell[444628, 10588, 70, 0, 173, "Input",ExpressionUUID->"c0df4d5c-044c-4077-8b9c-d84a507b22c3"]
}, Closed]],
Cell[CellGroupData[{
Cell[444735, 10593, 733, 11, 79, "Title",ExpressionUUID->"1e4c3b07-d92e-4eb7-9869-0bcc8e57ad27"],
Cell[445471, 10606, 1191, 31, 105, "Input",ExpressionUUID->"ed700842-98b4-4a59-bc1e-16354f56d166"],
Cell[446665, 10639, 613, 17, 57, "Input",ExpressionUUID->"6df5c636-144a-4388-8271-05a41896f48c"],
Cell[CellGroupData[{
Cell[447303, 10660, 384, 10, 33, "Input",ExpressionUUID->"38b00cae-510c-4c4c-8866-4bdcda2bad67"],
Cell[447690, 10672, 714, 19, 40, "Output",ExpressionUUID->"053d015f-cfb8-4461-8a2d-d146153761d4"]
}, Open  ]],
Cell[448419, 10694, 1201, 32, 80, "Input",ExpressionUUID->"9c183f9e-2705-456a-89eb-7dbef92915ed"],
Cell[449623, 10728, 40294, 1014, 2684, "Input",ExpressionUUID->"5c2a1da8-33be-4b2f-afda-00304996784a"]
}, Open  ]]
}
]
*)

